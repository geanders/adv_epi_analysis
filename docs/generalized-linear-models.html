<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Generalized linear models | Advanced Epidemiological Analysis</title>
  <meta name="description" content="This is the coursebook for the Colorado State University course ERHS 732, Advanced Epidemiological Analysis." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Generalized linear models | Advanced Epidemiological Analysis" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is the coursebook for the Colorado State University course ERHS 732, Advanced Epidemiological Analysis." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Generalized linear models | Advanced Epidemiological Analysis" />
  
  <meta name="twitter:description" content="This is the coursebook for the Colorado State University course ERHS 732, Advanced Epidemiological Analysis." />
  

<meta name="author" content="Andreas M. Neophytou and G. Brooke Anderson" />


<meta name="date" content="2021-05-18" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="time-series-case-crossover-study-designs.html"/>
<link rel="next" href="natural-experiments.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Advanced Epidemiological Analysis</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Overview</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i><b>1.1</b> License</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="courseinfo.html"><a href="courseinfo.html"><i class="fa fa-check"></i><b>2</b> Course information</a><ul>
<li class="chapter" data-level="2.1" data-path="courseinfo.html"><a href="courseinfo.html#course-learning-objectives"><i class="fa fa-check"></i><b>2.1</b> Course learning objectives</a></li>
<li class="chapter" data-level="2.2" data-path="courseinfo.html"><a href="courseinfo.html#meeting-time-and-place"><i class="fa fa-check"></i><b>2.2</b> Meeting time and place</a></li>
<li class="chapter" data-level="2.3" data-path="courseinfo.html"><a href="courseinfo.html#class-structure-and-expectations"><i class="fa fa-check"></i><b>2.3</b> Class Structure and Expectations</a></li>
<li class="chapter" data-level="2.4" data-path="courseinfo.html"><a href="courseinfo.html#course-grading"><i class="fa fa-check"></i><b>2.4</b> Course grading</a></li>
<li class="chapter" data-level="2.5" data-path="courseinfo.html"><a href="courseinfo.html#textbooks-and-course-materials"><i class="fa fa-check"></i><b>2.5</b> Textbooks and Course Materials</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="time-series-case-crossover-study-designs.html"><a href="time-series-case-crossover-study-designs.html"><i class="fa fa-check"></i><b>3</b> Time series / case-crossover study designs</a><ul>
<li class="chapter" data-level="3.1" data-path="time-series-case-crossover-study-designs.html"><a href="time-series-case-crossover-study-designs.html#reading"><i class="fa fa-check"></i><b>3.1</b> Reading</a></li>
<li class="chapter" data-level="3.2" data-path="time-series-case-crossover-study-designs.html"><a href="time-series-case-crossover-study-designs.html#time-series-data"><i class="fa fa-check"></i><b>3.2</b> Time series data</a></li>
<li class="chapter" data-level="3.3" data-path="time-series-case-crossover-study-designs.html"><a href="time-series-case-crossover-study-designs.html#fitting-models"><i class="fa fa-check"></i><b>3.3</b> Fitting models</a></li>
<li class="chapter" data-level="3.4" data-path="time-series-case-crossover-study-designs.html"><a href="time-series-case-crossover-study-designs.html#chapter-vocabulary"><i class="fa fa-check"></i><b>3.4</b> Chapter vocabulary</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html"><i class="fa fa-check"></i><b>4</b> Generalized linear models</a><ul>
<li class="chapter" data-level="4.1" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#splines-in-glms"><i class="fa fa-check"></i><b>4.1</b> Splines in GLMs</a></li>
<li class="chapter" data-level="4.2" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#cross-basis-functions-in-glms"><i class="fa fa-check"></i><b>4.2</b> Cross-basis functions in GLMs</a></li>
<li class="chapter" data-level="4.3" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#chapter-vocabulary-1"><i class="fa fa-check"></i><b>4.3</b> Chapter vocabulary</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="natural-experiments.html"><a href="natural-experiments.html"><i class="fa fa-check"></i><b>5</b> Natural experiments</a><ul>
<li class="chapter" data-level="5.1" data-path="natural-experiments.html"><a href="natural-experiments.html#interrupted-time-series"><i class="fa fa-check"></i><b>5.1</b> Interrupted time series</a></li>
<li class="chapter" data-level="5.2" data-path="natural-experiments.html"><a href="natural-experiments.html#difference-in-differences"><i class="fa fa-check"></i><b>5.2</b> Difference-in-differences</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="risk-assessment.html"><a href="risk-assessment.html"><i class="fa fa-check"></i><b>6</b> Risk assessment</a></li>
<li class="chapter" data-level="7" data-path="longitudinal-cohort-study-designs.html"><a href="longitudinal-cohort-study-designs.html"><i class="fa fa-check"></i><b>7</b> Longitudinal cohort study designs</a><ul>
<li class="chapter" data-level="7.1" data-path="longitudinal-cohort-study-designs.html"><a href="longitudinal-cohort-study-designs.html#longitudinal-cohort-data"><i class="fa fa-check"></i><b>7.1</b> Longitudinal cohort data</a></li>
<li class="chapter" data-level="7.2" data-path="longitudinal-cohort-study-designs.html"><a href="longitudinal-cohort-study-designs.html#coding-a-survival-analysis"><i class="fa fa-check"></i><b>7.2</b> Coding a survival analysis</a></li>
<li class="chapter" data-level="7.3" data-path="longitudinal-cohort-study-designs.html"><a href="longitudinal-cohort-study-designs.html#handling-complexity"><i class="fa fa-check"></i><b>7.3</b> Handling complexity</a><ul>
<li class="chapter" data-level="7.3.1" data-path="longitudinal-cohort-study-designs.html"><a href="longitudinal-cohort-study-designs.html#multi-level-exposure"><i class="fa fa-check"></i><b>7.3.1</b> Multi-level exposure</a></li>
<li class="chapter" data-level="7.3.2" data-path="longitudinal-cohort-study-designs.html"><a href="longitudinal-cohort-study-designs.html#recurrent-outcome"><i class="fa fa-check"></i><b>7.3.2</b> Recurrent outcome</a></li>
<li class="chapter" data-level="7.3.3" data-path="longitudinal-cohort-study-designs.html"><a href="longitudinal-cohort-study-designs.html#time-varying-coeffificents"><i class="fa fa-check"></i><b>7.3.3</b> Time-varying coeffificents</a></li>
<li class="chapter" data-level="7.3.4" data-path="longitudinal-cohort-study-designs.html"><a href="longitudinal-cohort-study-designs.html#using-survey-results"><i class="fa fa-check"></i><b>7.3.4</b> Using survey results</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="some-approaches-for-confounding.html"><a href="some-approaches-for-confounding.html"><i class="fa fa-check"></i><b>8</b> Some approaches for confounding</a><ul>
<li class="chapter" data-level="8.1" data-path="some-approaches-for-confounding.html"><a href="some-approaches-for-confounding.html#inverse-probability-weighting"><i class="fa fa-check"></i><b>8.1</b> Inverse probability weighting</a></li>
<li class="chapter" data-level="8.2" data-path="some-approaches-for-confounding.html"><a href="some-approaches-for-confounding.html#propensity-scores"><i class="fa fa-check"></i><b>8.2</b> Propensity scores</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="mixed-models.html"><a href="mixed-models.html"><i class="fa fa-check"></i><b>9</b> Mixed models</a></li>
<li class="chapter" data-level="10" data-path="instrumental-variables.html"><a href="instrumental-variables.html"><i class="fa fa-check"></i><b>10</b> Instrumental variables</a></li>
<li class="chapter" data-level="11" data-path="causal-inference.html"><a href="causal-inference.html"><i class="fa fa-check"></i><b>11</b> Causal inference</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Advanced Epidemiological Analysis</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="generalized-linear-models" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> Generalized linear models</h1>
<p>The readings for this chapter are the same as for the last chapter:</p>
<ul>
<li><span class="citation">Vicedo-Cabrera, Sera, and Gasparrini (<a href="#ref-vicedo2019hands" role="doc-biblioref">2019</a>)</span>, with supplemental material available to download by
clicking <a href="http://links.lww.com/EDE/B504" class="uri">http://links.lww.com/EDE/B504</a></li>
<li><span class="citation">Armstrong, Gasparrini, and Tobias (<a href="#ref-armstrong2014conditional" role="doc-biblioref">2014</a>)</span>, with supplemental material available at
<a href="https://bmcmedresmethodol.biomedcentral.com/articles/10.1186/1471-2288-14-122#Sec13" class="uri">https://bmcmedresmethodol.biomedcentral.com/articles/10.1186/1471-2288-14-122#Sec13</a></li>
</ul>
<div id="splines-in-glms" class="section level2">
<h2><span class="header-section-number">4.1</span> Splines in GLMs</h2>
<p>We saw from the latest model with a linear for mean daily temperature that the
suggested effect on mortality is a decrease in daily mortality counts with
increasing temperature. However, as you’ve probably guessed that’s probably not
entirely accurate. A linear term for the effect of exposure restricts us to an
effect that can be fitted with a straight line (either a null effect or a
monotonically increasing or decreasing effect with increasing exposure).</p>
<p>This clearly is problematic in some cases. One example is when exploring the
association between temperature and health risk. Based on human physiology,
we would expect many health risks to be elevated at temperature extremes,
whether those are extreme cold or extreme heat. A linear term would be
inadequate to describe this kind of U-shaped association. Other effects might
have a threshold—for example, heat stroke might have a very low risk at
most temperatures, only increasing with temperature above a certain threshold.
[Maybe add images of these kinds of associations?]</p>
<p>We can
capture non-linear patterns in effects, by using different functions of X.
Examples are <span class="math inline">\(\sqrt{X}\)</span>, <span class="math inline">\(X^{2}\)</span>, or more complex smoothing functions, such as
polynomials or splines. Polynomials might at first make a lot of sense,
especially since you’ve likely come across polynomial terms in mathematics
classes since grade school. However, it turns out that they have some undesirable
properties. A key one is that they can have extreme behavior, particularly
when using a high-order polynomial, and particularly outside the range of
data that are available to fit the model.</p>
<p>An alternative that is generally preferred for environmental epidemiology
studies is the regression spline.
Regression splines are simple parametric smoothing function,
which fit separate polynomial in each interval of the range of the predictor; these
can be linear, quadratic, and cubic. An example of a (in this case cubic) spline
function is <span class="math inline">\(X+X^{2}+X^{3}+I((X&gt;X_{0})*(X-X_{0})^3)\)</span>.This particular function is
a cubic spline with four degrees of freedom (<span class="math inline">\(df=4\)</span>) and one not (<span class="math inline">\(X_{0}\)</span>).
A special type of spline called a natural cubic spline is particularly popular.
Unlike a polynomial function, a natural cubic spline “behaves” better outside
the range of the data used to fit the model—they are constrained to continue
on a [linear?] trajectory once they pass beyond the range of the data.
[Maybe add more / clarify / add references on the point of why splines versus
polynomials.]</p>
<p>Regression splines can be fit in a GLM via the package <code>splines</code>. Two commonly
used examples of regression splines are b-splines and natural cubic
splines. <span class="citation">Vicedo-Cabrera, Sera, and Gasparrini (<a href="#ref-vicedo2019hands" role="doc-biblioref">2019</a>)</span> uses natural cubic splines.</p>
<p><em>Applied: Including a spline in a GLM</em></p>
<p>For this exercise, you will continue to build up the model that you began in
the examples in the previous chapter. The example uses the data provided with
one of this chapter’s readings, <span class="citation">Vicedo-Cabrera, Sera, and Gasparrini (<a href="#ref-vicedo2019hands" role="doc-biblioref">2019</a>)</span>.</p>
<ol style="list-style-type: decimal">
<li>Start by fitting a somewhat simple model—how are daily mortality counts
associated with (a) a linear and (b) a non-linear function of time? Is a linear
term appropriate to describe this association? What types of patterns are
captured by a non-linear function that are missed by a linear function?</li>
<li>In the last chapter, the final version of the model used a GLM with an
overdispersed Poisson distribution, including control for day of week.
Start from this model and add control for long-term and seasonal trends
over the study period.</li>
<li>Refine your model to fit for a non-linear, rather than linear, function
of temperature in the model. Does a non-linear term seem to be more
appropriate than a linear term?</li>
</ol>
<p><em>Applied exercise: Example code</em></p>
<ol style="list-style-type: decimal">
<li><strong>Start by fitting a somewhat simple model—how are daily mortality counts
associated with (a) a linear and (b) a non-linear function of time?</strong></li>
</ol>
<p>It is helpful to start by loading the R packages you are likely to need, as
well as the example dataset. You may also need to re-load the example data
and perform the steps taken to clean it in the last chapter:</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="generalized-linear-models.html#cb75-1"></a><span class="co"># Load some packages that will likely be useful</span></span>
<span id="cb75-2"><a href="generalized-linear-models.html#cb75-2"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb75-3"><a href="generalized-linear-models.html#cb75-3"></a><span class="kw">library</span>(viridis)</span>
<span id="cb75-4"><a href="generalized-linear-models.html#cb75-4"></a><span class="kw">library</span>(lubridate)</span>
<span id="cb75-5"><a href="generalized-linear-models.html#cb75-5"></a><span class="kw">library</span>(broom)</span>
<span id="cb75-6"><a href="generalized-linear-models.html#cb75-6"></a></span>
<span id="cb75-7"><a href="generalized-linear-models.html#cb75-7"></a><span class="co"># Load and clean the data</span></span>
<span id="cb75-8"><a href="generalized-linear-models.html#cb75-8"></a>obs &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/lndn_obs.csv&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb75-9"><a href="generalized-linear-models.html#cb75-9"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">dow =</span> <span class="kw">wday</span>(date, <span class="dt">label =</span> <span class="ot">TRUE</span>))</span></code></pre></div>
<p>For this first question, the aim is to model the association between time and
daily mortality counts within the example data. This approach is often used
to explore and, if needed, adjust for temporal factors in the data.</p>
<p>There are a number of factors that can act over time to create patterns in both
environmental exposures and health outcomes. For example, there may be changes
in air pollution exposures over the years of a study because of changes in
regulations or growth or decline of factories and automobile traffic in an area.
Changes in health care and in population demographics can cause patterns in
health outcomes over the study period. At a shorter, seasonal term, there are
also factors that could influence both exposures and outcomes, including
seasonal changes in climate, seasonal changes in emissions, and seasonal
patterns in health outcomes.</p>
<p>It can be difficult to pinpoint and measure these temporal factors, and so
instead a common practice is to include model control based on the time in the
study. This can be measured, for example, as the day since the start of the
study period.</p>
<p>You can easily add a column for day in study for a dataset that
includes date. R saves dates in a special format, which we’re using the in
<code>obs</code> dataset:</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="generalized-linear-models.html#cb76-1"></a><span class="kw">class</span>(obs<span class="op">$</span>date)</span></code></pre></div>
<pre><code>## [1] &quot;Date&quot;</code></pre>
<p>However, this is just a fancy overlay on a value that’s ultimately saved as
a number. Like most Unix programs, the date is saved as the number of days
since the Unix “epoch”, January 1, 1970. You can take advantage of this
convention—if you use <code>as.numeric</code> around a date in R, it will give you a
number that gets one unit higher for every new date. Here’s the example for
the first date in our example data:</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="generalized-linear-models.html#cb78-1"></a>obs<span class="op">$</span>date[<span class="dv">1</span>]</span></code></pre></div>
<pre><code>## [1] &quot;1990-01-01&quot;</code></pre>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="generalized-linear-models.html#cb80-1"></a><span class="kw">as.numeric</span>(obs<span class="op">$</span>date[<span class="dv">1</span>]) </span></code></pre></div>
<pre><code>## [1] 7305</code></pre>
<p>And here’s the example for the next date:</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="generalized-linear-models.html#cb82-1"></a>obs<span class="op">$</span>date[<span class="dv">2</span>]</span></code></pre></div>
<pre><code>## [1] &quot;1990-01-02&quot;</code></pre>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="generalized-linear-models.html#cb84-1"></a><span class="kw">as.numeric</span>(obs<span class="op">$</span>date[<span class="dv">2</span>])</span></code></pre></div>
<pre><code>## [1] 7306</code></pre>
<p>You can use this convention to add a column that gives days since the first
study date. While you could also use the <code>1:n()</code> call to get a number for
each row that goes from 1 to the number of rows, that approach would not
catch any “skips” in dates in the data (e.g., missing dates if only warm-season
data are included). The use of the dates is more robust:</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="generalized-linear-models.html#cb86-1"></a>obs &lt;-<span class="st"> </span>obs <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb86-2"><a href="generalized-linear-models.html#cb86-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">time =</span> <span class="kw">as.numeric</span>(date) <span class="op">-</span><span class="st"> </span><span class="kw">first</span>(<span class="kw">as.numeric</span>(date)))</span>
<span id="cb86-3"><a href="generalized-linear-models.html#cb86-3"></a></span>
<span id="cb86-4"><a href="generalized-linear-models.html#cb86-4"></a>obs <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb86-5"><a href="generalized-linear-models.html#cb86-5"></a><span class="st">  </span><span class="kw">select</span>(date, time)</span></code></pre></div>
<pre><code>## # A tibble: 8,279 x 2
##    date        time
##    &lt;date&gt;     &lt;dbl&gt;
##  1 1990-01-01     0
##  2 1990-01-02     1
##  3 1990-01-03     2
##  4 1990-01-04     3
##  5 1990-01-05     4
##  6 1990-01-06     5
##  7 1990-01-07     6
##  8 1990-01-08     7
##  9 1990-01-09     8
## 10 1990-01-10     9
## # … with 8,269 more rows</code></pre>
<p>As a next step, it is always useful to use exploratory data analysis to look
at the patterns that might exist for an association, before you start designing
and fitting the regression model.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="generalized-linear-models.html#cb88-1"></a><span class="kw">ggplot</span>(obs, </span>
<span id="cb88-2"><a href="generalized-linear-models.html#cb88-2"></a>       <span class="kw">aes</span>(<span class="dt">x =</span> time, <span class="dt">y =</span> all)) <span class="op">+</span></span>
<span id="cb88-3"><a href="generalized-linear-models.html#cb88-3"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="fl">0.5</span>, <span class="dt">alpha =</span> <span class="fl">0.5</span>)</span></code></pre></div>
<p><img src="adv_epi_analysis_files/figure-html/unnamed-chunk-44-1.png" width="672" /></p>
<p>There are clear patterns between time and daily mortality counts in these data.
First, there is a clear long-term pattern, with mortality rates declining on
average over time. Second, there are clear seasonal patterns, with higher
mortality generally in the winter and lower rates in the summer.</p>
<p>To model this, we can start with fitting a linear term. In the last chapter,
we determined that the mortality outcome data can be fit using a GLM with a
Poisson family, allowing for overdispersion as it is common in real-life
count data like these. To include time as a linear term, we can just include
that column name to the right of the <code>~</code> in the model formula:</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="generalized-linear-models.html#cb89-1"></a>mod_time &lt;-<span class="st"> </span><span class="kw">glm</span>(all <span class="op">~</span><span class="st"> </span>time, </span>
<span id="cb89-2"><a href="generalized-linear-models.html#cb89-2"></a>                <span class="dt">data =</span> obs, <span class="dt">family =</span> <span class="st">&quot;quasipoisson&quot;</span>)</span></code></pre></div>
<p>You can use the <code>augment</code> function from the <code>broom</code> package to pull out the
fitted estimate for each of the original observations and plot that, along
with the observed data, to get an idea of what this model has captured:</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="generalized-linear-models.html#cb90-1"></a>mod_time <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb90-2"><a href="generalized-linear-models.html#cb90-2"></a><span class="st">  </span><span class="kw">augment</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb90-3"><a href="generalized-linear-models.html#cb90-3"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> time)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb90-4"><a href="generalized-linear-models.html#cb90-4"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">y =</span> all), <span class="dt">alpha =</span> <span class="fl">0.4</span>, <span class="dt">size =</span> <span class="fl">0.5</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb90-5"><a href="generalized-linear-models.html#cb90-5"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> <span class="kw">exp</span>(.fitted)), <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb90-6"><a href="generalized-linear-models.html#cb90-6"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Date in study&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Expected mortality count&quot;</span>) </span></code></pre></div>
<p><img src="adv_epi_analysis_files/figure-html/unnamed-chunk-46-1.png" width="672" />
[Check for <code>termplot</code>]</p>
<p>This linear trend captures the long-term trend in mortality rates fairly well in
this case. This won’t always be the case, as there may be some health
outcomes—or some study populations—where the long-term pattern over the
study period might be less linear than in this example. Further, the linear
term is completely unsuccessful in capturing the shorter-term trends in mortality
rate. These oscillate, and so would be impossible to capture over multiple
years with a linear trend.</p>
<p>Instead, it’s helpful to use a non-linear term for time in the model. We can
use a natural cubic spline for this, using the <code>ns</code> function from the <code>splines</code>
package. You will need to clarify how flexible the spline function should be,
and this can be specified through the degrees of freedom for the spline. A
spline with more degrees of freedom will be “wigglier” over a given data range
compared to a spline with fewer degrees of freedom. Let’s start by using
158 degrees of freedom, which translates to about 7 degrees of freedom per year:</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="generalized-linear-models.html#cb91-1"></a><span class="kw">library</span>(splines)</span>
<span id="cb91-2"><a href="generalized-linear-models.html#cb91-2"></a>mod_time_nonlin &lt;-<span class="st"> </span><span class="kw">glm</span>(all <span class="op">~</span><span class="st"> </span><span class="kw">ns</span>(time, <span class="dt">df =</span> <span class="dv">158</span>), </span>
<span id="cb91-3"><a href="generalized-linear-models.html#cb91-3"></a>                       <span class="dt">data =</span> obs, <span class="dt">family =</span> <span class="st">&quot;quasipoisson&quot;</span>)</span></code></pre></div>
<p>You can visualize the model results in a similar way to how we visualized the
last model. However, there is one extra step. The <code>augment</code> function only
carries through columns in the original data (<code>obs</code>) that were directly used
in fitting the model. Now that we’re using a transformation of the <code>time</code>
column, by wrapping it in <code>ns</code>, the <code>time</code> column is no longer included in the
<code>augment</code> output. However, we can easily add it back in using <code>mutate</code>,
pulling it from the original <code>obs</code> dataset, and then proceed as before.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="generalized-linear-models.html#cb92-1"></a>mod_time_nonlin <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb92-2"><a href="generalized-linear-models.html#cb92-2"></a><span class="st">  </span><span class="kw">augment</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb92-3"><a href="generalized-linear-models.html#cb92-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">time =</span> obs<span class="op">$</span>time) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb92-4"><a href="generalized-linear-models.html#cb92-4"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> time)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb92-5"><a href="generalized-linear-models.html#cb92-5"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">y =</span> all), <span class="dt">alpha =</span> <span class="fl">0.4</span>, <span class="dt">size =</span> <span class="fl">0.5</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb92-6"><a href="generalized-linear-models.html#cb92-6"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> <span class="kw">exp</span>(.fitted)), <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb92-7"><a href="generalized-linear-models.html#cb92-7"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Date in study&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Expected mortality count&quot;</span>) </span></code></pre></div>
<p><img src="adv_epi_analysis_files/figure-html/unnamed-chunk-48-1.png" width="672" /></p>
<p>The non-linear term for time has allowed enough flexibility that the model now
captures both long-term and seasonal trends in the data.</p>
<p>[More on how to pick a good d.f. for an env. epi. model like this]. In practice,
researchers often using about 6–8 degrees of freedom per year of the study, in
the case of year-round data. You can explore how changing the degrees of freedom
changes the way the model fits to the observed data. As you use more degrees of
freedom, the line will capture very short-term effects, and may start to
interfere with the shorter-term associations between environmental exposures and
health risk that you are trying to capture. Even in the example model we just
fit, for example, it looks like the control for time may be capturing some
patterns that were likely caused by heatwaves (the rare summer peaks, including
one from the 1995 heatwave). Conversely, if too few degrees of freedom are used,
the model will shift to look much more like the linear model, with inadequate
control for seasonal patterns.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="generalized-linear-models.html#cb93-1"></a><span class="co"># A model with many less d.f. for the time spline</span></span>
<span id="cb93-2"><a href="generalized-linear-models.html#cb93-2"></a>mod_time_nonlin_lowdf &lt;-<span class="st"> </span><span class="kw">glm</span>(all <span class="op">~</span><span class="st"> </span><span class="kw">ns</span>(time, <span class="dt">df =</span> <span class="dv">10</span>), </span>
<span id="cb93-3"><a href="generalized-linear-models.html#cb93-3"></a>                             <span class="dt">data =</span> obs, <span class="dt">family =</span> <span class="st">&quot;quasipoisson&quot;</span>)</span>
<span id="cb93-4"><a href="generalized-linear-models.html#cb93-4"></a>mod_time_nonlin_lowdf <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb93-5"><a href="generalized-linear-models.html#cb93-5"></a><span class="st">  </span><span class="kw">augment</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb93-6"><a href="generalized-linear-models.html#cb93-6"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">time =</span> obs<span class="op">$</span>time) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb93-7"><a href="generalized-linear-models.html#cb93-7"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> time)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb93-8"><a href="generalized-linear-models.html#cb93-8"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">y =</span> all), <span class="dt">alpha =</span> <span class="fl">0.4</span>, <span class="dt">size =</span> <span class="fl">0.5</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb93-9"><a href="generalized-linear-models.html#cb93-9"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> <span class="kw">exp</span>(.fitted)), <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb93-10"><a href="generalized-linear-models.html#cb93-10"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Date in study&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Expected mortality count&quot;</span>) </span></code></pre></div>
<p><img src="adv_epi_analysis_files/figure-html/unnamed-chunk-49-1.png" width="672" /></p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="generalized-linear-models.html#cb94-1"></a><span class="co"># A model with many more d.f. for the time spline</span></span>
<span id="cb94-2"><a href="generalized-linear-models.html#cb94-2"></a><span class="co"># (Takes a little while to run)</span></span>
<span id="cb94-3"><a href="generalized-linear-models.html#cb94-3"></a>mod_time_nonlin_highdf &lt;-<span class="st"> </span><span class="kw">glm</span>(all <span class="op">~</span><span class="st"> </span><span class="kw">ns</span>(time, <span class="dt">df =</span> <span class="dv">400</span>), </span>
<span id="cb94-4"><a href="generalized-linear-models.html#cb94-4"></a>                             <span class="dt">data =</span> obs, <span class="dt">family =</span> <span class="st">&quot;quasipoisson&quot;</span>)</span>
<span id="cb94-5"><a href="generalized-linear-models.html#cb94-5"></a>mod_time_nonlin_highdf <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb94-6"><a href="generalized-linear-models.html#cb94-6"></a><span class="st">  </span><span class="kw">augment</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb94-7"><a href="generalized-linear-models.html#cb94-7"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">time =</span> obs<span class="op">$</span>time) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb94-8"><a href="generalized-linear-models.html#cb94-8"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> time)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb94-9"><a href="generalized-linear-models.html#cb94-9"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">y =</span> all), <span class="dt">alpha =</span> <span class="fl">0.4</span>, <span class="dt">size =</span> <span class="fl">0.5</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb94-10"><a href="generalized-linear-models.html#cb94-10"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> <span class="kw">exp</span>(.fitted)), <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb94-11"><a href="generalized-linear-models.html#cb94-11"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Date in study&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Expected mortality count&quot;</span>) </span></code></pre></div>
<p><img src="adv_epi_analysis_files/figure-html/unnamed-chunk-50-1.png" width="672" /></p>
<p>In all cases, when you fit a non-linear function of an explanatory variable,
it will make the model summary results look much more complicated, e.g.:</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="generalized-linear-models.html#cb95-1"></a>mod_time_nonlin_lowdf <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb95-2"><a href="generalized-linear-models.html#cb95-2"></a><span class="st">  </span><span class="kw">tidy</span>()</span></code></pre></div>
<pre><code>## # A tibble: 11 x 5
##    term                estimate std.error statistic   p.value
##    &lt;chr&gt;                  &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
##  1 (Intercept)           5.26     0.00948    555.   0.       
##  2 ns(time, df = 10)1   -0.0260   0.0119      -2.18 2.93e-  2
##  3 ns(time, df = 10)2   -0.0860   0.0155      -5.56 2.85e-  8
##  4 ns(time, df = 10)3   -0.114    0.0139      -8.15 4.01e- 16
##  5 ns(time, df = 10)4   -0.196    0.0151     -13.0  4.47e- 38
##  6 ns(time, df = 10)5   -0.187    0.0148     -12.6  2.80e- 36
##  7 ns(time, df = 10)6   -0.315    0.0154     -20.5  5.62e- 91
##  8 ns(time, df = 10)7   -0.337    0.0154     -21.9  1.95e-103
##  9 ns(time, df = 10)8   -0.358    0.0135     -26.5  1.56e-148
## 10 ns(time, df = 10)9   -0.467    0.0244     -19.2  4.49e- 80
## 11 ns(time, df = 10)10  -0.392    0.0126     -31.2  8.01e-202</code></pre>
<p>You can see that there are multiple model coefficients for the variable fit
using a spline function, one less than the number of degrees of freedom. These
model coefficients are very hard to interpret on their own. When we are using
the spline to <em>control</em> for a factor that might serve as a confounder of the
association of interest, we typically won’t need to try to interpret these
model coefficients—instead, we are interested in accounting for how this
factor explains variability in the outcome, without needing to quantify the
association as a key result. However, there are also cases where we want to
use a spline to fit the association with the exposure that we are interested
in. In this case, we will want to be able to interpret model coefficients from
the spline. Later in this chapter, we will introduce the <code>dlnm</code> package, which
includes functions to both fit and interpret natural cubic splines within
GLMs for environmental epidemiology.</p>
<ol start="2" style="list-style-type: decimal">
<li><strong>Start from the last model created in the last chapter and add control for
long-term and seasonal trends over the study period.</strong></li>
</ol>
<p>The last model fit in the last chapter was the following, which fits for the
association between a linear term of temperature and mortality risk, with control
for day of week:</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="generalized-linear-models.html#cb97-1"></a>mod_ctrl_dow &lt;-<span class="st"> </span><span class="kw">glm</span>(all <span class="op">~</span><span class="st"> </span>tmean <span class="op">+</span><span class="st"> </span><span class="kw">factor</span>(dow, <span class="dt">ordered =</span> <span class="ot">FALSE</span>), </span>
<span id="cb97-2"><a href="generalized-linear-models.html#cb97-2"></a>                    <span class="dt">data =</span> obs, <span class="dt">family =</span> <span class="st">&quot;quasipoisson&quot;</span>)</span></code></pre></div>
<p>To add control for long-term and seasonal trends, you can take the natural cubic
spline function of temperature that you just fit and include it among the
explanatory / independent variables from the model in the last chapter. If you
want to control for only long-term trends, a linear term of the <code>time</code> column
could work, as we discovered in the first part of this chapter’s exercise.
However, seasonal trends could certainly confound the association of interest.
Mortality rates have a clear seasonal pattern, and temperature does as well,
and these patterns create the potential for confounding when we look at how
temperature and mortality risk are associated, beyond any seasonally-driven
pathways.</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="generalized-linear-models.html#cb98-1"></a>mod_ctrl_dow_time &lt;-<span class="st"> </span><span class="kw">glm</span>(all <span class="op">~</span><span class="st"> </span>tmean <span class="op">+</span><span class="st"> </span><span class="kw">factor</span>(dow, <span class="dt">ordered =</span> <span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb98-2"><a href="generalized-linear-models.html#cb98-2"></a><span class="st">                           </span><span class="kw">ns</span>(time, <span class="dt">df =</span> <span class="dv">158</span>), </span>
<span id="cb98-3"><a href="generalized-linear-models.html#cb98-3"></a>                         <span class="dt">data =</span> obs, <span class="dt">family =</span> <span class="st">&quot;quasipoisson&quot;</span>)</span></code></pre></div>
<p>You can see the influence of this seasonal confounding if you look at the model
results. When we look at the results from the model that did not control for
long-term and seasonal trends, we get an estimate that mortality rates tend to
be lower on days with higher temperature, with a negative term for <code>tmean</code>:</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="generalized-linear-models.html#cb99-1"></a>mod_ctrl_dow <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb99-2"><a href="generalized-linear-models.html#cb99-2"></a><span class="st">  </span><span class="kw">tidy</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb99-3"><a href="generalized-linear-models.html#cb99-3"></a><span class="st">  </span><span class="kw">filter</span>(term <span class="op">==</span><span class="st"> &quot;tmean&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 5
##   term  estimate std.error statistic p.value
##   &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
## 1 tmean  -0.0148  0.000354     -41.7       0</code></pre>
<p>Conversely, when we include control for long-term and seasonal trends, the
estimated association between mortality rates and temperature is reversed,
estimating increased mortality rates on days with higher temperature, <em>controlling
for long-term and seasonal trends</em>:</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="generalized-linear-models.html#cb101-1"></a>mod_ctrl_dow_time <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb101-2"><a href="generalized-linear-models.html#cb101-2"></a><span class="st">  </span><span class="kw">tidy</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb101-3"><a href="generalized-linear-models.html#cb101-3"></a><span class="st">  </span><span class="kw">filter</span>(term <span class="op">==</span><span class="st"> &quot;tmean&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 5
##   term  estimate std.error statistic  p.value
##   &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 tmean  0.00370  0.000395      9.36 1.02e-20</code></pre>
<ol start="3" style="list-style-type: decimal">
<li><strong>Refine your model to fit for a non-linear, rather than linear, function
of temperature in the model.</strong></li>
</ol>
<p>You can use a spline in the same way to fit a non-linear function for the
exposure of interest in the model (temperature). We’ll start there. However,
as mentioned earlier, it’s a bit tricky to interpret the coefficients from the
fit model—you no longer generate a single coefficient for the exposure of
interest, but instead several related to the spline. Therefore, once we show
how to fit using <code>ns</code> directly, we’ll show how you can do the same thing using
specialized functions in the <code>dlnm</code> package. This package includes a lot of
nice functions for not only fitting an association using a non-linear term,
but also for interpreting the results after the model is fit.</p>
<p>First, here is code that can be used to fit the model using <code>ns</code> directly,
similarly to the approach we used to control for temporal patterns with a
flexible function:</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="generalized-linear-models.html#cb103-1"></a>mod_ctrl_nl_temp &lt;-<span class="st"> </span><span class="kw">glm</span>(all <span class="op">~</span><span class="st"> </span><span class="kw">ns</span>(tmean, <span class="dv">4</span>) <span class="op">+</span><span class="st"> </span><span class="kw">factor</span>(dow, <span class="dt">ordered =</span> <span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb103-2"><a href="generalized-linear-models.html#cb103-2"></a><span class="st">                          </span><span class="kw">ns</span>(time, <span class="dt">df =</span> <span class="dv">158</span>), </span>
<span id="cb103-3"><a href="generalized-linear-models.html#cb103-3"></a>                        <span class="dt">data =</span> obs, <span class="dt">family =</span> <span class="st">&quot;quasipoisson&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="generalized-linear-models.html#cb104-1"></a>mod_time_nonlin_highdf <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb104-2"><a href="generalized-linear-models.html#cb104-2"></a><span class="st">  </span><span class="kw">augment</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb104-3"><a href="generalized-linear-models.html#cb104-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">tmean =</span> obs<span class="op">$</span>tmean) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb104-4"><a href="generalized-linear-models.html#cb104-4"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> tmean)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb104-5"><a href="generalized-linear-models.html#cb104-5"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">y =</span> all), <span class="dt">alpha =</span> <span class="fl">0.4</span>, <span class="dt">size =</span> <span class="fl">0.5</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb104-6"><a href="generalized-linear-models.html#cb104-6"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">y =</span> <span class="kw">exp</span>(.fitted)), <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>,  <span class="dt">size =</span> <span class="fl">0.4</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb104-7"><a href="generalized-linear-models.html#cb104-7"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Daily mean temperature&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Expected mortality count&quot;</span>) </span></code></pre></div>
<p><img src="adv_epi_analysis_files/figure-html/unnamed-chunk-57-1.png" width="672" /></p>
</div>
<div id="cross-basis-functions-in-glms" class="section level2">
<h2><span class="header-section-number">4.2</span> Cross-basis functions in GLMs</h2>
<p>[Using a cross-basis to model an exposure’s association with the
outcome in two dimensions (dimensions of time and exposure level)]</p>
</div>
<div id="chapter-vocabulary-1" class="section level2">
<h2><span class="header-section-number">4.3</span> Chapter vocabulary</h2>
<p>Each class will start with a vocabulary quiz on a select number of the words
from the chapter’s vocabulary list. The vocabulary words for this chapter are:</p>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-armstrong2014conditional">
<p>Armstrong, Ben G, Antonio Gasparrini, and Aurelio Tobias. 2014. “Conditional Poisson Models: A Flexible Alternative to Conditional Logistic Case Cross-over Analysis.” <em>BMC Medical Research Methodology</em> 14 (1): 122.</p>
</div>
<div id="ref-vicedo2019hands">
<p>Vicedo-Cabrera, Ana M, Francesco Sera, and Antonio Gasparrini. 2019. “Hands-on Tutorial on a Modeling Framework for Projections of Climate Change Impacts on Health.” <em>Epidemiology</em> 30 (3): 321–29.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="time-series-case-crossover-study-designs.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="natural-experiments.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["adv_epi_analysis.pdf", "adv_epi_analysis.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
