<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 7 Longitudinal cohort study designs | Advanced Epidemiological Analysis</title>
  <meta name="description" content="This is the coursebook for the Colorado State University course ERHS 732, Advanced Epidemiological Analysis." />
  <meta name="generator" content="bookdown 0.23 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 7 Longitudinal cohort study designs | Advanced Epidemiological Analysis" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is the coursebook for the Colorado State University course ERHS 732, Advanced Epidemiological Analysis." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 7 Longitudinal cohort study designs | Advanced Epidemiological Analysis" />
  
  <meta name="twitter:description" content="This is the coursebook for the Colorado State University course ERHS 732, Advanced Epidemiological Analysis." />
  

<meta name="author" content="Andreas M. Neophytou and G. Brooke Anderson" />


<meta name="date" content="2021-10-27" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="estimating-health-impacts.html"/>
<link rel="next" href="some-approaches-for-confounding.html"/>
<script src="libs/header-attrs-2.10/header-attrs.js"></script>
<script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Advanced Epidemiological Analysis</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Overview</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i><b>1.1</b> License</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="courseinfo.html"><a href="courseinfo.html"><i class="fa fa-check"></i><b>2</b> Course information</a>
<ul>
<li class="chapter" data-level="2.1" data-path="courseinfo.html"><a href="courseinfo.html#course-learning-objectives"><i class="fa fa-check"></i><b>2.1</b> Course learning objectives</a></li>
<li class="chapter" data-level="2.2" data-path="courseinfo.html"><a href="courseinfo.html#meeting-time-and-place"><i class="fa fa-check"></i><b>2.2</b> Meeting time and place</a></li>
<li class="chapter" data-level="2.3" data-path="courseinfo.html"><a href="courseinfo.html#class-structure-and-expectations"><i class="fa fa-check"></i><b>2.3</b> Class Structure and Expectations</a></li>
<li class="chapter" data-level="2.4" data-path="courseinfo.html"><a href="courseinfo.html#course-grading"><i class="fa fa-check"></i><b>2.4</b> Course grading</a></li>
<li class="chapter" data-level="2.5" data-path="courseinfo.html"><a href="courseinfo.html#course-schedule"><i class="fa fa-check"></i><b>2.5</b> Course Schedule</a></li>
<li class="chapter" data-level="2.6" data-path="courseinfo.html"><a href="courseinfo.html#textbooks-and-course-materials"><i class="fa fa-check"></i><b>2.6</b> Textbooks and Course Materials</a></li>
<li class="chapter" data-level="2.7" data-path="courseinfo.html"><a href="courseinfo.html#prerequisites-and-preparation"><i class="fa fa-check"></i><b>2.7</b> Prerequisites and Preparation</a></li>
<li class="chapter" data-level="2.8" data-path="courseinfo.html"><a href="courseinfo.html#academic-honesty"><i class="fa fa-check"></i><b>2.8</b> Academic Honesty</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="time-series-case-crossover-studies.html"><a href="time-series-case-crossover-studies.html"><i class="fa fa-check"></i><b>3</b> Time series / case-crossover studies</a>
<ul>
<li class="chapter" data-level="3.1" data-path="time-series-case-crossover-studies.html"><a href="time-series-case-crossover-studies.html#readings"><i class="fa fa-check"></i><b>3.1</b> Readings</a></li>
<li class="chapter" data-level="3.2" data-path="time-series-case-crossover-studies.html"><a href="time-series-case-crossover-studies.html#time-series-and-case-crossover-study-designs"><i class="fa fa-check"></i><b>3.2</b> Time series and case-crossover study designs</a></li>
<li class="chapter" data-level="3.3" data-path="time-series-case-crossover-studies.html"><a href="time-series-case-crossover-studies.html#time-series-data"><i class="fa fa-check"></i><b>3.3</b> Time series data</a></li>
<li class="chapter" data-level="3.4" data-path="time-series-case-crossover-studies.html"><a href="time-series-case-crossover-studies.html#exploratory-data-analysis"><i class="fa fa-check"></i><b>3.4</b> Exploratory data analysis</a></li>
<li class="chapter" data-level="3.5" data-path="time-series-case-crossover-studies.html"><a href="time-series-case-crossover-studies.html#statistical-modeling-for-a-time-series-study"><i class="fa fa-check"></i><b>3.5</b> Statistical modeling for a time series study</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html"><i class="fa fa-check"></i><b>4</b> Generalized linear models</a>
<ul>
<li class="chapter" data-level="4.1" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#readings-1"><i class="fa fa-check"></i><b>4.1</b> Readings</a></li>
<li class="chapter" data-level="4.2" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#splines-in-glms"><i class="fa fa-check"></i><b>4.2</b> Splines in GLMs</a></li>
<li class="chapter" data-level="4.3" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#distributed-lags-and-cross-basis-functions-in-glms"><i class="fa fa-check"></i><b>4.3</b> Distributed lags and cross-basis functions in GLMs</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="natural-experiments.html"><a href="natural-experiments.html"><i class="fa fa-check"></i><b>5</b> Natural experiments</a>
<ul>
<li class="chapter" data-level="5.1" data-path="natural-experiments.html"><a href="natural-experiments.html#readings-2"><i class="fa fa-check"></i><b>5.1</b> Readings</a></li>
<li class="chapter" data-level="5.2" data-path="natural-experiments.html"><a href="natural-experiments.html#natural-experiments-1"><i class="fa fa-check"></i><b>5.2</b> Natural experiments</a></li>
<li class="chapter" data-level="5.3" data-path="natural-experiments.html"><a href="natural-experiments.html#interrupted-time-series"><i class="fa fa-check"></i><b>5.3</b> Interrupted time series</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="estimating-health-impacts.html"><a href="estimating-health-impacts.html"><i class="fa fa-check"></i><b>6</b> Estimating health impacts</a>
<ul>
<li class="chapter" data-level="6.1" data-path="estimating-health-impacts.html"><a href="estimating-health-impacts.html#readings-3"><i class="fa fa-check"></i><b>6.1</b> Readings</a></li>
<li class="chapter" data-level="6.2" data-path="estimating-health-impacts.html"><a href="estimating-health-impacts.html#attributable-risk-and-attributable-number"><i class="fa fa-check"></i><b>6.2</b> Attributable risk and attributable number</a></li>
<li class="chapter" data-level="6.3" data-path="estimating-health-impacts.html"><a href="estimating-health-impacts.html#quantifying-potential-health-impacts-under-different-scenarios"><i class="fa fa-check"></i><b>6.3</b> Quantifying potential health impacts under different scenarios</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="longitudinal-cohort-study-designs.html"><a href="longitudinal-cohort-study-designs.html"><i class="fa fa-check"></i><b>7</b> Longitudinal cohort study designs</a>
<ul>
<li class="chapter" data-level="7.1" data-path="longitudinal-cohort-study-designs.html"><a href="longitudinal-cohort-study-designs.html#readings-4"><i class="fa fa-check"></i><b>7.1</b> Readings</a></li>
<li class="chapter" data-level="7.2" data-path="longitudinal-cohort-study-designs.html"><a href="longitudinal-cohort-study-designs.html#longitudinal-cohort-data"><i class="fa fa-check"></i><b>7.2</b> Longitudinal cohort data</a></li>
<li class="chapter" data-level="7.3" data-path="longitudinal-cohort-study-designs.html"><a href="longitudinal-cohort-study-designs.html#coding-a-survival-analysis"><i class="fa fa-check"></i><b>7.3</b> Coding a survival analysis</a></li>
<li class="chapter" data-level="7.4" data-path="longitudinal-cohort-study-designs.html"><a href="longitudinal-cohort-study-designs.html#handling-complexity"><i class="fa fa-check"></i><b>7.4</b> Handling complexity</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="longitudinal-cohort-study-designs.html"><a href="longitudinal-cohort-study-designs.html#recurrent-outcome-and-time-varying-exposures"><i class="fa fa-check"></i><b>7.4.1</b> Recurrent outcome and time varying-exposures</a></li>
<li class="chapter" data-level="7.4.2" data-path="longitudinal-cohort-study-designs.html"><a href="longitudinal-cohort-study-designs.html#multi-level-exposure"><i class="fa fa-check"></i><b>7.4.2</b> Multi-level exposure</a></li>
<li class="chapter" data-level="7.4.3" data-path="longitudinal-cohort-study-designs.html"><a href="longitudinal-cohort-study-designs.html#time-varying-coefficients"><i class="fa fa-check"></i><b>7.4.3</b> Time-varying coefficients</a></li>
<li class="chapter" data-level="7.4.4" data-path="longitudinal-cohort-study-designs.html"><a href="longitudinal-cohort-study-designs.html#using-survey-data-e.g.-nhanes"><i class="fa fa-check"></i><b>7.4.4</b> Using survey data (e.g. NHANES)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="some-approaches-for-confounding.html"><a href="some-approaches-for-confounding.html"><i class="fa fa-check"></i><b>8</b> Some approaches for confounding</a>
<ul>
<li class="chapter" data-level="8.1" data-path="some-approaches-for-confounding.html"><a href="some-approaches-for-confounding.html#readings-5"><i class="fa fa-check"></i><b>8.1</b> Readings</a></li>
<li class="chapter" data-level="8.2" data-path="some-approaches-for-confounding.html"><a href="some-approaches-for-confounding.html#propensity-scores-and-inverse-probability-weighting"><i class="fa fa-check"></i><b>8.2</b> Propensity scores and inverse probability weighting</a></li>
<li class="chapter" data-level="8.3" data-path="some-approaches-for-confounding.html"><a href="some-approaches-for-confounding.html#more-ways-to-use-propensity-scores"><i class="fa fa-check"></i><b>8.3</b> More ways to use propensity scores</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="mixed-models.html"><a href="mixed-models.html"><i class="fa fa-check"></i><b>9</b> Mixed models</a></li>
<li class="chapter" data-level="10" data-path="instrumental-variables.html"><a href="instrumental-variables.html"><i class="fa fa-check"></i><b>10</b> Instrumental variables</a></li>
<li class="chapter" data-level="11" data-path="causal-inference.html"><a href="causal-inference.html"><i class="fa fa-check"></i><b>11</b> Causal inference</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Advanced Epidemiological Analysis</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="longitudinal-cohort-study-designs" class="section level1" number="7">
<h1><span class="header-section-number">Chapter 7</span> Longitudinal cohort study designs</h1>
<div id="readings-4" class="section level2" number="7.1">
<h2><span class="header-section-number">7.1</span> Readings</h2>
<p>The required readings for this chapter are:</p>
<ul>
<li><p><span class="citation"><a href="#ref-andersson201970" role="doc-biblioref">Andersson et al.</a> (<a href="#ref-andersson201970" role="doc-biblioref">2019</a>)</span> Provides background on the study we’ll use in this chapter for our example data</p></li>
<li><p><span class="citation"><a href="#ref-wong1989risk" role="doc-biblioref">Wong et al.</a> (<a href="#ref-wong1989risk" role="doc-biblioref">1989</a>)</span> An epidemiological study using the study data.</p></li>
</ul>
<p>There are also some supplemental readings you may find useful. The following are a series of instructional papers on survival analysis, that are
meant as general background on how to fit survival analysis models:</p>
<ul>
<li><p><span class="citation"><a href="#ref-clark2003survival" role="doc-biblioref">Clark et al.</a> (<a href="#ref-clark2003survival" role="doc-biblioref">2003</a>)</span></p></li>
<li><p><span class="citation"><a href="#ref-bradburn2003survival" role="doc-biblioref">Bradburn et al.</a> (<a href="#ref-bradburn2003survival" role="doc-biblioref">2003a</a>)</span></p></li>
<li><p><span class="citation"><a href="#ref-bradburn2003survival2" role="doc-biblioref">Bradburn et al.</a> (<a href="#ref-bradburn2003survival2" role="doc-biblioref">2003b</a>)</span></p></li>
</ul>
<p>This article is a good summary for the limitations of Hazards Ratios and offers an alternative survival analysis approach enabling the plotting of adjusted cumulative incidence (and similarly survival rate) curves:</p>
<ul>
<li><span class="citation"><a href="#ref-hernan2010hazards" role="doc-biblioref">Hernán</a> (<a href="#ref-hernan2010hazards" role="doc-biblioref">2010</a>)</span> (Note that there is an online erratum for this article: “On page 15, column 1, second full paragraph: ‘… and the average HR is ensured to reach the value 1.’ should instead say, ‘… and the risk ratio is ensured to reach the value 1.’”)</li>
</ul>
<p>These articles provide more background on the Framingham Heart Study:</p>
<ul>
<li><span class="citation"><a href="#ref-dawber1951epidemiological" role="doc-biblioref">Dawber, Meadors, and Moore Jr</a> (<a href="#ref-dawber1951epidemiological" role="doc-biblioref">1951</a>)</span> A paper from the 1950s, this presents the rationale behind the design of the Framingham Heart Study</li>
<li><span class="citation"><a href="#ref-dawber2015ii" role="doc-biblioref">Dawber, Moore, and Mann</a> (<a href="#ref-dawber2015ii" role="doc-biblioref">2015</a>)</span> A reprint of the paper describing the first results to come out of the Framingham Heart Study</li>
</ul>
<p>These articles provide some general reviews on our current understanding of the epidemiology and etiology of heart disease and its risk factors:</p>
<ul>
<li><span class="citation"><a href="#ref-wong2014epidemiological" role="doc-biblioref">Wong</a> (<a href="#ref-wong2014epidemiological" role="doc-biblioref">2014</a>)</span> Review of large epidemiological studies on coronary heart disease and key findings</li>
<li><span class="citation"><a href="#ref-ziaeian2016epidemiology" role="doc-biblioref">Ziaeian and Fonarow</a> (<a href="#ref-ziaeian2016epidemiology" role="doc-biblioref">2016</a>)</span> Review on the epidemiology and etiology of heart failure</li>
<li><span class="citation"><a href="#ref-valenzuela2021lifestyle" role="doc-biblioref">Valenzuela et al.</a> (<a href="#ref-valenzuela2021lifestyle" role="doc-biblioref">2021</a>)</span> Review of risk factors for hypertension</li>
<li><span class="citation"><a href="#ref-zhou2021global" role="doc-biblioref">Zhou et al.</a> (<a href="#ref-zhou2021global" role="doc-biblioref">2021</a>)</span> Review on global epidemiology of hypertension</li>
</ul>
</div>
<div id="longitudinal-cohort-data" class="section level2" number="7.2">
<h2><span class="header-section-number">7.2</span> Longitudinal cohort data</h2>
<p>Our example data for this chapter comes from the Framingham Heart Study. This is a cohort study that began in 1948 <span class="citation">(<a href="#ref-andersson201970" role="doc-biblioref">Andersson et al. 2019</a>)</span>. At the time (and continuing today), heart disease was the most common cause of death in the US—a notable shift from earlier times, when infectious diseases played a larger role in mortality. While heart disease was an important cause of death, however, very little was known about risk factors for heart disease, outside of a little concerning the role of some infectious and nutritional diseases that affected the heart <span class="citation">(<a href="#ref-dawber1951epidemiological" role="doc-biblioref">Dawber, Meadors, and Moore Jr 1951</a>; <a href="#ref-andersson201970" role="doc-biblioref">Andersson et al. 2019</a>)</span>. This study was designed to collect a group of people without evident cardiovascular disease (although this restriction was eased in practice) and track them over many years, to try to identify risk factors for developing cardiovascular disease. The study subjects were tracked over time, with data regularly collected on both risk factors and cardiovascular outcomes. The study was revolutionary in identifying some key risk factors for coronary heart disease, including elevated blood pressure, high cholesterol levels, being overweight, and smoking <span class="citation">(<a href="#ref-andersson201970" role="doc-biblioref">Andersson et al. 2019</a>)</span>. It was also revolutionary in identifying high blood pressure as a risk for other cardiovascular outcomes, including stroke and congestive heart failure <span class="citation">(<a href="#ref-andersson201970" role="doc-biblioref">Andersson et al. 2019</a>)</span>.</p>
<p>The original cohort included about 5,200 people from the town of Framingham, MA. The
example data is a subset of data from this original cohort. You can download the example dataset for this class by clicking <a href="https://github.com/geanders/adv_epi_analysis/raw/master/data/frmgham2.csv">here</a> and then saving the content of the page as a csv file (we recommend using the original filename of “frmgham2.csv”). There is also a codebook file that comes with these data, which you can download for this class by clicking <a href="https://github.com/geanders/adv_epi_analysis/raw/master/data/Framingham%20Longitudinal%20Data%20Documentation.pdf">here</a>. This codebook includes some explanations about the columns in the data, as well as how multiple measurements from a single study subject are included in the data.</p>
<p>The data are saved in a csv format, and so they can be read into R using the
<code>read_csv</code> function from the <code>readr</code> package (part of the tidyverse). You can use the following code to read in these data, assuming you have saved them in a “data” subdirectory of your current
working directory:</p>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb307-1"><a href="longitudinal-cohort-study-designs.html#cb307-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) <span class="co"># Loads all the tidyverse packages, including readr</span></span>
<span id="cb307-2"><a href="longitudinal-cohort-study-designs.html#cb307-2" aria-hidden="true" tabindex="-1"></a>fhs <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/frmgham2.csv&quot;</span>)</span>
<span id="cb307-3"><a href="longitudinal-cohort-study-designs.html#cb307-3" aria-hidden="true" tabindex="-1"></a>fhs</span></code></pre></div>
<pre><code>## # A tibble: 11,627 x 39
##    RANDID   SEX TOTCHOL   AGE SYSBP DIABP CURSMOKE CIGPDAY   BMI DIABETES BPMEDS
##     &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;
##  1   2448     1     195    39  106   70          0       0  27.0        0      0
##  2   2448     1     209    52  121   66          0       0  NA          0      0
##  3   6238     2     250    46  121   81          0       0  28.7        0      0
##  4   6238     2     260    52  105   69.5        0       0  29.4        0      0
##  5   6238     2     237    58  108   66          0       0  28.5        0      0
##  6   9428     1     245    48  128.  80          1      20  25.3        0      0
##  7   9428     1     283    54  141   89          1      30  25.3        0      0
##  8  10552     2     225    61  150   95          1      30  28.6        0      0
##  9  10552     2     232    67  183  109          1      20  30.2        0      0
## 10  11252     2     285    46  130   84          1      23  23.1        0      0
## # … with 11,617 more rows, and 28 more variables: HEARTRTE &lt;dbl&gt;,
## #   GLUCOSE &lt;dbl&gt;, educ &lt;dbl&gt;, PREVCHD &lt;dbl&gt;, PREVAP &lt;dbl&gt;, PREVMI &lt;dbl&gt;,
## #   PREVSTRK &lt;dbl&gt;, PREVHYP &lt;dbl&gt;, TIME &lt;dbl&gt;, PERIOD &lt;dbl&gt;, HDLC &lt;dbl&gt;,
## #   LDLC &lt;dbl&gt;, DEATH &lt;dbl&gt;, ANGINA &lt;dbl&gt;, HOSPMI &lt;dbl&gt;, MI_FCHD &lt;dbl&gt;,
## #   ANYCHD &lt;dbl&gt;, STROKE &lt;dbl&gt;, CVD &lt;dbl&gt;, HYPERTEN &lt;dbl&gt;, TIMEAP &lt;dbl&gt;,
## #   TIMEMI &lt;dbl&gt;, TIMEMIFC &lt;dbl&gt;, TIMECHD &lt;dbl&gt;, TIMESTRK &lt;dbl&gt;, TIMECVD &lt;dbl&gt;,
## #   TIMEDTH &lt;dbl&gt;, TIMEHYP &lt;dbl&gt;</code></pre>
<p>You can find full details on the structure of this data in the codebook. At a broad scale, note that it includes several health outcomes related to heart disease, which the codebook calls “events” (<code>DEATH</code>: indicator of death from any cause; <code>ANYCHD</code>: indicator of one of several types of events related to coronary heart disease; <code>HOSPMI</code>: Hopitalization for myocardial infarction [heart attack], etc.). The data also includes a number of risk factors that the study researchers hypothesized might be linked to cardiovascular disease (<code>CURSMOKE</code>: if the study subject is currently a smoker; <code>TOTCHOL</code>: serum total cholesterol; <code>SYSBP</code>, <code>DIABP</code>: measures of the systolic and diastolic blood pressure, respectively; <code>BMI</code>: Body Mass Index; etc.). Finally, there are some characteristics of the study subject, like age (<code>AGE</code>) and sex (<code>SEX</code>), as well as some variables that are connected to either the time of the record or the time of certain events (or of censoring, if the event did not happen during follow-up).</p>
<p>As you look through the data, pay attention to some features that are more characteristic of cohort studies, compared to features of the time series data we worked with in earlier chapters:</p>
<ul>
<li>One important difference compared to a time-series dataset is the <code>RANDID</code> variable. This is the unique identifier for unit for which we have repeated observations for over time.
In this case the <code>RANDID</code> variable represents a unique identifier for each study participant, with multiple observations (rows) per participant over time.</li>
<li>The <code>TIME</code> variable indicates the number of days that have elapsed since beginning of follow-up of each observation. <code>TIME</code> is always 0 for the first observation of each participant (when <code>PERIOD</code> equals 1, for the first examination), and then for following measurements will track the time since follow-up started for that study participant.</li>
<li>The number of observations varies between participants (typical of many cohort studies)</li>
<li>The time spacing between observations is not constant. This is because the repeated observations in the Framingham Heart Study are the result of follow-up exams happening 3 to 5 years apart. Many longitudinal cohorts will instead have observations over a fixed time interval (monthly, annual, biannual etc), resulting in a more balanced dataset.</li>
<li>Observations are given for various risk factors, covariates and cardiovascular outcomes. Some will be invariant for each participant over time (<code>SEX</code>, <code>educ</code>), while others will vary with each exam.</li>
</ul>
<p>From a data management perspective, we might want to change all the column names
to be in lowercase, rather than uppercase. This will save our pinkies some
work as we code with the data! You can make that change with the following
code, using the <code>str_to_lower</code> function from the <code>stringr</code> package (part of
the <code>tidyverse</code>):</p>
<div class="sourceCode" id="cb309"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb309-1"><a href="longitudinal-cohort-study-designs.html#cb309-1" aria-hidden="true" tabindex="-1"></a>fhs <span class="ot">&lt;-</span> fhs <span class="sc">%&gt;%</span> </span>
<span id="cb309-2"><a href="longitudinal-cohort-study-designs.html#cb309-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_all</span>(<span class="at">.funs =</span> str_to_lower)</span>
<span id="cb309-3"><a href="longitudinal-cohort-study-designs.html#cb309-3" aria-hidden="true" tabindex="-1"></a>fhs</span></code></pre></div>
<pre><code>## # A tibble: 11,627 x 39
##    randid   sex totchol   age sysbp diabp cursmoke cigpday   bmi diabetes bpmeds
##     &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;
##  1   2448     1     195    39  106   70          0       0  27.0        0      0
##  2   2448     1     209    52  121   66          0       0  NA          0      0
##  3   6238     2     250    46  121   81          0       0  28.7        0      0
##  4   6238     2     260    52  105   69.5        0       0  29.4        0      0
##  5   6238     2     237    58  108   66          0       0  28.5        0      0
##  6   9428     1     245    48  128.  80          1      20  25.3        0      0
##  7   9428     1     283    54  141   89          1      30  25.3        0      0
##  8  10552     2     225    61  150   95          1      30  28.6        0      0
##  9  10552     2     232    67  183  109          1      20  30.2        0      0
## 10  11252     2     285    46  130   84          1      23  23.1        0      0
## # … with 11,617 more rows, and 28 more variables: heartrte &lt;dbl&gt;,
## #   glucose &lt;dbl&gt;, educ &lt;dbl&gt;, prevchd &lt;dbl&gt;, prevap &lt;dbl&gt;, prevmi &lt;dbl&gt;,
## #   prevstrk &lt;dbl&gt;, prevhyp &lt;dbl&gt;, time &lt;dbl&gt;, period &lt;dbl&gt;, hdlc &lt;dbl&gt;,
## #   ldlc &lt;dbl&gt;, death &lt;dbl&gt;, angina &lt;dbl&gt;, hospmi &lt;dbl&gt;, mi_fchd &lt;dbl&gt;,
## #   anychd &lt;dbl&gt;, stroke &lt;dbl&gt;, cvd &lt;dbl&gt;, hyperten &lt;dbl&gt;, timeap &lt;dbl&gt;,
## #   timemi &lt;dbl&gt;, timemifc &lt;dbl&gt;, timechd &lt;dbl&gt;, timestrk &lt;dbl&gt;, timecvd &lt;dbl&gt;,
## #   timedth &lt;dbl&gt;, timehyp &lt;dbl&gt;</code></pre>
<p>To look a bit more closely at how this dataset works, let’s take a look just at the observations of the oldest study subjects at the first examination, those 69 or older (<code>age &gt;= 69</code>) at their first examination (<code>period == 1</code>):</p>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb311-1"><a href="longitudinal-cohort-study-designs.html#cb311-1" aria-hidden="true" tabindex="-1"></a>oldest_subjects <span class="ot">&lt;-</span> fhs <span class="sc">%&gt;%</span> </span>
<span id="cb311-2"><a href="longitudinal-cohort-study-designs.html#cb311-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(period <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> age <span class="sc">&gt;=</span> <span class="dv">69</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb311-3"><a href="longitudinal-cohort-study-designs.html#cb311-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(randid)</span>
<span id="cb311-4"><a href="longitudinal-cohort-study-designs.html#cb311-4" aria-hidden="true" tabindex="-1"></a>oldest_subjects</span></code></pre></div>
<pre><code>##  [1] 3603542 3762702 4726021 7198139 7351212 7568367 7659676 7695005 8723664
## [10] 9643995 9686180 9789948</code></pre>
<p>Once we have the IDs of these study subjects (<code>oldest_subjects</code>), we can pull out the study data just for them. I’m limiting to a few columns: their ID (<code>randid</code>), the time of each examination (<code>time</code>), the number of each examination (<code>period</code>), whether they died during follow-up (<code>died</code>), and the number of days between the first examination and either death (if they died during follow-up) or censoring (i.e., stopped tracking the subject or lost them to follow-up) (<code>timedth</code>):</p>
<div class="sourceCode" id="cb313"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb313-1"><a href="longitudinal-cohort-study-designs.html#cb313-1" aria-hidden="true" tabindex="-1"></a>fhs <span class="sc">%&gt;%</span> </span>
<span id="cb313-2"><a href="longitudinal-cohort-study-designs.html#cb313-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(randid <span class="sc">%in%</span> oldest_subjects) <span class="sc">%&gt;%</span> </span>
<span id="cb313-3"><a href="longitudinal-cohort-study-designs.html#cb313-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(randid, time, period, death, timedth)</span></code></pre></div>
<pre><code>## # A tibble: 24 x 5
##     randid  time period death timedth
##      &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
##  1 3603542     0      1     1    1825
##  2 3762702     0      1     1    3076
##  3 3762702  2253      2     1    3076
##  4 4726021     0      1     1    4275
##  5 4726021  2134      2     1    4275
##  6 7198139     0      1     1    5384
##  7 7351212     0      1     1    4396
##  8 7351212  2146      2     1    4396
##  9 7351212  4283      3     1    4396
## 10 7568367     0      1     1    1563
## # … with 14 more rows</code></pre>
<p>We can explore this subset of the data by plotting, for each of these study subjects, the timing of each of their examination periods, whether they died during follow-up, and the timing of their death or censoring:</p>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb315-1"><a href="longitudinal-cohort-study-designs.html#cb315-1" aria-hidden="true" tabindex="-1"></a>fhs <span class="sc">%&gt;%</span> </span>
<span id="cb315-2"><a href="longitudinal-cohort-study-designs.html#cb315-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(randid <span class="sc">%in%</span> oldest_subjects) <span class="sc">%&gt;%</span> </span>
<span id="cb315-3"><a href="longitudinal-cohort-study-designs.html#cb315-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(randid, time, period, death, timedth) <span class="sc">%&gt;%</span> </span>
<span id="cb315-4"><a href="longitudinal-cohort-study-designs.html#cb315-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">randid =</span> <span class="fu">as_factor</span>(randid), </span>
<span id="cb315-5"><a href="longitudinal-cohort-study-designs.html#cb315-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">randid =</span> <span class="fu">fct_reorder</span>(randid, timedth),  <span class="co"># Arrange by time to death</span></span>
<span id="cb315-6"><a href="longitudinal-cohort-study-designs.html#cb315-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">period =</span> <span class="fu">as_factor</span>(period),</span>
<span id="cb315-7"><a href="longitudinal-cohort-study-designs.html#cb315-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">death =</span> <span class="fu">as_factor</span>(death),</span>
<span id="cb315-8"><a href="longitudinal-cohort-study-designs.html#cb315-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">timey =</span> time <span class="sc">/</span> <span class="fl">365.25</span>,                  <span class="co"># Convert from days to years</span></span>
<span id="cb315-9"><a href="longitudinal-cohort-study-designs.html#cb315-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">timedthy =</span> timedth <span class="sc">/</span> <span class="fl">365.25</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb315-10"><a href="longitudinal-cohort-study-designs.html#cb315-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb315-11"><a href="longitudinal-cohort-study-designs.html#cb315-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">xend =</span> timedthy, </span>
<span id="cb315-12"><a href="longitudinal-cohort-study-designs.html#cb315-12" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> randid, <span class="at">yend =</span> randid), <span class="at">color =</span> <span class="st">&quot;lightgray&quot;</span>) <span class="sc">+</span> </span>
<span id="cb315-13"><a href="longitudinal-cohort-study-designs.html#cb315-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> timedthy, <span class="at">y =</span> randid, <span class="at">fill =</span> death), <span class="at">shape =</span> <span class="dv">22</span>) <span class="sc">+</span> </span>
<span id="cb315-14"><a href="longitudinal-cohort-study-designs.html#cb315-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> timey, <span class="at">y =</span> randid, <span class="at">color =</span> period)) <span class="sc">+</span> </span>
<span id="cb315-15"><a href="longitudinal-cohort-study-designs.html#cb315-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span> </span>
<span id="cb315-16"><a href="longitudinal-cohort-study-designs.html#cb315-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Time since first examination (years)&quot;</span>, </span>
<span id="cb315-17"><a href="longitudinal-cohort-study-designs.html#cb315-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Patient ID&quot;</span>, </span>
<span id="cb315-18"><a href="longitudinal-cohort-study-designs.html#cb315-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">&quot;Examination</span><span class="sc">\n</span><span class="st">period&quot;</span>) <span class="sc">+</span></span>
<span id="cb315-19"><a href="longitudinal-cohort-study-designs.html#cb315-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">&quot;&quot;</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;white&quot;</span>, <span class="st">&quot;black&quot;</span>), </span>
<span id="cb315-20"><a href="longitudinal-cohort-study-designs.html#cb315-20" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Survived</span><span class="sc">\n</span><span class="st">follow-up&quot;</span>, <span class="st">&quot;Died during</span><span class="sc">\n</span><span class="st">follow-up&quot;</span>))</span></code></pre></div>
<p><img src="adv_epi_analysis_files/figure-html/unnamed-chunk-167-1.png" width="672" /></p>
<p>You can see that we have at least one examination (period 1) for each of the study subjects, and for some we have as many as three. One of these study subjects was tracked for almost 25 years without a recorded death (subject ID 9789948). All the other subjects in this subset died during follow-up. Some died within a few years of the first examination, and so did not survive to a second or later examination. Others survived longer but missed some later examinations.
As you work with these data, keep in mind that they have multiple measurements (rows) for some but not all of the study subjects, and that events are recorded both in terms of whether they happened during follow-up (e.g., <code>death</code>) and also how long after the first examination the event occurred or the data for the subject was censored (e.g., <code>timedth</code>).</p>
<p><em>Applied exercise: Exploring longitudinal cohort data</em></p>
<p>Read the example cohort data in R and explore it to answer the following
questions:</p>
<ol style="list-style-type: decimal">
<li>What is the number of participants and number of observations in the <code>fhs</code> dataset?</li>
<li>Is there any missingness in the data?</li>
<li>How many participants died during the observation period? What is the distribution of age at time of death?</li>
<li>What is the distribution of BMI among MI cases and non-cases? How about between smokers and non-smokers?</li>
</ol>
<p>Based on this exploratory exercise, talk about the potential
for confounding when these data are analyzed to estimate the association between
smoking and risk of incident MI.</p>
<p><em>Applied exercise: Example code</em></p>
<ol style="list-style-type: decimal">
<li><strong>What is the number of participants and the number of observations in the <code>fhs</code> dataset? (i.e what is the sample size and number of person-time observations)</strong></li>
</ol>
<p>In the <code>fhs</code> dataset, the number of participants will be equal to the number of unique ID’s (The <code>RANDID</code> variable which takes a unique value for each participant). We can extract this using the <code>unique</code> function nested within the <code>length</code> function</p>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb316-1"><a href="longitudinal-cohort-study-designs.html#cb316-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">unique</span>(fhs<span class="sc">$</span>randid))</span></code></pre></div>
<pre><code>## [1] 4434</code></pre>
<p>If you’d like to use <code>tidyverse</code> tools to answer this question, you can do
that, as well. The pipe operator (<code>%&gt;%</code>) works on any type of object—it will
take your current output and include it as the first parameter value for the
function call you pipe into. If you want to perform operations on a column of
a dataframe, you can use <code>pull</code> to extract it from the dataframe as a vector, and
then pipe that into vector operations:</p>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb318-1"><a href="longitudinal-cohort-study-designs.html#cb318-1" aria-hidden="true" tabindex="-1"></a>fhs <span class="sc">%&gt;%</span> </span>
<span id="cb318-2"><a href="longitudinal-cohort-study-designs.html#cb318-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(randid) <span class="sc">%&gt;%</span> </span>
<span id="cb318-3"><a href="longitudinal-cohort-study-designs.html#cb318-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb318-4"><a href="longitudinal-cohort-study-designs.html#cb318-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">length</span>()</span></code></pre></div>
<pre><code>## [1] 4434</code></pre>
<p>It’s entirely a personal choice whether you use the <code>$</code> operator and “nesting”
of function calls, versus <code>pull</code> and piping to do a series of function calls.
You can see you get the same result, so it just comes down to the style that
you will find easiest to understand when you look at your code later.</p>
<p>The number of person-time observations will be equal to the length of the dataset, since there’s a row for every observation taken.
The <code>dim</code> function gives us the length (number of rows) and width (number of columns) for a dataframe or any matrix like object in R.</p>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="longitudinal-cohort-study-designs.html#cb320-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(fhs)</span></code></pre></div>
<pre><code>## [1] 11627    39</code></pre>
<p>We see that there are 11,626 observations, which is an average of approximately 2 to 3 observations per participant (11,626 / 4,434 = 2.6).</p>
<p>When you know there are repeated measurements, it can be helpful to explore
how much variation there is in the number of observations per study subject.
You could do that in this dataset with the following code:</p>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="longitudinal-cohort-study-designs.html#cb322-1" aria-hidden="true" tabindex="-1"></a>fhs <span class="sc">%&gt;%</span> </span>
<span id="cb322-2"><a href="longitudinal-cohort-study-designs.html#cb322-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Group by the study subject identifier and then count the rows for each</span></span>
<span id="cb322-3"><a href="longitudinal-cohort-study-designs.html#cb322-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(randid) <span class="sc">%&gt;%</span> </span>
<span id="cb322-4"><a href="longitudinal-cohort-study-designs.html#cb322-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb322-5"><a href="longitudinal-cohort-study-designs.html#cb322-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Reorder the dataset so the subjects with the most observations come first</span></span>
<span id="cb322-6"><a href="longitudinal-cohort-study-designs.html#cb322-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n)) <span class="sc">%&gt;%</span> </span>
<span id="cb322-7"><a href="longitudinal-cohort-study-designs.html#cb322-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 x 2
## # Groups:   randid [6]
##   randid     n
##    &lt;dbl&gt; &lt;int&gt;
## 1   6238     3
## 2  11252     3
## 3  11263     3
## 4  12806     3
## 5  14367     3
## 6  16365     3</code></pre>
<p>You can visualize this, as well. A histogram is one good choice:</p>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb324-1"><a href="longitudinal-cohort-study-designs.html#cb324-1" aria-hidden="true" tabindex="-1"></a>fhs <span class="sc">%&gt;%</span> </span>
<span id="cb324-2"><a href="longitudinal-cohort-study-designs.html#cb324-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Group by the study subject identifier and then count the rows for each</span></span>
<span id="cb324-3"><a href="longitudinal-cohort-study-designs.html#cb324-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(randid) <span class="sc">%&gt;%</span> </span>
<span id="cb324-4"><a href="longitudinal-cohort-study-designs.html#cb324-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb324-5"><a href="longitudinal-cohort-study-designs.html#cb324-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> n)) <span class="sc">+</span> </span>
<span id="cb324-6"><a href="longitudinal-cohort-study-designs.html#cb324-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>()</span></code></pre></div>
<p><img src="adv_epi_analysis_files/figure-html/unnamed-chunk-172-1.png" width="672" /></p>
<p>All study subjects have between one and three measurements. Most of the study
subjects (over 3,000) have three measurements recorded in the dataset.</p>
<ol start="2" style="list-style-type: decimal">
<li><strong>Is there any missingness in the data?</strong></li>
</ol>
<p>We can check for missingness in a number of ways. There are a couple of great
packages, <code>visdat</code> and <code>naniar</code>, that include functions for investigating
missingness in a dataset. If you don’t have these installed, you can install
them using <code>install.packages("naniar")</code> and <code>install.packages("visdat")</code>. The
<code>naniar</code> package has <a href="https://cran.r-project.org/web/packages/naniar/vignettes/getting-started-w-naniar.html">a vignette with
examples</a>
that is a nice starting point for working with both packages.</p>
<p>The <code>vis_miss</code> function from the <code>visdat</code> package shows missingness in a dataset in a way that lets you
get a top-level snapshot:</p>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb325-1"><a href="longitudinal-cohort-study-designs.html#cb325-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(visdat)</span>
<span id="cb325-2"><a href="longitudinal-cohort-study-designs.html#cb325-2" aria-hidden="true" tabindex="-1"></a><span class="fu">vis_miss</span>(fhs)</span></code></pre></div>
<p><img src="adv_epi_analysis_files/figure-html/unnamed-chunk-173-1.png" width="672" /></p>
<p>This shows you how much data is missing for each column in the data. For a smaller dataset, the design of the plot would also let you see how often missing data line up across several columns for the same observation (in other words, if an observation that’s missing one measurement tends to also be missing several other measurements). In this case, however, there are so many rows, it’s a bit hard to visually line up missingness by row.</p>
<p>Another was to visualize this is with <code>gg_miss_var</code> from the <code>naniar</code> package:</p>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb326-1"><a href="longitudinal-cohort-study-designs.html#cb326-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(naniar)</span>
<span id="cb326-2"><a href="longitudinal-cohort-study-designs.html#cb326-2" aria-hidden="true" tabindex="-1"></a><span class="fu">gg_miss_var</span>(fhs)</span></code></pre></div>
<p><img src="adv_epi_analysis_files/figure-html/unnamed-chunk-174-1.png" width="672" /></p>
<p>This output again focuses on missingness by column in the data, helping you identify columns where we might not have many non-missing observations.
In this case, many of the columns have measurements that are available for all observations, with no missingness,
including records of the subject’s ID, measures of death, stroke, CVD and other
events, age, sex, and BMI. Some of the measured values from visits are missing
occasionally, like the total cholesterol, and glucose. Other measures asked of
the participants (number of cigarettes per day, education) are occasionally
missing. Two of the variables—<code>hdlc</code> and <code>ldlc</code> (High Density Lipoprotein Cholesterol and Low Density Lipoprotein Cholesterol, respectively)—are missing more often than
they are available. If you read the codebook for the data, you’ll see that this is because these measurements are only available at time period 3.</p>
<p>You can also do faceting with the <code>gg_miss_var</code> function. For
example, you could see if missingness varies by the period of the observation:</p>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb327-1"><a href="longitudinal-cohort-study-designs.html#cb327-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gg_miss_var</span>(fhs, <span class="at">facet =</span> period)</span></code></pre></div>
<p><img src="adv_epi_analysis_files/figure-html/unnamed-chunk-175-1.png" width="672" /></p>
<p>You may also want to check if missingness varies with whether an observation
was associated with death of the study subject:</p>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb328-1"><a href="longitudinal-cohort-study-designs.html#cb328-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gg_miss_var</span>(fhs, <span class="at">facet =</span> death)</span></code></pre></div>
<p><img src="adv_epi_analysis_files/figure-html/unnamed-chunk-176-1.png" width="672" /></p>
<p>There are also functions in these packages that allow you to look at how
missingness is related across variables. For example, both <code>glucose</code> and
<code>totchol</code> are continuous variables, and both are occasionally missing. You
can use the geom function <code>geom_miss_point</code> from the <code>naniar</code> package
with a ggplot object to explore patterns of missingness among these two
variables:</p>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="longitudinal-cohort-study-designs.html#cb329-1" aria-hidden="true" tabindex="-1"></a>fhs <span class="sc">%&gt;%</span> </span>
<span id="cb329-2"><a href="longitudinal-cohort-study-designs.html#cb329-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> glucose, <span class="at">y =</span> totchol)) <span class="sc">+</span> </span>
<span id="cb329-3"><a href="longitudinal-cohort-study-designs.html#cb329-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_miss_point</span>()</span></code></pre></div>
<p><img src="adv_epi_analysis_files/figure-html/unnamed-chunk-177-1.png" width="672" /></p>
<p>The lower left corner shows the observations where both values are missing—it
looks like there aren’t too many. For observations with one missing but not the
other (the points in red along the x- and y-axes), it looks like the distribution
across the non-missing variable is pretty similar to that for observations
with both measurements available. In other words, <code>totchol</code> has a similar
distribution among observations where <code>glucose</code> is available as observations
where <code>glucose</code> is missing, and the same for <code>glucose</code> for observations with and without missingess for <code>totchol</code>.</p>
<p>Since this function interfaces with <code>ggplot</code>, you can use any usual tricks with ggplot in association with it. For example, you can do things like facet by sex to explore patterns of missingness and codistribution at a finer level:</p>
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb330-1"><a href="longitudinal-cohort-study-designs.html#cb330-1" aria-hidden="true" tabindex="-1"></a>fhs <span class="sc">%&gt;%</span> </span>
<span id="cb330-2"><a href="longitudinal-cohort-study-designs.html#cb330-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> glucose, <span class="at">y =</span> totchol)) <span class="sc">+</span> </span>
<span id="cb330-3"><a href="longitudinal-cohort-study-designs.html#cb330-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_miss_point</span>() <span class="sc">+</span> </span>
<span id="cb330-4"><a href="longitudinal-cohort-study-designs.html#cb330-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> sex)</span></code></pre></div>
<p><img src="adv_epi_analysis_files/figure-html/unnamed-chunk-178-1.png" width="672" /></p>
<ol start="3" style="list-style-type: decimal">
<li><strong>How many participants died during the observation period? What is the distribution of age at time of death?</strong></li>
</ol>
<p>The <code>death</code> variable in the <code>fhs</code> data is an indicator for mortality if a participant died at any point during follow-up. It is time-invariant: that is, it takes the value 1 if a participant died at any point during the follow-up period or 0 if they were alive at their end of follow-up, so we have to be careful on how to extract the actual number of deaths.</p>
<p>If you arrange by the random ID and look at <code>period</code> and <code>death</code> for each subject,
you can see that the <code>death</code> variable is the same for all periods for each
subject (this is what we mean by it being “time-invariant” in the data):</p>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="longitudinal-cohort-study-designs.html#cb331-1" aria-hidden="true" tabindex="-1"></a>fhs <span class="sc">%&gt;%</span> </span>
<span id="cb331-2"><a href="longitudinal-cohort-study-designs.html#cb331-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(randid) <span class="sc">%&gt;%</span> </span>
<span id="cb331-3"><a href="longitudinal-cohort-study-designs.html#cb331-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(randid, period, death)</span></code></pre></div>
<pre><code>## # A tibble: 11,627 x 3
##    randid period death
##     &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
##  1   2448      1     0
##  2   2448      3     0
##  3   6238      1     0
##  4   6238      2     0
##  5   6238      3     0
##  6   9428      1     0
##  7   9428      2     0
##  8  10552      1     1
##  9  10552      2     1
## 10  11252      1     0
## # … with 11,617 more rows</code></pre>
<p>We need to think some about this convention of recording the data when we count
the deaths.</p>
<p>It is often useful to extract the first (and sometimes last) observation, in order to assess certain covariate statistics on the individual level. We can create a dataset including only the first (or last) observation per participant from the <code>fhs</code> data using <code>tidyverse</code> tools. The <code>group_by</code> functions groups data by unique values of designated variables (here <code>randid</code>) and the <code>slice</code> function selects rows as designated. Here is an example of extracting the first row (<code>group_by(randid) %&gt;% slice(1L)</code>) for each study subject:</p>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="longitudinal-cohort-study-designs.html#cb333-1" aria-hidden="true" tabindex="-1"></a>fhs_first <span class="ot">&lt;-</span> fhs <span class="sc">%&gt;%</span> </span>
<span id="cb333-2"><a href="longitudinal-cohort-study-designs.html#cb333-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(randid) <span class="sc">%&gt;%</span> </span>
<span id="cb333-3"><a href="longitudinal-cohort-study-designs.html#cb333-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(1L) <span class="sc">%&gt;%</span> <span class="co"># The L after the one clarifies that this is an integer</span></span>
<span id="cb333-4"><a href="longitudinal-cohort-study-designs.html#cb333-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb333-5"><a href="longitudinal-cohort-study-designs.html#cb333-5" aria-hidden="true" tabindex="-1"></a>fhs_first</span></code></pre></div>
<pre><code>## # A tibble: 4,434 x 39
##    randid   sex totchol   age sysbp diabp cursmoke cigpday   bmi diabetes bpmeds
##     &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;
##  1   2448     1     195    39  106     70        0       0  27.0        0      0
##  2   6238     2     250    46  121     81        0       0  28.7        0      0
##  3   9428     1     245    48  128.    80        1      20  25.3        0      0
##  4  10552     2     225    61  150     95        1      30  28.6        0      0
##  5  11252     2     285    46  130     84        1      23  23.1        0      0
##  6  11263     2     228    43  180    110        0       0  30.3        0      0
##  7  12629     2     205    63  138     71        0       0  33.1        0      0
##  8  12806     2     313    45  100     71        1      20  21.7        0      0
##  9  14367     1     260    52  142.    89        0       0  26.4        0      0
## 10  16365     1     225    43  162    107        1      30  23.6        0      0
## # … with 4,424 more rows, and 28 more variables: heartrte &lt;dbl&gt;, glucose &lt;dbl&gt;,
## #   educ &lt;dbl&gt;, prevchd &lt;dbl&gt;, prevap &lt;dbl&gt;, prevmi &lt;dbl&gt;, prevstrk &lt;dbl&gt;,
## #   prevhyp &lt;dbl&gt;, time &lt;dbl&gt;, period &lt;dbl&gt;, hdlc &lt;dbl&gt;, ldlc &lt;dbl&gt;,
## #   death &lt;dbl&gt;, angina &lt;dbl&gt;, hospmi &lt;dbl&gt;, mi_fchd &lt;dbl&gt;, anychd &lt;dbl&gt;,
## #   stroke &lt;dbl&gt;, cvd &lt;dbl&gt;, hyperten &lt;dbl&gt;, timeap &lt;dbl&gt;, timemi &lt;dbl&gt;,
## #   timemifc &lt;dbl&gt;, timechd &lt;dbl&gt;, timestrk &lt;dbl&gt;, timecvd &lt;dbl&gt;,
## #   timedth &lt;dbl&gt;, timehyp &lt;dbl&gt;</code></pre>
<p>Alternatively you can use the <code>slice_head</code> function, which allows us to slice a designated number of rows beginning from the first observation. Because we are piping this in the <code>group_by</code> function, we will be slicing rows beginning from the first observation for each <code>randid</code>:</p>
<div class="sourceCode" id="cb335"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb335-1"><a href="longitudinal-cohort-study-designs.html#cb335-1" aria-hidden="true" tabindex="-1"></a>fhs_first <span class="ot">&lt;-</span> fhs <span class="sc">%&gt;%</span> </span>
<span id="cb335-2"><a href="longitudinal-cohort-study-designs.html#cb335-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(randid) <span class="sc">%&gt;%</span> </span>
<span id="cb335-3"><a href="longitudinal-cohort-study-designs.html#cb335-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb335-4"><a href="longitudinal-cohort-study-designs.html#cb335-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
<p>We can similarly select the last observation for each participant:</p>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb336-1"><a href="longitudinal-cohort-study-designs.html#cb336-1" aria-hidden="true" tabindex="-1"></a>fhs_last <span class="ot">&lt;-</span> fhs <span class="sc">%&gt;%</span> </span>
<span id="cb336-2"><a href="longitudinal-cohort-study-designs.html#cb336-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(randid) <span class="sc">%&gt;%</span> </span>
<span id="cb336-3"><a href="longitudinal-cohort-study-designs.html#cb336-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="fu">n</span>()) <span class="sc">%&gt;%</span> <span class="co"># The `n()` function gives the count of rows in a group </span></span>
<span id="cb336-4"><a href="longitudinal-cohort-study-designs.html#cb336-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb336-5"><a href="longitudinal-cohort-study-designs.html#cb336-5" aria-hidden="true" tabindex="-1"></a>fhs_last</span></code></pre></div>
<pre><code>## # A tibble: 4,434 x 39
##    randid   sex totchol   age sysbp diabp cursmoke cigpday   bmi diabetes bpmeds
##     &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;
##  1   2448     1     209    52   121    66        0       0  NA          0      0
##  2   6238     2     237    58   108    66        0       0  28.5        0      0
##  3   9428     1     283    54   141    89        1      30  25.3        0      0
##  4  10552     2     232    67   183   109        1      20  30.2        0      0
##  5  11252     2      NA    58   155    90        1      30  24.6        0      0
##  6  11263     2     220    55   180   106        0       0  31.2        1      1
##  7  12629     2     220    70   149    81        0       0  36.8        0      0
##  8  12806     2     320    57   110    46        1      30  22.0        0      0
##  9  14367     1     280    64   168   100        0       0  25.7        0      0
## 10  16365     1     211    55   173   123        0       0  29.1        0      1
## # … with 4,424 more rows, and 28 more variables: heartrte &lt;dbl&gt;, glucose &lt;dbl&gt;,
## #   educ &lt;dbl&gt;, prevchd &lt;dbl&gt;, prevap &lt;dbl&gt;, prevmi &lt;dbl&gt;, prevstrk &lt;dbl&gt;,
## #   prevhyp &lt;dbl&gt;, time &lt;dbl&gt;, period &lt;dbl&gt;, hdlc &lt;dbl&gt;, ldlc &lt;dbl&gt;,
## #   death &lt;dbl&gt;, angina &lt;dbl&gt;, hospmi &lt;dbl&gt;, mi_fchd &lt;dbl&gt;, anychd &lt;dbl&gt;,
## #   stroke &lt;dbl&gt;, cvd &lt;dbl&gt;, hyperten &lt;dbl&gt;, timeap &lt;dbl&gt;, timemi &lt;dbl&gt;,
## #   timemifc &lt;dbl&gt;, timechd &lt;dbl&gt;, timestrk &lt;dbl&gt;, timecvd &lt;dbl&gt;,
## #   timedth &lt;dbl&gt;, timehyp &lt;dbl&gt;</code></pre>
<p>or using the <code>slice_tail</code> function:</p>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb338-1"><a href="longitudinal-cohort-study-designs.html#cb338-1" aria-hidden="true" tabindex="-1"></a>fhs_last <span class="ot">&lt;-</span> fhs <span class="sc">%&gt;%</span> </span>
<span id="cb338-2"><a href="longitudinal-cohort-study-designs.html#cb338-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(randid) <span class="sc">%&gt;%</span> </span>
<span id="cb338-3"><a href="longitudinal-cohort-study-designs.html#cb338-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_tail</span>(<span class="at">n =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb338-4"><a href="longitudinal-cohort-study-designs.html#cb338-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
<p>In this dataset we can extract statistics on baseline covariates (i.e., at the first examination) on the individual level, but also assess the number of participants with specific values, including <code>death = 1</code>. For example, we can use the <code>sum</code> function in base R, which generates the sum of all values for a given vector. In this case since each death has the value of 1, the <code>sum</code> function will give us the number of deaths in the sample.</p>
<div class="sourceCode" id="cb339"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb339-1"><a href="longitudinal-cohort-study-designs.html#cb339-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(fhs_first<span class="sc">$</span>death) </span></code></pre></div>
<pre><code>## [1] 1550</code></pre>
<p>Conversely using <code>tidyverse</code> tools we can extract the number of observations with <code>death = 1</code> using the <code>count</code> function:</p>
<div class="sourceCode" id="cb341"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb341-1"><a href="longitudinal-cohort-study-designs.html#cb341-1" aria-hidden="true" tabindex="-1"></a>fhs_first <span class="sc">%&gt;%</span> </span>
<span id="cb341-2"><a href="longitudinal-cohort-study-designs.html#cb341-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(death) </span></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   death     n
## * &lt;dbl&gt; &lt;int&gt;
## 1     0  2884
## 2     1  1550</code></pre>
<p>Based on this analysis, 1,550 of the study subjects, or about 35% of them, died during follow-up for this study.</p>
<p>Note that, unlike in this sample data, in many datasets with longitudinal cohort data, survival or time-to-event outcomes will be recorded using time-varying conventions. For example, a variable for mortality will take the value of zero until the person-time observation that represents the time interval that the outcome actually happens in. For outcomes such as mortality this will typically be the last observation (since the subject won’t be tracked after death). In those cases, it will be important to take the last observation for each subject to count the number of deaths; for this dataset, we’ve got more flexibility since they use time-invariant recording conventions for outcomes like death.</p>
<p>In order to estimate the distribution of age at death among those participants who died during follow-up we need to create a new age at death variable. First, we don’t know the age at death of any study subjects who died after follow-up (which could be the end of the study or when they were lost to follow-up). Therefore, when we calculate, we should filter the dataset to only include subjects who died during follow-up (<code>filter(death == 1)</code> a bit later in the code).</p>
<p>Next, we need to use information in the dataset to calculate the age at the time of death for the study subjects who died during follow-up.
The <code>age</code> variable in <code>fhs</code> represents the participant’s age at each visit. Typically a death would happen between visits so the last recorded value for <code>age</code> would be less than the age at death. We will instead use the <code>timedth</code> variable to help us determine the actual age at death. The value of <code>timedth</code> is the number of days from beginning of follow-up until death for those with <code>death = 1</code>, while it is a fixed value of <code>timedth = 8766</code> (the maximum duration of follow-up) for those with <code>death = 0</code> (did not die during follow-up).</p>
<p>We can create a new age at death variable for those with <code>death = 1</code> using the <code>age</code> at baseline and <code>timedth</code> values:</p>
<div class="sourceCode" id="cb343"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb343-1"><a href="longitudinal-cohort-study-designs.html#cb343-1" aria-hidden="true" tabindex="-1"></a>fhs_first <span class="ot">&lt;-</span> fhs_first <span class="sc">%&gt;%</span> </span>
<span id="cb343-2"><a href="longitudinal-cohort-study-designs.html#cb343-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">timedthy =</span> timedth <span class="sc">/</span> <span class="fl">365.25</span>, <span class="co"># time-to-death in years</span></span>
<span id="cb343-3"><a href="longitudinal-cohort-study-designs.html#cb343-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">agedth =</span> age <span class="sc">+</span> timedthy) </span>
<span id="cb343-4"><a href="longitudinal-cohort-study-designs.html#cb343-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb343-5"><a href="longitudinal-cohort-study-designs.html#cb343-5" aria-hidden="true" tabindex="-1"></a>fhs_first </span></code></pre></div>
<pre><code>## # A tibble: 4,434 x 41
##    randid   sex totchol   age sysbp diabp cursmoke cigpday   bmi diabetes bpmeds
##     &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;
##  1   2448     1     195    39  106     70        0       0  27.0        0      0
##  2   6238     2     250    46  121     81        0       0  28.7        0      0
##  3   9428     1     245    48  128.    80        1      20  25.3        0      0
##  4  10552     2     225    61  150     95        1      30  28.6        0      0
##  5  11252     2     285    46  130     84        1      23  23.1        0      0
##  6  11263     2     228    43  180    110        0       0  30.3        0      0
##  7  12629     2     205    63  138     71        0       0  33.1        0      0
##  8  12806     2     313    45  100     71        1      20  21.7        0      0
##  9  14367     1     260    52  142.    89        0       0  26.4        0      0
## 10  16365     1     225    43  162    107        1      30  23.6        0      0
## # … with 4,424 more rows, and 30 more variables: heartrte &lt;dbl&gt;, glucose &lt;dbl&gt;,
## #   educ &lt;dbl&gt;, prevchd &lt;dbl&gt;, prevap &lt;dbl&gt;, prevmi &lt;dbl&gt;, prevstrk &lt;dbl&gt;,
## #   prevhyp &lt;dbl&gt;, time &lt;dbl&gt;, period &lt;dbl&gt;, hdlc &lt;dbl&gt;, ldlc &lt;dbl&gt;,
## #   death &lt;dbl&gt;, angina &lt;dbl&gt;, hospmi &lt;dbl&gt;, mi_fchd &lt;dbl&gt;, anychd &lt;dbl&gt;,
## #   stroke &lt;dbl&gt;, cvd &lt;dbl&gt;, hyperten &lt;dbl&gt;, timeap &lt;dbl&gt;, timemi &lt;dbl&gt;,
## #   timemifc &lt;dbl&gt;, timechd &lt;dbl&gt;, timestrk &lt;dbl&gt;, timecvd &lt;dbl&gt;,
## #   timedth &lt;dbl&gt;, timehyp &lt;dbl&gt;, timedthy &lt;dbl&gt;, agedth &lt;dbl&gt;</code></pre>
<p>We can then get summary statistics on this new variable, filtering down to only the observations where death occurs during follow-up (this means that we’re only calculating average age at death among those who died during follow-up—see the note at the end of this section related to that):</p>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb345-1"><a href="longitudinal-cohort-study-designs.html#cb345-1" aria-hidden="true" tabindex="-1"></a>fhs_first <span class="sc">%&gt;%</span> </span>
<span id="cb345-2"><a href="longitudinal-cohort-study-designs.html#cb345-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(death <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb345-3"><a href="longitudinal-cohort-study-designs.html#cb345-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">min_agedth =</span> <span class="fu">min</span>(agedth),</span>
<span id="cb345-4"><a href="longitudinal-cohort-study-designs.html#cb345-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_agedth =</span> <span class="fu">mean</span>(agedth),</span>
<span id="cb345-5"><a href="longitudinal-cohort-study-designs.html#cb345-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">max_agedth =</span> <span class="fu">max</span>(agedth),</span>
<span id="cb345-6"><a href="longitudinal-cohort-study-designs.html#cb345-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">missing_agedth =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(agedth)))</span></code></pre></div>
<pre><code>## # A tibble: 1 x 4
##   min_agedth mean_agedth max_agedth missing_agedth
##        &lt;dbl&gt;       &lt;dbl&gt;      &lt;dbl&gt;          &lt;int&gt;
## 1       38.4        69.1       91.1              0</code></pre>
<p>The earliest death was at 38 years and the latest at 91, among deaths that occurred during follow-up. On average, subjects who died during follow-up for this study died when they were about 69 years old. There were no missing ages for study subjects who died during follow-up.</p>
<p>We can also check on these values by groups of interest such as sex:</p>
<div class="sourceCode" id="cb347"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb347-1"><a href="longitudinal-cohort-study-designs.html#cb347-1" aria-hidden="true" tabindex="-1"></a>fhs_first <span class="sc">%&gt;%</span></span>
<span id="cb347-2"><a href="longitudinal-cohort-study-designs.html#cb347-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(death <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb347-3"><a href="longitudinal-cohort-study-designs.html#cb347-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sex) <span class="sc">%&gt;%</span></span>
<span id="cb347-4"><a href="longitudinal-cohort-study-designs.html#cb347-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">min_agedth =</span> <span class="fu">min</span>(agedth),</span>
<span id="cb347-5"><a href="longitudinal-cohort-study-designs.html#cb347-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_agedth =</span> <span class="fu">mean</span>(agedth),</span>
<span id="cb347-6"><a href="longitudinal-cohort-study-designs.html#cb347-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">max_agedth =</span> <span class="fu">max</span>(agedth))</span></code></pre></div>
<pre><code>## # A tibble: 2 x 4
##     sex min_agedth mean_agedth max_agedth
## * &lt;dbl&gt;      &lt;dbl&gt;       &lt;dbl&gt;      &lt;dbl&gt;
## 1     1       41.6        68.6       91.1
## 2     2       38.4        69.6       90.0</code></pre>
<p>Of course, it’s important to remember that these are summaries of the age at death <em>only</em> for the study subjects who died during follow-up. The mean age at death will be different across all our study subjects, but we don’t have the information about age at death for those who died after censoring to include in calculating our summary statistics here. It is likely that they lived to older ages, if the most common reason for censoring is outliving follow-up. However, if they were censored because they dropped out of the cohort, then that might instead be associated with either longer or shorter average lifespans, in which case we don’t have a great idea of which direction the average age of death would move if they were included. One thing that you could do is to average the age at either death or loss to follow-up—this would give you a lower bound on the average across the whole population, since you know that those who were censored survived to <em>at least</em> the age they were when they were censored.</p>
<ol start="4" style="list-style-type: decimal">
<li><strong>What is the distribution of BMI among MI cases and non-cases? How about between smokers and non-smokers</strong></li>
</ol>
<p>Both BMI and smoking are recorded in a time-variant way; that is, their value can differ between different examinations for the same study subject. For example, you can look at a couple of study subjects:</p>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb349-1"><a href="longitudinal-cohort-study-designs.html#cb349-1" aria-hidden="true" tabindex="-1"></a>fhs <span class="sc">%&gt;%</span> </span>
<span id="cb349-2"><a href="longitudinal-cohort-study-designs.html#cb349-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(randid <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">6238</span>, <span class="dv">16365</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb349-3"><a href="longitudinal-cohort-study-designs.html#cb349-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(randid, period, bmi, cursmoke)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 4
##   randid period   bmi cursmoke
##    &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;
## 1   6238      1  28.7        0
## 2   6238      2  29.4        0
## 3   6238      3  28.5        0
## 4  16365      1  23.6        1
## 5  16365      2  27.5        0
## 6  16365      3  29.1        0</code></pre>
<p>For the study subject with ID 6238, BMI changed a little bit across the three examinations, but not much, and the person remained a non-smoker. For the study subject with ID 16365, BMI increased steady across the examinations, and the person stopped smoking sometime after the first examination.</p>
<p>We will need to think about how to handle these variant values while we compare them to the invariant outcome (whether the subject was hospitalized for MI during follow-up). One thing that we could do is to see the association between average BMI for each study subject and whether they had a hospitalized MI event during follow-up:</p>
<div class="sourceCode" id="cb351"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb351-1"><a href="longitudinal-cohort-study-designs.html#cb351-1" aria-hidden="true" tabindex="-1"></a>bmi_vs_mi <span class="ot">&lt;-</span> fhs <span class="sc">%&gt;%</span> </span>
<span id="cb351-2"><a href="longitudinal-cohort-study-designs.html#cb351-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(randid) <span class="sc">%&gt;%</span> </span>
<span id="cb351-3"><a href="longitudinal-cohort-study-designs.html#cb351-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">bmi =</span> <span class="fu">mean</span>(bmi, <span class="at">rm.na =</span> <span class="cn">TRUE</span>), </span>
<span id="cb351-4"><a href="longitudinal-cohort-study-designs.html#cb351-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">hospmi =</span> <span class="fu">first</span>(hospmi))</span>
<span id="cb351-5"><a href="longitudinal-cohort-study-designs.html#cb351-5" aria-hidden="true" tabindex="-1"></a>bmi_vs_mi</span></code></pre></div>
<pre><code>## # A tibble: 4,434 x 3
##    randid   bmi hospmi
##  *  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
##  1   2448  NA        1
##  2   6238  28.9      0
##  3   9428  25.3      0
##  4  10552  29.4      0
##  5  11252  23.7      0
##  6  11263  30.9      0
##  7  12629  34.9      0
##  8  12806  22.0      0
##  9  14367  25.8      0
## 10  16365  26.7      0
## # … with 4,424 more rows</code></pre>
<p>Now we can compare the distribution of these average BMIs among study subjects who did and did not have a hospitalization for MI during follow-up. A simple was is by creating some summaries:</p>
<div class="sourceCode" id="cb353"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb353-1"><a href="longitudinal-cohort-study-designs.html#cb353-1" aria-hidden="true" tabindex="-1"></a>bmi_vs_mi <span class="sc">%&gt;%</span> </span>
<span id="cb353-2"><a href="longitudinal-cohort-study-designs.html#cb353-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(hospmi) <span class="sc">%&gt;%</span> </span>
<span id="cb353-3"><a href="longitudinal-cohort-study-designs.html#cb353-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">perc_25 =</span> <span class="fu">quantile</span>(bmi, <span class="fl">0.25</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb353-4"><a href="longitudinal-cohort-study-designs.html#cb353-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean =</span> <span class="fu">mean</span>(bmi, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb353-5"><a href="longitudinal-cohort-study-designs.html#cb353-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">median =</span> <span class="fu">median</span>(bmi, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb353-6"><a href="longitudinal-cohort-study-designs.html#cb353-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">perc_75 =</span> <span class="fu">quantile</span>(bmi, <span class="fl">0.75</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<pre><code>## # A tibble: 2 x 5
##   hospmi perc_25  mean median perc_75
## *  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
## 1      0    23.1  25.8   25.4    28.0
## 2      1    24.0  26.5   26.2    28.5</code></pre>
<p>We can also create a plot to help explore this question:</p>
<div class="sourceCode" id="cb355"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb355-1"><a href="longitudinal-cohort-study-designs.html#cb355-1" aria-hidden="true" tabindex="-1"></a>bmi_vs_mi <span class="sc">%&gt;%</span> </span>
<span id="cb355-2"><a href="longitudinal-cohort-study-designs.html#cb355-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> bmi)) <span class="sc">+</span> </span>
<span id="cb355-3"><a href="longitudinal-cohort-study-designs.html#cb355-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>() <span class="sc">+</span> </span>
<span id="cb355-4"><a href="longitudinal-cohort-study-designs.html#cb355-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> hospmi, <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">scale =</span> <span class="st">&quot;free_y&quot;</span>)</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<pre><code>## Warning: Removed 44 rows containing non-finite values (stat_bin).</code></pre>
<p><img src="adv_epi_analysis_files/figure-html/unnamed-chunk-192-1.png" width="672" /></p>
<p>There is not a dramatic difference between the two groups in terms of the distribution of BMI.</p>
<p>We might want to check how stable BMI tends to be within each study subject, and check variation in BMI within subjects (at different timepoints) compared to between subjects, to see if the average might be a reasonable summary of BMI for a study subject. We can check this within just the study subjects with three examinations and without any missing measures of BMI at those examinations. We can check it with a random sample of 20 subjects (since this uses <code>sample</code>, the sample you get, and so the plot, will likely be different):</p>
<div class="sourceCode" id="cb358"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb358-1"><a href="longitudinal-cohort-study-designs.html#cb358-1" aria-hidden="true" tabindex="-1"></a>sample_check <span class="ot">&lt;-</span> fhs <span class="sc">%&gt;%</span> </span>
<span id="cb358-2"><a href="longitudinal-cohort-study-designs.html#cb358-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(randid) <span class="sc">%&gt;%</span> </span>
<span id="cb358-3"><a href="longitudinal-cohort-study-designs.html#cb358-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">max</span>(period <span class="sc">==</span> <span class="dv">3</span>) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">anyNA</span>(bmi)) <span class="sc">%&gt;%</span> </span>
<span id="cb358-4"><a href="longitudinal-cohort-study-designs.html#cb358-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(randid) <span class="sc">%&gt;%</span> </span>
<span id="cb358-5"><a href="longitudinal-cohort-study-designs.html#cb358-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample</span>(<span class="at">size =</span> <span class="dv">20</span>)</span>
<span id="cb358-6"><a href="longitudinal-cohort-study-designs.html#cb358-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb358-7"><a href="longitudinal-cohort-study-designs.html#cb358-7" aria-hidden="true" tabindex="-1"></a>fhs <span class="sc">%&gt;%</span> </span>
<span id="cb358-8"><a href="longitudinal-cohort-study-designs.html#cb358-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(randid <span class="sc">%in%</span> sample_check) <span class="sc">%&gt;%</span> </span>
<span id="cb358-9"><a href="longitudinal-cohort-study-designs.html#cb358-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sex =</span> <span class="fu">factor</span>(sex, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Male&quot;</span>, <span class="st">&quot;Female&quot;</span>))) <span class="sc">%&gt;%</span>  </span>
<span id="cb358-10"><a href="longitudinal-cohort-study-designs.html#cb358-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> bmi, <span class="at">color =</span> sex, <span class="at">group =</span> randid)) <span class="sc">+</span></span>
<span id="cb358-11"><a href="longitudinal-cohort-study-designs.html#cb358-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.4</span>)</span></code></pre></div>
<p><img src="adv_epi_analysis_files/figure-html/unnamed-chunk-193-1.png" width="672" /></p>
<p>While there is some variation within study subjects in BMI, there tends to be more variation when comparing one study subject to another. Average BMI across the three examinations is therefore likely a reasonable measurement to use in exploratory analysis as we did in the previous plot.</p>
<p>Another alternative we could have considered is to use the BMI at the first examination as the measure of the BMI risk factor for each study subject; if you’d like, try that out to see if it changes our main conclusions.</p>
<p>We can use a similar approach to compare BMI and smoking. In this case, one way we could summarize smoking for each study subject is to determine if they were a current smoker at any of their examinations. If we do this, we see that there may be a small, but not dramatic, difference in BMI between smokers and non-smokers:</p>
<div class="sourceCode" id="cb359"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb359-1"><a href="longitudinal-cohort-study-designs.html#cb359-1" aria-hidden="true" tabindex="-1"></a>bmi_vs_smoke <span class="ot">&lt;-</span> fhs <span class="sc">%&gt;%</span> </span>
<span id="cb359-2"><a href="longitudinal-cohort-study-designs.html#cb359-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(randid) <span class="sc">%&gt;%</span> </span>
<span id="cb359-3"><a href="longitudinal-cohort-study-designs.html#cb359-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">bmi =</span> <span class="fu">mean</span>(bmi, <span class="at">rm.na =</span> <span class="cn">TRUE</span>), </span>
<span id="cb359-4"><a href="longitudinal-cohort-study-designs.html#cb359-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">smoke =</span> <span class="fu">max</span>(cursmoke))</span>
<span id="cb359-5"><a href="longitudinal-cohort-study-designs.html#cb359-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb359-6"><a href="longitudinal-cohort-study-designs.html#cb359-6" aria-hidden="true" tabindex="-1"></a>bmi_vs_smoke <span class="sc">%&gt;%</span> </span>
<span id="cb359-7"><a href="longitudinal-cohort-study-designs.html#cb359-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(smoke) <span class="sc">%&gt;%</span> </span>
<span id="cb359-8"><a href="longitudinal-cohort-study-designs.html#cb359-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">perc_25 =</span> <span class="fu">quantile</span>(bmi, <span class="fl">0.25</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb359-9"><a href="longitudinal-cohort-study-designs.html#cb359-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean =</span> <span class="fu">mean</span>(bmi, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb359-10"><a href="longitudinal-cohort-study-designs.html#cb359-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">median =</span> <span class="fu">median</span>(bmi, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb359-11"><a href="longitudinal-cohort-study-designs.html#cb359-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">perc_75 =</span> <span class="fu">quantile</span>(bmi, <span class="fl">0.75</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) </span></code></pre></div>
<pre><code>## # A tibble: 2 x 5
##   smoke perc_25  mean median perc_75
## * &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
## 1     0    23.8  26.6   26.1    28.8
## 2     1    22.7  25.3   24.9    27.4</code></pre>
<p>Again, we might want to check how “stable” smoking status is among study subjects, to get a better idea of how reasonable it is to use a single summary of smoking for each subject in this exploratory analysis.</p>
<div class="sourceCode" id="cb361"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb361-1"><a href="longitudinal-cohort-study-designs.html#cb361-1" aria-hidden="true" tabindex="-1"></a>fhs <span class="sc">%&gt;%</span> </span>
<span id="cb361-2"><a href="longitudinal-cohort-study-designs.html#cb361-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(randid) <span class="sc">%&gt;%</span> </span>
<span id="cb361-3"><a href="longitudinal-cohort-study-designs.html#cb361-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">always_no =</span> <span class="fu">max</span>(cursmoke) <span class="sc">==</span> <span class="dv">0</span>, </span>
<span id="cb361-4"><a href="longitudinal-cohort-study-designs.html#cb361-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">always_yes =</span> <span class="fu">min</span>(cursmoke) <span class="sc">==</span> <span class="dv">1</span>, </span>
<span id="cb361-5"><a href="longitudinal-cohort-study-designs.html#cb361-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">changes =</span> <span class="sc">!</span>((<span class="fu">sum</span>(cursmoke) <span class="sc">/</span> <span class="fu">n</span>()) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb361-6"><a href="longitudinal-cohort-study-designs.html#cb361-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb361-7"><a href="longitudinal-cohort-study-designs.html#cb361-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">always_no =</span> <span class="fu">sum</span>(always_no), </span>
<span id="cb361-8"><a href="longitudinal-cohort-study-designs.html#cb361-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">always_yes =</span> <span class="fu">sum</span>(always_yes), </span>
<span id="cb361-9"><a href="longitudinal-cohort-study-designs.html#cb361-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">changes =</span> <span class="fu">sum</span>(changes))</span></code></pre></div>
<pre><code>## # A tibble: 1 x 3
##   always_no always_yes changes
##       &lt;int&gt;      &lt;int&gt;   &lt;int&gt;
## 1      2100       1585     749</code></pre>
<p>Less than 20% of the study subjects changed their smoking status over the course of the examinations. This isn’t negligible, but it also means that for the majority of the study subjects, their smoking status was stable across all study examinations.</p>
</div>
<div id="coding-a-survival-analysis" class="section level2" number="7.3">
<h2><span class="header-section-number">7.3</span> Coding a survival analysis</h2>
<p>In the context of survival analysis, what is modeled is time to an event (also referred to as survival time or failure time). This is a bit different than the models in the linear or <code>glm</code> family that model an outcome that may follow a gaussian (linear regression), binomial (logistic model) or Poisson distribution. Another difference is that the outcome (time to event) will not be determined in some participants, as they will not have experienced the event of interest during their follow-up. These participants are considered ‘censored.’ Censoring can occur in three ways:</p>
<ul>
<li>the participant does not experience the event of interest before the study end</li>
<li>the participant is lost to follow-up before experiencing the event of interest</li>
<li>the participant experiences a difference event that makes the event of interest impossible (for example if the event of interest is acute MI a participant that dies from a different cause is considered censored)</li>
</ul>
<p>These are all types of right censoring and in simple survival analysis they are considered to be uninformative (typically not related to exposure). If the censoring is related to the exposure and the outcome, then you must adjust for censoring or it could confound the estimates from your model.</p>
<p>Let’s assume that we are interested in all-cause mortality as the event of interest, and let’s denote <span class="math inline">\(T\)</span> as time to death, where we can assume that <span class="math inline">\(T\geq 0\)</span>. We define the survival function as
<span class="math inline">\(S(t)=Pr[T&gt;t]=1-F(t)\)</span>, where the survival function <span class="math inline">\(S(t)\)</span> is the probability that a participant survives past time <span class="math inline">\(t\)</span> (<span class="math inline">\(Pr[T&gt;t]=1\)</span>). <span class="math inline">\(F(t)\)</span> is the Probability Density Function, (sometimes also denoted as the the Cumulative Incidence Function, <span class="math inline">\(R(t)\)</span>) or the probability that that an individual will have a survival time less than or equal to t (<span class="math inline">\([Pr(T≤t)]\)</span>).</p>
<p>Time to event <span class="math inline">\(t\)</span> is bounded by <span class="math inline">\([0,\infty)\)</span> (i.e., the time could be as low as 0, but no lower, and has no upper bound) and <span class="math inline">\(S(t)\)</span> is non-increasing as <span class="math inline">\(t\)</span> becomes greater. At <span class="math inline">\(t=0\)</span>, <span class="math inline">\(S(t)=1\)</span> and conversely as <span class="math inline">\(t\)</span> approaches <span class="math inline">\(\infty\)</span>, <span class="math inline">\(S(t)=0\)</span>. A property of the survival and probabilty density function is <span class="math inline">\(S(t) = 1 – F(t)\)</span>: the survival function and the probability density function (or cumulative incidence function (<span class="math inline">\(R(t)\)</span>) sum to 1.</p>
<p>Another useful function is the hazard Function, <span class="math inline">\(h(t)\)</span>, which is the instantaneous potential of experiencing an event at time <span class="math inline">\(t\)</span>, conditional on having survived to that time (<span class="math inline">\(h(t)=\frac{Pr[t&lt;T\leq t+\Delta t|T&gt;t]}{\Delta t}=\frac{f(t)}{S(t)}\)</span>). The cumulative Hazard Function, <span class="math inline">\(H(t)\)</span> is defined as the integral of the hazard function from time <span class="math inline">\(0\)</span> to time <span class="math inline">\(t\)</span>, which equals the area under the curve <span class="math inline">\(h(t)\)</span> between time <span class="math inline">\(0\)</span> and time <span class="math inline">\(t\)</span> (<span class="math inline">\(H(t)=\int_{0}^{t}h(u)du\)</span>).
If we know any of <span class="math inline">\(S(t)\)</span>, <span class="math inline">\(H(t)\)</span> or <span class="math inline">\(h(t)\)</span>, we can derive the rest based on the following relationships:</p>
<p><span class="math inline">\(h(t)=\frac{\partial log(S(t))}{\partial t}\)</span></p>
<p><span class="math inline">\(H(t)=-log(S(t))\)</span> and conversely <span class="math inline">\(S(t)=exp(-H(t))\)</span></p>
<p>The <code>survival</code> package in R allows us to fit these types of models, including a very popular model in survival analysis, the Cox proportional hazards model. This is the model that was also applied in one of this chapter’s required readings, <span class="citation"><a href="#ref-wong1989risk" role="doc-biblioref">Wong et al.</a> (<a href="#ref-wong1989risk" role="doc-biblioref">1989</a>)</span>. There are also some simple non-parametric ways to explore survival times, which we’ll also explore in the exercise.</p>
<p><em>Applied exercise: Survival curves and simple survival analysis</em></p>
<ol style="list-style-type: decimal">
<li>What does the survival curve for mortality look like with follow-up time as the time scale of interest? How about with age?</li>
<li>How do (survival) curves for mortality compare between males and females? How about for MI?</li>
<li>What is the Hazard Ratio for smoking and the risk of MI, from a Cox Proportional Hazards model?</li>
</ol>
<p><strong>1. What does the survival curve for mortality look like with follow-up time as the time scale of interest? How about with age?</strong></p>
<p>A very simple way to estimate survival is the non-parametric Kaplan-Meier estimator.</p>
<p>In R we would estimate Survival <span class="math inline">\(S(t)\)</span> with all-cause mortality representing failure as follows:</p>
<div class="sourceCode" id="cb363"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb363-1"><a href="longitudinal-cohort-study-designs.html#cb363-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb363-2"><a href="longitudinal-cohort-study-designs.html#cb363-2" aria-hidden="true" tabindex="-1"></a>S1 <span class="ot">&lt;-</span> <span class="fu">Surv</span>(<span class="at">time =</span> fhs_first<span class="sc">$</span>timedth, </span>
<span id="cb363-3"><a href="longitudinal-cohort-study-designs.html#cb363-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">event =</span> fhs_first<span class="sc">$</span>death)</span></code></pre></div>
<p>The <code>Surv</code> function will be key as we look at time-to-event data. This function inputs two vectors: one for the <code>time</code> parameter that gives the follow-up time (either the time to the event, if the event happens during follow-up, or the time to censoring) and one for the <code>event</code> parameter, which gives a status indicator of whether the event happened during follow-up or whether then person was censored before the event happened. For our example data, we can use the column <code>timedth</code> to give the time until either death or censoring, and then the <code>death</code> column as an indicator of whether death happened before censoring.</p>
<p>The output of the <code>Surv</code> function is a special type of object in R with the class “Surv.” If you look at the first few values, you can see that this object records both the follow-up time and the status at that follow-up time:</p>
<div class="sourceCode" id="cb364"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb364-1"><a href="longitudinal-cohort-study-designs.html#cb364-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(S1)</span></code></pre></div>
<pre><code>## [1] &quot;Surv&quot;</code></pre>
<div class="sourceCode" id="cb366"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb366-1"><a href="longitudinal-cohort-study-designs.html#cb366-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(S1)</span></code></pre></div>
<pre><code>## [1] 8766+ 8766+ 8766+ 2956  8766+ 8766+</code></pre>
<p>The numbers assigned to each individual represent their final measured time, with each number with a plus sign indicating that the participant was censored at that time without developing the outcome (haven’t failed/died), while those without the plus sign are the times at which participants developed the outcome (failure/death).</p>
<p>We can use the <code>Surv</code> function inside the <code>survfit</code> function to estimate the Kaplan-Meier curve for a set of data. If we aren’t considering any covariates, we can include <code>~ 1</code> in the model equation, to estimate with only an intercept, rather than to explore differences in the curve based on covariates (we’ll get to that idea later):</p>
<div class="sourceCode" id="cb368"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb368-1"><a href="longitudinal-cohort-study-designs.html#cb368-1" aria-hidden="true" tabindex="-1"></a>fit_time <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(timedthy, death) <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> fhs_first)</span></code></pre></div>
<p>This creates an object of the <code>survfit</code> class, that we can then use in some special plotting functions to look at the curve its estimated. If you print this object, you can see that it gives us some information about the total number of study subjects as well as the total number of events during follow-up (in this case, deaths):</p>
<div class="sourceCode" id="cb369"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb369-1"><a href="longitudinal-cohort-study-designs.html#cb369-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(fit_time)</span></code></pre></div>
<pre><code>## [1] &quot;survfit&quot;</code></pre>
<div class="sourceCode" id="cb371"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb371-1"><a href="longitudinal-cohort-study-designs.html#cb371-1" aria-hidden="true" tabindex="-1"></a>fit_time</span></code></pre></div>
<pre><code>## Call: survfit(formula = Surv(timedthy, death) ~ 1, data = fhs_first)
## 
##       n  events  median 0.95LCL 0.95UCL 
##    4434    1550      NA      NA      NA</code></pre>
<p>You can also look at the structure of this object with <code>str</code>:</p>
<div class="sourceCode" id="cb373"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb373-1"><a href="longitudinal-cohort-study-designs.html#cb373-1" aria-hidden="true" tabindex="-1"></a>fit_time <span class="sc">%&gt;%</span> </span>
<span id="cb373-2"><a href="longitudinal-cohort-study-designs.html#cb373-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str</span>() </span></code></pre></div>
<pre><code>## List of 16
##  $ n        : int 4434
##  $ time     : num [1:1419] 0.0712 0.0931 0.1095 0.1232 0.1259 ...
##  $ n.risk   : num [1:1419] 4434 4433 4432 4431 4430 ...
##  $ n.event  : num [1:1419] 1 1 1 1 1 1 1 1 1 1 ...
##  $ n.censor : num [1:1419] 0 0 0 0 0 0 0 0 0 0 ...
##  $ surv     : num [1:1419] 1 1 0.999 0.999 0.999 ...
##  $ std.err  : num [1:1419] 0.000226 0.000319 0.000391 0.000451 0.000505 ...
##  $ cumhaz   : num [1:1419] 0.000226 0.000451 0.000677 0.000902 0.001128 ...
##  $ std.chaz : num [1:1419] 0.000226 0.000319 0.000391 0.000451 0.000505 ...
##  $ type     : chr &quot;right&quot;
##  $ logse    : logi TRUE
##  $ conf.int : num 0.95
##  $ conf.type: chr &quot;log&quot;
##  $ lower    : num [1:1419] 0.999 0.999 0.999 0.998 0.998 ...
##  $ upper    : num [1:1419] 1 1 1 1 1 ...
##  $ call     : language survfit(formula = Surv(timedthy, death) ~ 1, data = fhs_first)
##  - attr(*, &quot;class&quot;)= chr &quot;survfit&quot;</code></pre>
<p>It’s listing many different times during the follow-up. For each, it’s determined the number of people in the study at risk at that time (not dead or censored) and the number of events at that time point, as well as some other values. These calculations allow it to estimate the cumulative hazard at each time point during follow-up.</p>
<p>There are a number of ways you can plot this output to get a better idea of patterns in the survival curve estimated from the data. The <code>survminer</code> package allows you to do this in a way that interfaces well with <code>ggplot</code> (note also how you can use <code>expression</code> to include mathematical notation in an axis label):</p>
<div class="sourceCode" id="cb375"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb375-1"><a href="longitudinal-cohort-study-designs.html#cb375-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survminer) <span class="co"># for plotting survival plots with ggplot2</span></span>
<span id="cb375-2"><a href="longitudinal-cohort-study-designs.html#cb375-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb375-3"><a href="longitudinal-cohort-study-designs.html#cb375-3" aria-hidden="true" tabindex="-1"></a>fit_time <span class="sc">%&gt;%</span> </span>
<span id="cb375-4"><a href="longitudinal-cohort-study-designs.html#cb375-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsurvplot</span>(<span class="at">xlab =</span> <span class="st">&quot;Time to death (years)&quot;</span>,</span>
<span id="cb375-5"><a href="longitudinal-cohort-study-designs.html#cb375-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">ylab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&#39;Overall Survival Probablity &#39;</span>, </span>
<span id="cb375-6"><a href="longitudinal-cohort-study-designs.html#cb375-6" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">hat</span>(S)<span class="sc">*</span><span class="st">&quot;(t)&quot;</span>)))</span></code></pre></div>
<p><img src="adv_epi_analysis_files/figure-html/unnamed-chunk-201-1.png" width="672" /></p>
<p>We can see that as follow-up time increases, survival decreases rather monotonically, steadily, and slowly over time. In other words, the number of people who have died increases as the length of follow-up increases, but not very quickly (which makes sense since the study population was largely healthy at the start of the study). Survival <span class="math inline">\(\hat{S}(t)\)</span> drops to about 0.65 at the end of follow-up, or in other words about 35% of participants have died, which is what is expected as we already know that 1,550 of 4,434 participants died during follow-up.</p>
<p>We can repeat this estimation with a different time-scale of interest. Other that follow-up times we may also be interested in survival and failure (mortality) with respect to age. We repeat the same code only changing the first argument in the <code>Surv</code> function, substituting time of death with respect to follow-up time with age at death.</p>
<div class="sourceCode" id="cb376"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb376-1"><a href="longitudinal-cohort-study-designs.html#cb376-1" aria-hidden="true" tabindex="-1"></a>fit_age <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(agedth, death) <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> fhs_first)</span>
<span id="cb376-2"><a href="longitudinal-cohort-study-designs.html#cb376-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb376-3"><a href="longitudinal-cohort-study-designs.html#cb376-3" aria-hidden="true" tabindex="-1"></a>fit_age <span class="sc">%&gt;%</span></span>
<span id="cb376-4"><a href="longitudinal-cohort-study-designs.html#cb376-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsurvplot</span>(<span class="at">xlab =</span> <span class="st">&quot;Age (years)&quot;</span>,</span>
<span id="cb376-5"><a href="longitudinal-cohort-study-designs.html#cb376-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">ylab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&#39;Overall Survival Probablity &#39;</span>,</span>
<span id="cb376-6"><a href="longitudinal-cohort-study-designs.html#cb376-6" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">hat</span>(S)<span class="sc">*</span><span class="st">&quot;(t)&quot;</span>)))</span></code></pre></div>
<p><img src="adv_epi_analysis_files/figure-html/unnamed-chunk-202-1.png" width="672" /></p>
<p>We see that the shape of this survival curve is different, with virtually no one dying until they reach their 40s (part of this is likely because this study focused on subjects in their 30s and older at the baseline examination period), and then a sharper drop in survival as age increases.</p>
<p><strong>2. How do (survival) curves for mortality compare between males and females? How about for MI?</strong></p>
<p>Kaplan-Meir curves like the above are useful in comparing the survival rate between two groups. For example if we wanted to compare the survival rates between males and females we would fit the same model as above with sex as an independent variable. For all-cause mortality, we can run these models both based on follow-up time and on age (in separate models):</p>
<div class="sourceCode" id="cb377"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb377-1"><a href="longitudinal-cohort-study-designs.html#cb377-1" aria-hidden="true" tabindex="-1"></a>fit_bysex <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(timedthy, death) <span class="sc">~</span> sex, <span class="at">data =</span> fhs_first)</span>
<span id="cb377-2"><a href="longitudinal-cohort-study-designs.html#cb377-2" aria-hidden="true" tabindex="-1"></a>fit_age_bysex <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(agedth, death) <span class="sc">~</span> sex, <span class="at">data =</span> fhs_first)</span>
<span id="cb377-3"><a href="longitudinal-cohort-study-designs.html#cb377-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb377-4"><a href="longitudinal-cohort-study-designs.html#cb377-4" aria-hidden="true" tabindex="-1"></a>fit_bysex <span class="sc">%&gt;%</span></span>
<span id="cb377-5"><a href="longitudinal-cohort-study-designs.html#cb377-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsurvplot</span>(<span class="at">xlab =</span> <span class="st">&quot;Time to death (years)&quot;</span>,</span>
<span id="cb377-6"><a href="longitudinal-cohort-study-designs.html#cb377-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">ylab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&#39;Overall Survival Probablity &#39;</span>,</span>
<span id="cb377-7"><a href="longitudinal-cohort-study-designs.html#cb377-7" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">hat</span>(S) <span class="sc">*</span> <span class="st">&quot;(t)&quot;</span>)), </span>
<span id="cb377-8"><a href="longitudinal-cohort-study-designs.html#cb377-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">legend.labs =</span> <span class="fu">c</span>(<span class="st">&quot;Male&quot;</span>, <span class="st">&quot;Female&quot;</span>),</span>
<span id="cb377-9"><a href="longitudinal-cohort-study-designs.html#cb377-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend.title=</span><span class="st">&quot;Sex&quot;</span>)</span></code></pre></div>
<p><img src="adv_epi_analysis_files/figure-html/unnamed-chunk-203-1.png" width="672" /></p>
<div class="sourceCode" id="cb378"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb378-1"><a href="longitudinal-cohort-study-designs.html#cb378-1" aria-hidden="true" tabindex="-1"></a>fit_age_bysex <span class="sc">%&gt;%</span></span>
<span id="cb378-2"><a href="longitudinal-cohort-study-designs.html#cb378-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsurvplot</span>(<span class="at">xlab =</span> <span class="st">&quot;Age (years)&quot;</span>,</span>
<span id="cb378-3"><a href="longitudinal-cohort-study-designs.html#cb378-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">ylab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&#39;Overall Survival Probablity &#39;</span>,</span>
<span id="cb378-4"><a href="longitudinal-cohort-study-designs.html#cb378-4" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">hat</span>(S) <span class="sc">*</span> <span class="st">&quot;(t)&quot;</span>)),</span>
<span id="cb378-5"><a href="longitudinal-cohort-study-designs.html#cb378-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">legend.labs =</span> <span class="fu">c</span>(<span class="st">&quot;Male&quot;</span>, <span class="st">&quot;Female&quot;</span>),</span>
<span id="cb378-6"><a href="longitudinal-cohort-study-designs.html#cb378-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend.title =</span> <span class="st">&quot;Sex&quot;</span>)</span></code></pre></div>
<p><img src="adv_epi_analysis_files/figure-html/unnamed-chunk-203-2.png" width="672" /></p>
<p>You can now see that the survival rate for males drops quicker (at a younger age) than for females, and that it also drops more quickly for males if we’re looking across follow-up time.</p>
<p>Similarly we can look at MI as the outcome. If we want to compare across age for the x-axis, then we need to calculate the age at the time of the first hospitalization for MI during follow-up. We can then put that variable in as the <code>time</code> parameter in <code>Surv</code> and use the status of whether the subject had an MI hospitalization by the end of follow-up for the <code>event</code> parameter, then plot as before:</p>
<div class="sourceCode" id="cb379"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb379-1"><a href="longitudinal-cohort-study-designs.html#cb379-1" aria-hidden="true" tabindex="-1"></a>fhs_first <span class="ot">&lt;-</span> fhs_first <span class="sc">%&gt;%</span> </span>
<span id="cb379-2"><a href="longitudinal-cohort-study-designs.html#cb379-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">timemiy =</span> timemi <span class="sc">/</span> <span class="fl">365.25</span>, </span>
<span id="cb379-3"><a href="longitudinal-cohort-study-designs.html#cb379-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">agemi =</span> age <span class="sc">+</span> timemiy) </span>
<span id="cb379-4"><a href="longitudinal-cohort-study-designs.html#cb379-4" aria-hidden="true" tabindex="-1"></a>fit_age_MIbysex <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(agemi, hospmi) <span class="sc">~</span> sex, <span class="at">data =</span> fhs_first )</span>
<span id="cb379-5"><a href="longitudinal-cohort-study-designs.html#cb379-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb379-6"><a href="longitudinal-cohort-study-designs.html#cb379-6" aria-hidden="true" tabindex="-1"></a>fit_age_MIbysex <span class="sc">%&gt;%</span></span>
<span id="cb379-7"><a href="longitudinal-cohort-study-designs.html#cb379-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsurvplot</span>(<span class="at">xlab =</span> <span class="st">&quot;Age (years)&quot;</span>,</span>
<span id="cb379-8"><a href="longitudinal-cohort-study-designs.html#cb379-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">ylab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&#39;MI Survival Probablity &#39;</span>, </span>
<span id="cb379-9"><a href="longitudinal-cohort-study-designs.html#cb379-9" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">hat</span>(S) <span class="sc">*</span> <span class="st">&quot;(t)&quot;</span>)),</span>
<span id="cb379-10"><a href="longitudinal-cohort-study-designs.html#cb379-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">legend.labs=</span><span class="fu">c</span>(<span class="st">&quot;Male&quot;</span>,<span class="st">&quot;Female&quot;</span>),</span>
<span id="cb379-11"><a href="longitudinal-cohort-study-designs.html#cb379-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">legend.title=</span><span class="st">&quot;Sex&quot;</span>)</span></code></pre></div>
<p><img src="adv_epi_analysis_files/figure-html/unnamed-chunk-204-1.png" width="672" /></p>
<p>Once again we see a difference in the survival rates (in this case, “survival” until first hospitalized myocardial infarction, even though the subject might survive the event) with age by sex, which is in line with what we already know from the literature.</p>
<p>We can actually approach survival rates by smoking status in the same manner (in this case, we’ll use the subject’s smoking status at the baseline examination):</p>
<div class="sourceCode" id="cb380"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb380-1"><a href="longitudinal-cohort-study-designs.html#cb380-1" aria-hidden="true" tabindex="-1"></a>fit_age_MIsmoking <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(agemi, hospmi) <span class="sc">~</span> cursmoke, <span class="at">data =</span> fhs_first )</span>
<span id="cb380-2"><a href="longitudinal-cohort-study-designs.html#cb380-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb380-3"><a href="longitudinal-cohort-study-designs.html#cb380-3" aria-hidden="true" tabindex="-1"></a>fit_age_MIsmoking <span class="sc">%&gt;%</span></span>
<span id="cb380-4"><a href="longitudinal-cohort-study-designs.html#cb380-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsurvplot</span>(<span class="at">xlab =</span> <span class="st">&quot;Age (years)&quot;</span>,</span>
<span id="cb380-5"><a href="longitudinal-cohort-study-designs.html#cb380-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">ylab=</span><span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&#39;MI Survival Probablity &#39;</span>, </span>
<span id="cb380-6"><a href="longitudinal-cohort-study-designs.html#cb380-6" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">hat</span>(S) <span class="sc">*</span> <span class="st">&quot;(t)&quot;</span>)), </span>
<span id="cb380-7"><a href="longitudinal-cohort-study-designs.html#cb380-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">legend.labs=</span><span class="fu">c</span>(<span class="st">&quot;Non-smokers&quot;</span>, <span class="st">&quot;Smokers&quot;</span>),</span>
<span id="cb380-8"><a href="longitudinal-cohort-study-designs.html#cb380-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">legend.title=</span><span class="st">&quot;Smoking status at baseline&quot;</span>)</span></code></pre></div>
<p><img src="adv_epi_analysis_files/figure-html/unnamed-chunk-205-1.png" width="672" /></p>
<p>Once again we can observe that there is a difference in survival rates for MI, by smoking status at baseline.</p>
<p>The advantages of the Kaplan-Meier estimator for the survival function are its simplicity and the fact that it is a non-paramteric estimator. One limitation of Kaplan-Meier curves is that in this simple form of visualizing a survival rate, we cannot adjust for confounding by other variables, as the survival rates we are plotting here are marginal with respect to everything else. For example, we can compare survival rates among smokers and non-smokers, but we can’t really simply plot a sex adjusted survival rate for each, as the baseline rate for males and females will differ. What we can estimate while adjusting for other covariates is a survival time ratio, which is actually estimated using the same model we’ve been fitting. The <code>survreg</code> function in the <code>survival</code> package will fit a failure time model, with time to event as the outcome of interest. Unlike the Kaplan-Meier estimator this will require us to make an assumption about the distribution of time-to-event. Usually time-to-event outcomes are assumed to belong to the <em>exponential</em>, <em>Weibull</em>, <em>log-normal (log(T) is normally distributed)</em> or <em>log-logistic</em> distributions.</p>
<p>The majority of survival analyses for longitudinal cohort data, however, has been dominated by the Cox proportional hazards model over the past few decades, and this is the type of model we will focus on for the rest of the chapter. The main advantage of the Cox proportional hazards model is that we don’t have to make any distributional assumptions about the outcome or residuals. We simply model the instantaneous hazard of the outcome at specific time intervals as a function of covariates of interest, and the assumptions we have to make is that of ‘proportional hazards.’ This assumptions stipulates that the hazards across levels of covariates of interest are proportional over time. In other words the ratio of the hazards across levels of covariates should be constant over time.</p>
<p>The Cox proportional hazards model in a simple form has this form:</p>
<p><span class="math inline">\(log(\lambda(t|X))=log(\lambda_{0}(t))+\beta_{1}\times X\)</span></p>
<p>where <span class="math inline">\(\lambda(t)\)</span> represents the hazard at time <span class="math inline">\(t\)</span>, <span class="math inline">\(\lambda_{0}(t)\)</span> is the baseline hazard at time <span class="math inline">\(t\)</span>, and <span class="math inline">\(\beta_{1}\)</span> is the log hazard for those with <span class="math inline">\(X=1\)</span> compared to <span class="math inline">\(X=0\)</span>. The baseline hazard <span class="math inline">\(\lambda_{0}(t)\)</span> is similar to the intercept term in a linear model or glm and is the value of the hazard when all covariates equal 0. However, unlike the intercept term in a linear model or glm, <span class="math inline">\(\lambda_{0}(t)\)</span> is not estimated by the model.
The above model can also be writen as</p>
<p><span class="math inline">\(\lambda(t|X)=\lambda_{0}(t)\times e^{\beta_{1}\times X}\)</span></p>
<p><span class="math inline">\(e^{\beta_{1}}\)</span> is the hazard ratio comparing those hose with <span class="math inline">\(X=1\)</span> and <span class="math inline">\(X=0\)</span></p>
<p>Using the <code>fhs</code> data we will fit a simple Cox proportional hazard for the effect of smoking on the hazard for MI.</p>
<div class="sourceCode" id="cb381"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb381-1"><a href="longitudinal-cohort-study-designs.html#cb381-1" aria-hidden="true" tabindex="-1"></a>coxph_mod1 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(timedth, death) <span class="sc">~</span> cursmoke, <span class="at">data =</span> fhs_first)</span></code></pre></div>
<p>If we look the estimated parameters of the model (we can use <code>broom</code> to pull out a tidy version of these summaries, just as we did with GLM models), there isn’t an intercept term, as noted above, just an estimate for the covariate we included (<code>cursmoke</code> for smoking status at the baseline examination):</p>
<div class="sourceCode" id="cb382"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb382-1"><a href="longitudinal-cohort-study-designs.html#cb382-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb382-2"><a href="longitudinal-cohort-study-designs.html#cb382-2" aria-hidden="true" tabindex="-1"></a>coxph_mod1 <span class="sc">%&gt;%</span></span>
<span id="cb382-3"><a href="longitudinal-cohort-study-designs.html#cb382-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>()</span></code></pre></div>
<pre><code>## # A tibble: 1 x 5
##   term     estimate std.error statistic p.value
##   &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
## 1 cursmoke   0.0867    0.0508      1.71  0.0880</code></pre>
<p>The parameter for the covariate of interest is equivalent to the log of the hazard ratio comparing current smokers at baseline to non-smokers. We can extract the hazard ratio by exponentiating that parameter.</p>
<div class="sourceCode" id="cb384"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb384-1"><a href="longitudinal-cohort-study-designs.html#cb384-1" aria-hidden="true" tabindex="-1"></a>coxph_mod1 <span class="sc">%&gt;%</span> </span>
<span id="cb384-2"><a href="longitudinal-cohort-study-designs.html#cb384-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb384-3"><a href="longitudinal-cohort-study-designs.html#cb384-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">&quot;cursmoke&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb384-4"><a href="longitudinal-cohort-study-designs.html#cb384-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hr =</span> <span class="fu">exp</span>(estimate),</span>
<span id="cb384-5"><a href="longitudinal-cohort-study-designs.html#cb384-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">low_ci =</span> estimate <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> std.error, </span>
<span id="cb384-6"><a href="longitudinal-cohort-study-designs.html#cb384-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">high_ci =</span> estimate <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> std.error, </span>
<span id="cb384-7"><a href="longitudinal-cohort-study-designs.html#cb384-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">low_hr =</span> <span class="fu">exp</span>(low_ci), </span>
<span id="cb384-8"><a href="longitudinal-cohort-study-designs.html#cb384-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">high_hr =</span> <span class="fu">exp</span>(high_ci)) <span class="sc">%&gt;%</span> </span>
<span id="cb384-9"><a href="longitudinal-cohort-study-designs.html#cb384-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(term, hr, low_hr, high_hr)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 4
##   term        hr low_hr high_hr
##   &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
## 1 cursmoke  1.09  0.987    1.20</code></pre>
<p>We see that there is modest suggestive HR elevating the hazard for mortality, but the confidence interval includes the null (hazard ratio of 1).</p>
<p>We have said that the main assumption we need to make here is that of proportional hazards. The <code>survival</code> package actually allows us to check this with the <code>cox.zph</code> function</p>
<div class="sourceCode" id="cb386"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb386-1"><a href="longitudinal-cohort-study-designs.html#cb386-1" aria-hidden="true" tabindex="-1"></a>phtest <span class="ot">&lt;-</span> <span class="fu">cox.zph</span>(coxph_mod1)</span>
<span id="cb386-2"><a href="longitudinal-cohort-study-designs.html#cb386-2" aria-hidden="true" tabindex="-1"></a>phtest</span></code></pre></div>
<pre><code>##          chisq df    p
## cursmoke 0.511  1 0.47
## GLOBAL   0.511  1 0.47</code></pre>
<p>The output of this function is the result of a <span class="math inline">\(\chi^2\)</span> test for the proportional hazards assumption. If the p-value here was below 0.05 we would have to reject the null hypothesis that the proportional hazards assumption holds.
We can also plot the parameter(s) of interest across time from this output. If the proportional hazards assumption holds (constant HR) then the parameter should resemble a horizontal line with respect to time.</p>
<div class="sourceCode" id="cb388"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb388-1"><a href="longitudinal-cohort-study-designs.html#cb388-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(phtest)</span></code></pre></div>
<p><img src="adv_epi_analysis_files/figure-html/unnamed-chunk-210-1.png" width="672" /></p>
<p>Here we see that the line is basically horizontal. Now let’s repeat the model adjusting for some covariates, specifically sex and age. We can include these in a model equation in <code>coxph</code> in a very similar way to how we built model equations for GLMs. The only difference is that the “outcome” part of the formula should be a <code>Surv</code> object, rather than a direct (untransformed) measure from the original data:</p>
<div class="sourceCode" id="cb389"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb389-1"><a href="longitudinal-cohort-study-designs.html#cb389-1" aria-hidden="true" tabindex="-1"></a>coxph_mod2 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(timedth, death) <span class="sc">~</span> cursmoke <span class="sc">+</span> sex <span class="sc">+</span> age, </span>
<span id="cb389-2"><a href="longitudinal-cohort-study-designs.html#cb389-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> fhs_first)</span>
<span id="cb389-3"><a href="longitudinal-cohort-study-designs.html#cb389-3" aria-hidden="true" tabindex="-1"></a>coxph_mod2 <span class="sc">%&gt;%</span></span>
<span id="cb389-4"><a href="longitudinal-cohort-study-designs.html#cb389-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>()</span></code></pre></div>
<pre><code>## # A tibble: 3 x 5
##   term     estimate std.error statistic   p.value
##   &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1 cursmoke   0.338    0.0535       6.32 2.64e- 10
## 2 sex       -0.540    0.0525     -10.3  9.35e- 25
## 3 age        0.0967   0.00327     29.6  3.79e-192</code></pre>
<p>We can already see that the parameter for smoking is now quite a bit higher, but let’s estimate the HR and 95% CI:</p>
<div class="sourceCode" id="cb391"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb391-1"><a href="longitudinal-cohort-study-designs.html#cb391-1" aria-hidden="true" tabindex="-1"></a>coxph_mod2 <span class="sc">%&gt;%</span> </span>
<span id="cb391-2"><a href="longitudinal-cohort-study-designs.html#cb391-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb391-3"><a href="longitudinal-cohort-study-designs.html#cb391-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">&quot;cursmoke&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb391-4"><a href="longitudinal-cohort-study-designs.html#cb391-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hr =</span> <span class="fu">exp</span>(estimate),</span>
<span id="cb391-5"><a href="longitudinal-cohort-study-designs.html#cb391-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">low_ci =</span> estimate <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> std.error, </span>
<span id="cb391-6"><a href="longitudinal-cohort-study-designs.html#cb391-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">high_ci =</span> estimate <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> std.error, </span>
<span id="cb391-7"><a href="longitudinal-cohort-study-designs.html#cb391-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">low_hr =</span> <span class="fu">exp</span>(low_ci), </span>
<span id="cb391-8"><a href="longitudinal-cohort-study-designs.html#cb391-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">high_hr =</span> <span class="fu">exp</span>(high_ci)) <span class="sc">%&gt;%</span> </span>
<span id="cb391-9"><a href="longitudinal-cohort-study-designs.html#cb391-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(term, hr, low_hr, high_hr)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 4
##   term        hr low_hr high_hr
##   &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
## 1 cursmoke  1.40   1.26    1.56</code></pre>
<p>The estimated Hazard Ratio is now 1.40 and the 95% CI does not include the null (in fact, the lower bound of the 95% CI is 1.26). We can determine that there was some confounding by these variables (sex and age at the baseline examination) leading the estimate from the previous model of the association between smoking and time to death to be biased towards the null. Let’s test the proportional hazard assumption for this model:</p>
<div class="sourceCode" id="cb393"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb393-1"><a href="longitudinal-cohort-study-designs.html#cb393-1" aria-hidden="true" tabindex="-1"></a>phtest2 <span class="ot">&lt;-</span> <span class="fu">cox.zph</span>(coxph_mod2)</span>
<span id="cb393-2"><a href="longitudinal-cohort-study-designs.html#cb393-2" aria-hidden="true" tabindex="-1"></a>phtest2</span></code></pre></div>
<pre><code>##          chisq df     p
## cursmoke 0.373  1 0.541
## sex      3.776  1 0.052
## age      3.046  1 0.081
## GLOBAL   7.747  3 0.052</code></pre>
<p>We see that the assumption holds, though the results for the test for both sex and age is close to rejecting the assumption (p-values close to 0.05—if they were below 0.05, we’d reject the null hypothesis that the assumption holds).</p>
<p>Now let’s see what happens if repeat the above model using age, rather than follow-up time, as the time-scale of interest in the survival function of the model:</p>
<div class="sourceCode" id="cb395"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb395-1"><a href="longitudinal-cohort-study-designs.html#cb395-1" aria-hidden="true" tabindex="-1"></a>coxph_modage1 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(agedth, death) <span class="sc">~</span> cursmoke <span class="sc">+</span> sex, <span class="at">data =</span> fhs_first)</span>
<span id="cb395-2"><a href="longitudinal-cohort-study-designs.html#cb395-2" aria-hidden="true" tabindex="-1"></a>coxph_modage1 <span class="sc">%&gt;%</span></span>
<span id="cb395-3"><a href="longitudinal-cohort-study-designs.html#cb395-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>()</span></code></pre></div>
<pre><code>## # A tibble: 2 x 5
##   term     estimate std.error statistic  p.value
##   &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 cursmoke    0.373    0.0529      7.05 1.73e-12
## 2 sex        -0.539    0.0526    -10.2  1.46e-24</code></pre>
<p>Notice that we did not also include age as an additional parameter in the model, since using it as the time-scale inherently adjusts for it. We can again convert the output to a hazard ratio and 95% CIs:</p>
<div class="sourceCode" id="cb397"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb397-1"><a href="longitudinal-cohort-study-designs.html#cb397-1" aria-hidden="true" tabindex="-1"></a>coxph_modage1 <span class="sc">%&gt;%</span> </span>
<span id="cb397-2"><a href="longitudinal-cohort-study-designs.html#cb397-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb397-3"><a href="longitudinal-cohort-study-designs.html#cb397-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">&quot;cursmoke&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb397-4"><a href="longitudinal-cohort-study-designs.html#cb397-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hr =</span> <span class="fu">exp</span>(estimate),</span>
<span id="cb397-5"><a href="longitudinal-cohort-study-designs.html#cb397-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">low_ci =</span> estimate <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> std.error, </span>
<span id="cb397-6"><a href="longitudinal-cohort-study-designs.html#cb397-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">high_ci =</span> estimate <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> std.error, </span>
<span id="cb397-7"><a href="longitudinal-cohort-study-designs.html#cb397-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">low_hr =</span> <span class="fu">exp</span>(low_ci), </span>
<span id="cb397-8"><a href="longitudinal-cohort-study-designs.html#cb397-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">high_hr =</span> <span class="fu">exp</span>(high_ci)) <span class="sc">%&gt;%</span> </span>
<span id="cb397-9"><a href="longitudinal-cohort-study-designs.html#cb397-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(term, hr, low_hr, high_hr)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 4
##   term        hr low_hr high_hr
##   &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
## 1 cursmoke  1.45   1.31    1.61</code></pre>
<p>We also see that the HR is similar as in the previous model (although slightly higher in this case).</p>
<p>Testing for the proportional hazards assumption in this model:</p>
<div class="sourceCode" id="cb399"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb399-1"><a href="longitudinal-cohort-study-designs.html#cb399-1" aria-hidden="true" tabindex="-1"></a>phtestage <span class="ot">&lt;-</span> <span class="fu">cox.zph</span>(coxph_modage1)</span>
<span id="cb399-2"><a href="longitudinal-cohort-study-designs.html#cb399-2" aria-hidden="true" tabindex="-1"></a>phtestage</span></code></pre></div>
<pre><code>##           chisq df       p
## cursmoke 11.637  1 0.00065
## sex       0.657  1 0.41770
## GLOBAL   15.358  2 0.00046</code></pre>
<p>Here we see that the assumption fails. If we plot the results of the models we can also see that we no longer have that horizontal line and in the case of smoking, it deviates from the that line significantly.</p>
<div class="sourceCode" id="cb401"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb401-1"><a href="longitudinal-cohort-study-designs.html#cb401-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)) <span class="co"># graphical parameters to plot two plots side by side (1 row, 2 columns)</span></span>
<span id="cb401-2"><a href="longitudinal-cohort-study-designs.html#cb401-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(phtestage)</span></code></pre></div>
<p><img src="adv_epi_analysis_files/figure-html/unnamed-chunk-217-1.png" width="672" /></p>
<!-- *Note: Variables of interest to continue with:  -->
<!-- for mixed models, `sysbp`, `diabp`, `totchol` compared to `cigpday`, `bmi`, `cursmoke` -->
<!-- for long. analysis, `timemi` and `timestrk` and `hyperten`, exposure: `cursmoke`, `cigpday`, `sysbp`, `diabp`, `bmi`* -->
</div>
<div id="handling-complexity" class="section level2" number="7.4">
<h2><span class="header-section-number">7.4</span> Handling complexity</h2>
<p>You may have noticed that the models we’ve been fitting above only use the first observation from the dataset (including death and time of death variables). This would be fine if all covariates of interest were time-invariant (e.g. sex: its value at baseline would be representative for the duration of follow-up). However, this is a longitudinal dataset with multiple observations per participant, and as we have seen with BMI and smoking, some measurement values change over time. The time-varying nature of these values can be informative whether it has to do with an exposure, covariate, or outcome of interest, and we will now see how to leverage this extra bit of information in the survival analysis context. We will create a longitudinal dataset appropriate for analysis, and go through steps of dealing with repeated outcome measures, time-varying exposures and covariates, and handling multi-level exposures in this setting.</p>
<div id="recurrent-outcome-and-time-varying-exposures" class="section level3" number="7.4.1">
<h3><span class="header-section-number">7.4.1</span> Recurrent outcome and time varying-exposures</h3>
<p>We mentioned earlier how typically in longitudinal studies survival outcomes may be represented in a time-varying fashion. Typically these variables will take the value of 0 until someone becomes a case (i.e., an event like death happens to the person) in which case the value is 1 (and usually this will be the last observation for a given participant). We will go ahead and create these types of variables for death and incident MI in our longitudinal dataset.</p>
<p><em>Applied exercise: Survival analysis with time-varying values</em></p>
<ol style="list-style-type: decimal">
<li>Construct a longitudinal dataset with repeated (time-varying) values for death and MI hospitalization.</li>
<li>Fit a Cox model for the effect of smoking on mortality and MI using this dataset. How do the results compare to the results from the models in 7.3?</li>
<li>Construct an exposure variable representing the history of smoking (identify if someone is a current, former, or never smoker at each period). Repeat the model from 2, using this exposure instead. What added information does this model give us?</li>
</ol>
<p><strong>1. Construct a longitudinal dataset with repeated (time-varying) values for death and cardiovascular outcomes.</strong></p>
<p>The original <code>fhs</code> dataset already has multiple observations per participant denoted by the <code>period</code> variable, with a range of 1–3. Covariate values can change from period to period as we’ve already seen, but the variables for death and cardiovascular outcomes were not time-varying, simply an indicator for the event occurring at any point during follow-up. We will create time-varying variables for these events, as well as time variables indicating the beginning and end of follow-up time in each period.</p>
<div class="sourceCode" id="cb402"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb402-1"><a href="longitudinal-cohort-study-designs.html#cb402-1" aria-hidden="true" tabindex="-1"></a>fhstv <span class="ot">&lt;-</span> fhs <span class="sc">%&gt;%</span></span>
<span id="cb402-2"><a href="longitudinal-cohort-study-designs.html#cb402-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(randid) <span class="sc">%&gt;%</span></span>
<span id="cb402-3"><a href="longitudinal-cohort-study-designs.html#cb402-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">time_next =</span> <span class="fu">lead</span>(time), <span class="do">### bring forward the time from the next period</span></span>
<span id="cb402-4"><a href="longitudinal-cohort-study-designs.html#cb402-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">time2 =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(time_next) <span class="sc">==</span> <span class="cn">FALSE</span>,</span>
<span id="cb402-5"><a href="longitudinal-cohort-study-designs.html#cb402-5" aria-hidden="true" tabindex="-1"></a>                        time_next <span class="sc">-</span> <span class="dv">1</span>,</span>
<span id="cb402-6"><a href="longitudinal-cohort-study-designs.html#cb402-6" aria-hidden="true" tabindex="-1"></a>                        timedth), <span class="do">### create a variable indicating the last day of follow-up in a given period</span></span>
<span id="cb402-7"><a href="longitudinal-cohort-study-designs.html#cb402-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">deathtv =</span> <span class="fu">ifelse</span>(death <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> timedth <span class="sc">&lt;=</span> time2, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb402-8"><a href="longitudinal-cohort-study-designs.html#cb402-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">timemi2 =</span> <span class="fu">ifelse</span>(time2 <span class="sc">&lt;=</span> timemi, time2, timemi),</span>
<span id="cb402-9"><a href="longitudinal-cohort-study-designs.html#cb402-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">hospmitv =</span> <span class="fu">ifelse</span>(hospmi <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> timemi <span class="sc">&lt;=</span> timemi2, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb402-10"><a href="longitudinal-cohort-study-designs.html#cb402-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
<p>We can look at each piece of this. First, we can check the time-related variables we’ve added:</p>
<div class="sourceCode" id="cb403"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb403-1"><a href="longitudinal-cohort-study-designs.html#cb403-1" aria-hidden="true" tabindex="-1"></a>fhstv <span class="sc">%&gt;%</span> </span>
<span id="cb403-2"><a href="longitudinal-cohort-study-designs.html#cb403-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(randid, period, time, time_next, time2)</span></code></pre></div>
<pre><code>## # A tibble: 11,627 x 5
##    randid period  time time_next time2
##     &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;
##  1   2448      1     0      4628  4627
##  2   2448      3  4628        NA  8766
##  3   6238      1     0      2156  2155
##  4   6238      2  2156      4344  4343
##  5   6238      3  4344        NA  8766
##  6   9428      1     0      2199  2198
##  7   9428      2  2199        NA  8766
##  8  10552      1     0      1977  1976
##  9  10552      2  1977        NA  2956
## 10  11252      1     0      2072  2071
## # … with 11,617 more rows</code></pre>
<p>You can see that we’ve grabbed the time of the start of the next period, then reduced this by one to get the last time in the current period. For example, study subject #2448 has examinations for periods 1 and 3. Since period 3 starts at 4,628 days, we can figure out that the first period’s data represents all days up to day 4.627. For the last period, it represents measures from the time of the last examination to the time of death or loss to follow-up, so we can use the column with the time of death / follow-up in the original data to figure out this time.</p>
<p>Next, we can look at the variable we’ve added related to death. Let’s filter to two study subjects who died during follow-up, to see how this element works:</p>
<div class="sourceCode" id="cb405"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb405-1"><a href="longitudinal-cohort-study-designs.html#cb405-1" aria-hidden="true" tabindex="-1"></a>fhstv <span class="sc">%&gt;%</span> </span>
<span id="cb405-2"><a href="longitudinal-cohort-study-designs.html#cb405-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(randid <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10552</span>, <span class="dv">24721</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb405-3"><a href="longitudinal-cohort-study-designs.html#cb405-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(randid, period, time, time2, death, timedth, deathtv)</span></code></pre></div>
<pre><code>## # A tibble: 5 x 7
##   randid period  time time2 death timedth deathtv
##    &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
## 1  10552      1     0  1976     1    2956       0
## 2  10552      2  1977  2956     1    2956       1
## 3  24721      1     0  2267     1    6411       0
## 4  24721      2  2268  4407     1    6411       0
## 5  24721      3  4408  6411     1    6411       1</code></pre>
<p>The original <code>death</code> column is time-invariant—if the study subject died during follow-up, it will be “1” for all the subject’s rows of data. With the new <code>deathtv</code> variable, it lines up the time of death with the time of each examination (<code>period</code>). For subject #10552, death occurred on day 2,956. This was after the study subject’s first period of observation, which went from day 0 to day 1,976, but during the second period, which went from day 1,977 to day 2,956 (in other words, the second period ended with the subject’s death). Therefore, <code>deathtv</code> is 0 in the first period (a death did not occur during this follow-up period for this subject) but 1 during the second period.</p>
<p>You can check the MI variables to see that they work in the same way:</p>
<div class="sourceCode" id="cb407"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb407-1"><a href="longitudinal-cohort-study-designs.html#cb407-1" aria-hidden="true" tabindex="-1"></a>fhstv <span class="sc">%&gt;%</span> </span>
<span id="cb407-2"><a href="longitudinal-cohort-study-designs.html#cb407-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(randid <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10552</span>, <span class="dv">24721</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb407-3"><a href="longitudinal-cohort-study-designs.html#cb407-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(randid, period, time, time2, hospmi, timemi, timemi2, hospmitv)</span></code></pre></div>
<pre><code>## # A tibble: 5 x 8
##   randid period  time time2 hospmi timemi timemi2 hospmitv
##    &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
## 1  10552      1     0  1976      0   2956    1976        0
## 2  10552      2  1977  2956      0   2956    2956        0
## 3  24721      1     0  2267      0   6411    2267        0
## 4  24721      2  2268  4407      0   6411    4407        0
## 5  24721      3  4408  6411      0   6411    6411        0</code></pre>
<p>We can check to see if our new variables are in agreement with the totals from above. Since these variables are created to only take the value of one once for each case, then their cumulative sum in the entire longitudinal dataset should equal our totals from above, when we calculated based on the first row of data for each study subject:</p>
<div class="sourceCode" id="cb409"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb409-1"><a href="longitudinal-cohort-study-designs.html#cb409-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize by counting the number of &quot;1&quot;s for the time-variant death variable</span></span>
<span id="cb409-2"><a href="longitudinal-cohort-study-designs.html#cb409-2" aria-hidden="true" tabindex="-1"></a>fhstv <span class="sc">%&gt;%</span> </span>
<span id="cb409-3"><a href="longitudinal-cohort-study-designs.html#cb409-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">tot_deaths =</span> <span class="fu">sum</span>(deathtv))</span></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##   tot_deaths
##        &lt;dbl&gt;
## 1       1550</code></pre>
<div class="sourceCode" id="cb411"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb411-1"><a href="longitudinal-cohort-study-designs.html#cb411-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize similarly to early in the chapter, by taking the values from </span></span>
<span id="cb411-2"><a href="longitudinal-cohort-study-designs.html#cb411-2" aria-hidden="true" tabindex="-1"></a><span class="co"># the first measurement for each study subject</span></span>
<span id="cb411-3"><a href="longitudinal-cohort-study-designs.html#cb411-3" aria-hidden="true" tabindex="-1"></a>fhstv <span class="sc">%&gt;%</span> </span>
<span id="cb411-4"><a href="longitudinal-cohort-study-designs.html#cb411-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(randid) <span class="sc">%&gt;%</span> </span>
<span id="cb411-5"><a href="longitudinal-cohort-study-designs.html#cb411-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb411-6"><a href="longitudinal-cohort-study-designs.html#cb411-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb411-7"><a href="longitudinal-cohort-study-designs.html#cb411-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">tot_deaths =</span> <span class="fu">sum</span>(death))</span></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##   tot_deaths
##        &lt;dbl&gt;
## 1       1550</code></pre>
<p><strong>2. Fit a Cox model for the effect of smoking on mortality and MI hospitalizations using this dataset. How do the results compare to the results from the models in 7.3</strong></p>
<p>Using the dataset with the time-varying outcomes we created above, we will repeat the same model for death (and MI hospitalizations) as a function of smoking and age and sex. However, unlike those models in section 7.3 we are not interested in the hazard occurring between beginning and end of follow-up for each participant, but rather the hazard occurring during each period. In order to address this we will slightly modify the <code>Surv</code> function in our model to accommodate the specific interval for each period, by designating two time variables (<code>time</code> and <code>time2</code>) instead of one. If you look at the results of using <code>Surv</code> with two times, you can see that it now creates a range for each observation, including an indicator of whether the person was still alive at the end of that range (“+” after the second number in the interval) or whether they died at the end time of the range:</p>
<div class="sourceCode" id="cb413"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb413-1"><a href="longitudinal-cohort-study-designs.html#cb413-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Surv</span>(fhstv<span class="sc">$</span>time, fhstv<span class="sc">$</span>time2, fhstv<span class="sc">$</span>deathtv) <span class="sc">%&gt;%</span> </span>
<span id="cb413-2"><a href="longitudinal-cohort-study-designs.html#cb413-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">20</span>)</span></code></pre></div>
<pre><code>##  [1] (   0,4627+] (4628,8766+] (   0,2155+] (2156,4343+] (4344,8766+]
##  [6] (   0,2198+] (2199,8766+] (   0,1976+] (1977,2956]  (   0,2071+]
## [11] (2072,4284+] (4285,8766+] (   0,2177+] (2178,4350+] (4351,8766+]
## [16] (   0,2211+] (2212,8766+] (   0,2169+] (2170,4288+] (4289,8766+]</code></pre>
<p>You can use this in a Cox regression model as before and extract estimates (log hazard ratio) for each coefficient:</p>
<div class="sourceCode" id="cb415"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb415-1"><a href="longitudinal-cohort-study-designs.html#cb415-1" aria-hidden="true" tabindex="-1"></a>coxph_modtv1 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(time, time2, deathtv) <span class="sc">~</span> cursmoke <span class="sc">+</span> age <span class="sc">+</span> sex, </span>
<span id="cb415-2"><a href="longitudinal-cohort-study-designs.html#cb415-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> fhstv)</span>
<span id="cb415-3"><a href="longitudinal-cohort-study-designs.html#cb415-3" aria-hidden="true" tabindex="-1"></a>coxph_modtv1 <span class="sc">%&gt;%</span></span>
<span id="cb415-4"><a href="longitudinal-cohort-study-designs.html#cb415-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>()</span></code></pre></div>
<pre><code>## # A tibble: 3 x 5
##   term     estimate std.error statistic   p.value
##   &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1 cursmoke   0.378    0.0545       6.94 3.80e- 12
## 2 age        0.0871   0.00319     27.3  8.13e-164
## 3 sex       -0.546    0.0518     -10.5  5.42e- 26</code></pre>
<p>And if we look specifically at the HR for smoking:</p>
<div class="sourceCode" id="cb417"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb417-1"><a href="longitudinal-cohort-study-designs.html#cb417-1" aria-hidden="true" tabindex="-1"></a>coxph_modtv1 <span class="sc">%&gt;%</span> </span>
<span id="cb417-2"><a href="longitudinal-cohort-study-designs.html#cb417-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb417-3"><a href="longitudinal-cohort-study-designs.html#cb417-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">&quot;cursmoke&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb417-4"><a href="longitudinal-cohort-study-designs.html#cb417-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hr =</span> <span class="fu">exp</span>(estimate),</span>
<span id="cb417-5"><a href="longitudinal-cohort-study-designs.html#cb417-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">low_ci =</span> estimate <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> std.error, </span>
<span id="cb417-6"><a href="longitudinal-cohort-study-designs.html#cb417-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">high_ci =</span> estimate <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> std.error, </span>
<span id="cb417-7"><a href="longitudinal-cohort-study-designs.html#cb417-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">low_hr =</span> <span class="fu">exp</span>(low_ci), </span>
<span id="cb417-8"><a href="longitudinal-cohort-study-designs.html#cb417-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">high_hr =</span> <span class="fu">exp</span>(high_ci)) <span class="sc">%&gt;%</span> </span>
<span id="cb417-9"><a href="longitudinal-cohort-study-designs.html#cb417-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(term, hr, low_hr, high_hr)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 4
##   term        hr low_hr high_hr
##   &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
## 1 cursmoke  1.46   1.31    1.62</code></pre>
<p>We see that our estimates are similar to the ones from the model looking only at baseline values and death, so it doesn’t look like we’ve gained much in terms of information.</p>
<p>Now let’s repeat this process with first MI hospitalization as the outcome:</p>
<div class="sourceCode" id="cb419"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb419-1"><a href="longitudinal-cohort-study-designs.html#cb419-1" aria-hidden="true" tabindex="-1"></a>coxph_modhospmitv1 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(time, timemi2, hospmitv) <span class="sc">~</span> </span>
<span id="cb419-2"><a href="longitudinal-cohort-study-designs.html#cb419-2" aria-hidden="true" tabindex="-1"></a>                              cursmoke <span class="sc">+</span> age <span class="sc">+</span> sex, <span class="at">data =</span> fhstv)</span></code></pre></div>
<pre><code>## Warning in Surv(time, timemi2, hospmitv): Stop time must be &gt; start time, NA
## created</code></pre>
<div class="sourceCode" id="cb421"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb421-1"><a href="longitudinal-cohort-study-designs.html#cb421-1" aria-hidden="true" tabindex="-1"></a>coxph_modhospmitv1 <span class="sc">%&gt;%</span></span>
<span id="cb421-2"><a href="longitudinal-cohort-study-designs.html#cb421-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>()</span></code></pre></div>
<pre><code>## # A tibble: 3 x 5
##   term     estimate std.error statistic  p.value
##   &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 cursmoke   0.482    0.107        4.52 6.08e- 6
## 2 age        0.0455   0.00610      7.45 9.50e-14
## 3 sex       -1.11     0.110      -10.1  4.77e-24</code></pre>
<p>There is a warning here indicating that not all out time variables in each observation are in agreement with the rule <code>time2 &gt; time1</code>. If that is the case, the Cox model cannot assess a hazard for a time interval with length &lt;= 0. In our dataset we are including periods after a participant has experienced an MI hospitalization. The <code>Surv</code> function will create missing values for the hazard for these observations, so the estimation of model parameters is not affected, however, we should limit the dataset to the person-time actually at risk for incident MI hospitalization. Luckily the dataset includes a time-varying <code>prevmi</code> variable, indicating a prevalent MI for each period, which we can use to subset to the person-time that is still at risk for an incident MI hospitalization.</p>
<div class="sourceCode" id="cb423"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb423-1"><a href="longitudinal-cohort-study-designs.html#cb423-1" aria-hidden="true" tabindex="-1"></a>fhstv_incMI <span class="ot">&lt;-</span> fhstv <span class="sc">%&gt;%</span></span>
<span id="cb423-2"><a href="longitudinal-cohort-study-designs.html#cb423-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(prevmi <span class="sc">==</span> <span class="dv">0</span>) </span>
<span id="cb423-3"><a href="longitudinal-cohort-study-designs.html#cb423-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb423-4"><a href="longitudinal-cohort-study-designs.html#cb423-4" aria-hidden="true" tabindex="-1"></a>coxph_modhospmitv2 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(time, timemi2, hospmitv) <span class="sc">~</span> </span>
<span id="cb423-5"><a href="longitudinal-cohort-study-designs.html#cb423-5" aria-hidden="true" tabindex="-1"></a>                              cursmoke <span class="sc">+</span> age <span class="sc">+</span> sex, <span class="at">data =</span> fhstv_incMI)</span></code></pre></div>
<pre><code>## Warning in Surv(time, timemi2, hospmitv): Stop time must be &gt; start time, NA
## created</code></pre>
<div class="sourceCode" id="cb425"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb425-1"><a href="longitudinal-cohort-study-designs.html#cb425-1" aria-hidden="true" tabindex="-1"></a>coxph_modhospmitv2 <span class="sc">%&gt;%</span></span>
<span id="cb425-2"><a href="longitudinal-cohort-study-designs.html#cb425-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>()</span></code></pre></div>
<pre><code>## # A tibble: 3 x 5
##   term     estimate std.error statistic  p.value
##   &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 cursmoke   0.487    0.107        4.57 4.88e- 6
## 2 age        0.0465   0.00611      7.61 2.69e-14
## 3 sex       -1.12     0.110      -10.2  3.00e-24</code></pre>
<p>We see that the warning is still there. If we look into our data, we can check why this is:</p>
<div class="sourceCode" id="cb427"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb427-1"><a href="longitudinal-cohort-study-designs.html#cb427-1" aria-hidden="true" tabindex="-1"></a>fhstv_incMI <span class="sc">%&gt;%</span></span>
<span id="cb427-2"><a href="longitudinal-cohort-study-designs.html#cb427-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(timemi2 <span class="sc">&lt;=</span> time) <span class="sc">%&gt;%</span></span>
<span id="cb427-3"><a href="longitudinal-cohort-study-designs.html#cb427-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(randid) <span class="co"># Identify study subjects where this is an issue</span></span></code></pre></div>
<pre><code>## [1] 1338446</code></pre>
<div class="sourceCode" id="cb429"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb429-1"><a href="longitudinal-cohort-study-designs.html#cb429-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check out the data for this study subject</span></span>
<span id="cb429-2"><a href="longitudinal-cohort-study-designs.html#cb429-2" aria-hidden="true" tabindex="-1"></a>fhstv_incMI <span class="sc">%&gt;%</span> </span>
<span id="cb429-3"><a href="longitudinal-cohort-study-designs.html#cb429-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(randid <span class="sc">==</span> <span class="st">&#39;1338446&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb429-4"><a href="longitudinal-cohort-study-designs.html#cb429-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span> (randid, period, time, timemi2, timemi, hospmi, hospmitv)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 7
##    randid period  time timemi2 timemi hospmi hospmitv
##     &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
## 1 1338446      1     0    1901   1902      0        0
## 2 1338446      2  1902    1902   1902      0        0</code></pre>
<p>This is probably a single participant that was considered lost to follow-up, right after their second period visit, and was assigned the same time as the beginning of that period for all time-to-event values (without actually experiencing the outcomes). In other words they were censored at this exact time. Again, the model doesn’t include this observation in the estimation as it creates a missing value for the hazard, so we don’t have to worry about our results, but it’s good to investigate issues like this. We can visualize the model results with a forest plot, which we can generate using <code>ggforest</code> from the <code>survminer</code> package we installed above. We also extract the HR and 95% CI for the variable of interest.</p>
<div class="sourceCode" id="cb431"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb431-1"><a href="longitudinal-cohort-study-designs.html#cb431-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggforest</span>(coxph_modhospmitv2)</span></code></pre></div>
<pre><code>## Warning in .get_data(model, data = data): The `data` argument is not provided.
## Data will be extracted from model fit.</code></pre>
<p><img src="adv_epi_analysis_files/figure-html/unnamed-chunk-229-1.png" width="672" /></p>
<div class="sourceCode" id="cb433"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb433-1"><a href="longitudinal-cohort-study-designs.html#cb433-1" aria-hidden="true" tabindex="-1"></a>coxph_modhospmitv2 <span class="sc">%&gt;%</span> </span>
<span id="cb433-2"><a href="longitudinal-cohort-study-designs.html#cb433-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb433-3"><a href="longitudinal-cohort-study-designs.html#cb433-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">&quot;cursmoke&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb433-4"><a href="longitudinal-cohort-study-designs.html#cb433-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hr =</span> <span class="fu">exp</span>(estimate),</span>
<span id="cb433-5"><a href="longitudinal-cohort-study-designs.html#cb433-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">low_ci =</span> estimate <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> std.error, </span>
<span id="cb433-6"><a href="longitudinal-cohort-study-designs.html#cb433-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">high_ci =</span> estimate <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> std.error, </span>
<span id="cb433-7"><a href="longitudinal-cohort-study-designs.html#cb433-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">low_hr =</span> <span class="fu">exp</span>(low_ci), </span>
<span id="cb433-8"><a href="longitudinal-cohort-study-designs.html#cb433-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">high_hr =</span> <span class="fu">exp</span>(high_ci)) <span class="sc">%&gt;%</span> </span>
<span id="cb433-9"><a href="longitudinal-cohort-study-designs.html#cb433-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(term, hr, low_hr, high_hr)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 4
##   term        hr low_hr high_hr
##   &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
## 1 cursmoke  1.63   1.32    2.01</code></pre>
<p>We see that the hazard ratio comparing current smokers to current non-smokers is 1.63 with 95% CI: (1.32 - 2.01), indicating an elevated risk for MI hospitalization associated with current smoking.</p>
<p>However, the key in that interpretation is the word ‘current.’ In this model for each observation (conditional on sex and age) participants with smoking value of zero are treated equally regardless of whether they are never smokers or former smokers (the latter would have changed from <code>cursmoke=1</code> to <code>cursmoke=0</code> sometime during follow-up). Based on what we know about smoking history and health, we are therefore probably not making use of all the information we have with this approach.</p>
<p><strong>3. Construct an exposure variable representing the history of smoking (identify if someone is a current, former and never smoker at each period). Repeat the model from 2, using this exposure instead. What added information does this model give us?</strong></p>
<p>We can construct a new time-varying exposure variable that allows us to distinguish between those that are never smokers and those who are currently non-smoking, but used to at some point in the past. We’ve already identified those people that have had a change in current smoking status during follow-up above, which in theory would include people becoming smokers after starting as non-smokers, but also those who quit smoking and become former smokers.</p>
<p>We can add a column named <code>smoking</code> that takes three possible values: “never,” “current,” and “former.” First, let’s create a variable called <code>previous_smoking</code> that marks whether the subject was ever marked as a current smoking at previous examinations. For this we can use the <code>cummax</code> function after grouping by the subject ID—this function will take the maximum value up to (and including) that observation. Since smoking is marked with 1 and not smoking with 0 for <code>cursmoke</code>, this new variable marks if there have been <em>any</em> cases where <code>cursmoke</code> has been 1 up to the observation time:</p>
<div class="sourceCode" id="cb435"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb435-1"><a href="longitudinal-cohort-study-designs.html#cb435-1" aria-hidden="true" tabindex="-1"></a>fhstv <span class="ot">&lt;-</span> fhstv <span class="sc">%&gt;%</span> </span>
<span id="cb435-2"><a href="longitudinal-cohort-study-designs.html#cb435-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(randid) <span class="sc">%&gt;%</span> </span>
<span id="cb435-3"><a href="longitudinal-cohort-study-designs.html#cb435-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">previous_smoking =</span> <span class="fu">cummax</span>(cursmoke)) <span class="sc">%&gt;%</span> </span>
<span id="cb435-4"><a href="longitudinal-cohort-study-designs.html#cb435-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb435-5"><a href="longitudinal-cohort-study-designs.html#cb435-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb435-6"><a href="longitudinal-cohort-study-designs.html#cb435-6" aria-hidden="true" tabindex="-1"></a>fhstv <span class="sc">%&gt;%</span> </span>
<span id="cb435-7"><a href="longitudinal-cohort-study-designs.html#cb435-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(randid <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">16365</span>, <span class="dv">67905</span>, <span class="dv">68397</span>)) <span class="sc">%&gt;%</span> <span class="co"># Show for some examples where smoking status changed</span></span>
<span id="cb435-8"><a href="longitudinal-cohort-study-designs.html#cb435-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(randid, period, cursmoke, previous_smoking)</span></code></pre></div>
<pre><code>## # A tibble: 9 x 4
##   randid period cursmoke previous_smoking
##    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;            &lt;dbl&gt;
## 1  16365      1        1                1
## 2  16365      2        0                1
## 3  16365      3        0                1
## 4  67905      1        1                1
## 5  67905      2        1                1
## 6  67905      3        0                1
## 7  68397      1        0                0
## 8  68397      2        1                1
## 9  68397      3        1                1</code></pre>
<p>This <code>previous_smoking</code> variable will help make it easier to create a <code>smoking</code> variable of never, current, or former smoker:</p>
<div class="sourceCode" id="cb437"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb437-1"><a href="longitudinal-cohort-study-designs.html#cb437-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forcats)</span>
<span id="cb437-2"><a href="longitudinal-cohort-study-designs.html#cb437-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb437-3"><a href="longitudinal-cohort-study-designs.html#cb437-3" aria-hidden="true" tabindex="-1"></a>fhstv <span class="ot">&lt;-</span> fhstv <span class="sc">%&gt;%</span> </span>
<span id="cb437-4"><a href="longitudinal-cohort-study-designs.html#cb437-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(randid) <span class="sc">%&gt;%</span> </span>
<span id="cb437-5"><a href="longitudinal-cohort-study-designs.html#cb437-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">smoking =</span> <span class="fu">case_when</span>(</span>
<span id="cb437-6"><a href="longitudinal-cohort-study-designs.html#cb437-6" aria-hidden="true" tabindex="-1"></a>    cursmoke <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;current&quot;</span>, </span>
<span id="cb437-7"><a href="longitudinal-cohort-study-designs.html#cb437-7" aria-hidden="true" tabindex="-1"></a>    cursmoke <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> previous_smoking <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;former&quot;</span>,</span>
<span id="cb437-8"><a href="longitudinal-cohort-study-designs.html#cb437-8" aria-hidden="true" tabindex="-1"></a>    cursmoke <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> previous_smoking <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">&quot;never&quot;</span>, </span>
<span id="cb437-9"><a href="longitudinal-cohort-study-designs.html#cb437-9" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span> <span class="co"># This is a catch-all, in case there are any cases missed by the earlier logic</span></span>
<span id="cb437-10"><a href="longitudinal-cohort-study-designs.html#cb437-10" aria-hidden="true" tabindex="-1"></a>                             ),</span>
<span id="cb437-11"><a href="longitudinal-cohort-study-designs.html#cb437-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">smoking =</span> <span class="fu">as_factor</span>(smoking),  <span class="co"># Change to a factor</span></span>
<span id="cb437-12"><a href="longitudinal-cohort-study-designs.html#cb437-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">smoking =</span> <span class="fu">fct_relevel</span>(smoking, <span class="st">&quot;never&quot;</span>, <span class="st">&quot;former&quot;</span>, <span class="st">&quot;current&quot;</span>)) <span class="co"># Get factor levels in desired order (to ensure &quot;never&quot; is the baseline)</span></span>
<span id="cb437-13"><a href="longitudinal-cohort-study-designs.html#cb437-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb437-14"><a href="longitudinal-cohort-study-designs.html#cb437-14" aria-hidden="true" tabindex="-1"></a>fhstv <span class="sc">%&gt;%</span> </span>
<span id="cb437-15"><a href="longitudinal-cohort-study-designs.html#cb437-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(randid <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">16365</span>, <span class="dv">67905</span>, <span class="dv">68397</span>)) <span class="sc">%&gt;%</span> <span class="co"># Show for some examples where smoking status changed</span></span>
<span id="cb437-16"><a href="longitudinal-cohort-study-designs.html#cb437-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(randid, period, cursmoke, previous_smoking, smoking)</span></code></pre></div>
<pre><code>## # A tibble: 9 x 5
## # Groups:   randid [3]
##   randid period cursmoke previous_smoking smoking
##    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;            &lt;dbl&gt; &lt;fct&gt;  
## 1  16365      1        1                1 current
## 2  16365      2        0                1 former 
## 3  16365      3        0                1 former 
## 4  67905      1        1                1 current
## 5  67905      2        1                1 current
## 6  67905      3        0                1 former 
## 7  68397      1        0                0 never  
## 8  68397      2        1                1 current
## 9  68397      3        1                1 current</code></pre>
<p>Let’s repeat the Cox model for all-cause mortality from above using this exposure:</p>
<div class="sourceCode" id="cb439"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb439-1"><a href="longitudinal-cohort-study-designs.html#cb439-1" aria-hidden="true" tabindex="-1"></a>coxph_modtv2 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(time, time2, deathtv) <span class="sc">~</span> smoking <span class="sc">+</span> age <span class="sc">+</span> sex, </span>
<span id="cb439-2"><a href="longitudinal-cohort-study-designs.html#cb439-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> fhstv)</span>
<span id="cb439-3"><a href="longitudinal-cohort-study-designs.html#cb439-3" aria-hidden="true" tabindex="-1"></a>coxph_modtv2 <span class="sc">%&gt;%</span></span>
<span id="cb439-4"><a href="longitudinal-cohort-study-designs.html#cb439-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>()</span></code></pre></div>
<pre><code>## # A tibble: 4 x 5
##   term           estimate std.error statistic   p.value
##   &lt;chr&gt;             &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1 smokingformer    0.144    0.0836       1.72 8.61e-  2
## 2 smokingcurrent   0.410    0.0577       7.10 1.28e- 12
## 3 age              0.0875   0.00320     27.3  3.28e-164
## 4 sex             -0.531    0.0525     -10.1  4.92e- 24</code></pre>
<div class="sourceCode" id="cb441"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb441-1"><a href="longitudinal-cohort-study-designs.html#cb441-1" aria-hidden="true" tabindex="-1"></a>coxph_modtv2 <span class="sc">%&gt;%</span> </span>
<span id="cb441-2"><a href="longitudinal-cohort-study-designs.html#cb441-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb441-3"><a href="longitudinal-cohort-study-designs.html#cb441-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(term, <span class="st">&quot;smoking&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb441-4"><a href="longitudinal-cohort-study-designs.html#cb441-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hr =</span> <span class="fu">exp</span>(estimate),</span>
<span id="cb441-5"><a href="longitudinal-cohort-study-designs.html#cb441-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">low_ci =</span> estimate <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> std.error, </span>
<span id="cb441-6"><a href="longitudinal-cohort-study-designs.html#cb441-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">high_ci =</span> estimate <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> std.error, </span>
<span id="cb441-7"><a href="longitudinal-cohort-study-designs.html#cb441-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">low_hr =</span> <span class="fu">exp</span>(low_ci), </span>
<span id="cb441-8"><a href="longitudinal-cohort-study-designs.html#cb441-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">high_hr =</span> <span class="fu">exp</span>(high_ci)) <span class="sc">%&gt;%</span> </span>
<span id="cb441-9"><a href="longitudinal-cohort-study-designs.html#cb441-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(term, hr, low_hr, high_hr)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 4
##   term              hr low_hr high_hr
##   &lt;chr&gt;          &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
## 1 smokingformer   1.15  0.980    1.36
## 2 smokingcurrent  1.51  1.35     1.69</code></pre>
<p>We see that the HR for current smokers vs non-smokers remains elevated, but the HR for former smokers is much smaller and the CI includes the null. It seems that the risk of mortality for former smokers compared to non-smokers is quite a bit lower than it is for current smokers.</p>
<p>If we repeat for MI hospitalization (we should recreate our incident MI dataset to include the new smoking variable):</p>
<div class="sourceCode" id="cb443"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb443-1"><a href="longitudinal-cohort-study-designs.html#cb443-1" aria-hidden="true" tabindex="-1"></a>fhstv_incMI <span class="ot">&lt;-</span> fhstv <span class="sc">%&gt;%</span></span>
<span id="cb443-2"><a href="longitudinal-cohort-study-designs.html#cb443-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(prevmi <span class="sc">==</span> <span class="dv">0</span>) </span>
<span id="cb443-3"><a href="longitudinal-cohort-study-designs.html#cb443-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb443-4"><a href="longitudinal-cohort-study-designs.html#cb443-4" aria-hidden="true" tabindex="-1"></a>coxph_modhospmitv3 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(time, timemi2, hospmitv) <span class="sc">~</span> </span>
<span id="cb443-5"><a href="longitudinal-cohort-study-designs.html#cb443-5" aria-hidden="true" tabindex="-1"></a>                              smoking <span class="sc">+</span> age <span class="sc">+</span> sex, </span>
<span id="cb443-6"><a href="longitudinal-cohort-study-designs.html#cb443-6" aria-hidden="true" tabindex="-1"></a>                            <span class="at">data =</span> fhstv_incMI)</span>
<span id="cb443-7"><a href="longitudinal-cohort-study-designs.html#cb443-7" aria-hidden="true" tabindex="-1"></a>coxph_modhospmitv3 <span class="sc">%&gt;%</span></span>
<span id="cb443-8"><a href="longitudinal-cohort-study-designs.html#cb443-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>()</span></code></pre></div>
<pre><code>## # A tibble: 4 x 5
##   term           estimate std.error statistic  p.value
##   &lt;chr&gt;             &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 smokingformer   -0.0588   0.186      -0.316 7.52e- 1
## 2 smokingcurrent   0.475    0.113       4.19  2.82e- 5
## 3 age              0.0464   0.00612     7.59  3.25e-14
## 4 sex             -1.12     0.111     -10.1   5.51e-24</code></pre>
<div class="sourceCode" id="cb445"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb445-1"><a href="longitudinal-cohort-study-designs.html#cb445-1" aria-hidden="true" tabindex="-1"></a>coxph_modhospmitv3 <span class="sc">%&gt;%</span> </span>
<span id="cb445-2"><a href="longitudinal-cohort-study-designs.html#cb445-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>()<span class="sc">%&gt;%</span> </span>
<span id="cb445-3"><a href="longitudinal-cohort-study-designs.html#cb445-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(term, <span class="st">&quot;smoking&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb445-4"><a href="longitudinal-cohort-study-designs.html#cb445-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hr =</span> <span class="fu">exp</span>(estimate),</span>
<span id="cb445-5"><a href="longitudinal-cohort-study-designs.html#cb445-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">low_ci =</span> estimate <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> std.error, </span>
<span id="cb445-6"><a href="longitudinal-cohort-study-designs.html#cb445-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">high_ci =</span> estimate <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> std.error, </span>
<span id="cb445-7"><a href="longitudinal-cohort-study-designs.html#cb445-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">low_hr =</span> <span class="fu">exp</span>(low_ci), </span>
<span id="cb445-8"><a href="longitudinal-cohort-study-designs.html#cb445-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">high_hr =</span> <span class="fu">exp</span>(high_ci)) <span class="sc">%&gt;%</span> </span>
<span id="cb445-9"><a href="longitudinal-cohort-study-designs.html#cb445-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(term, hr, low_hr, high_hr)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 4
##   term              hr low_hr high_hr
##   &lt;chr&gt;          &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
## 1 smokingformer  0.943  0.655    1.36
## 2 smokingcurrent 1.61   1.29     2.01</code></pre>
<p>We can now see that the parameter for current smokers compared to never smokers is still elevated, with a HR = 1.60, but the hazard associated with a comparison of former smokers compared to never smokers is actually below the null, but the CI is very wide and includes the null.</p>
</div>
<div id="multi-level-exposure" class="section level3" number="7.4.2">
<h3><span class="header-section-number">7.4.2</span> Multi-level exposure</h3>
<p>We’ve seen that changing smoking from a binary ‘yes/no’ variable to one with three categories (representing some history in the exposure) has added more information in our assessment for the potential effect of smoking on risk of MI. We actually have even more information on smoking, and specifically smoking intensity, through the <code>cigpday</code> variable. We will incorporate this in our model, as well as look at some other continuous exposures with respect to risk of MI.</p>
<p><em>Applied exercise: Survival analysis with time-varying values</em></p>
<ol style="list-style-type: decimal">
<li>Explore the role of smoking intensity on the hazard for MI hospitalizations, using the <code>cigpday</code> variable. What can we infer about the exposure-response?</li>
<li>Explore the relationship between some of the other predictors in the dataset (specifically <code>bmi</code> and <code>sysbp</code>) and the hazard for MI hospitalization. Investigate whether the exposure response for these variable deviates from (log-)linearity using spline functions.</li>
</ol>
<p><strong>1. Explore the role of smoking intensity on the hazard for MI hospitalizations, using the <code>cigpday</code> variable. What can we infer about the exposure-response?</strong></p>
<p>Let’s repeat our latest model for smoking and MI hospitalizations, including the <code>cigpday</code> variable</p>
<div class="sourceCode" id="cb447"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb447-1"><a href="longitudinal-cohort-study-designs.html#cb447-1" aria-hidden="true" tabindex="-1"></a>coxph_modhospmitv4 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(time, timemi2, hospmitv) <span class="sc">~</span> </span>
<span id="cb447-2"><a href="longitudinal-cohort-study-designs.html#cb447-2" aria-hidden="true" tabindex="-1"></a>                              smoking <span class="sc">+</span> cigpday <span class="sc">+</span> age <span class="sc">+</span> sex, </span>
<span id="cb447-3"><a href="longitudinal-cohort-study-designs.html#cb447-3" aria-hidden="true" tabindex="-1"></a>                            <span class="at">data =</span> fhstv_incMI)</span>
<span id="cb447-4"><a href="longitudinal-cohort-study-designs.html#cb447-4" aria-hidden="true" tabindex="-1"></a>coxph_modhospmitv4 <span class="sc">%&gt;%</span></span>
<span id="cb447-5"><a href="longitudinal-cohort-study-designs.html#cb447-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>()</span></code></pre></div>
<pre><code>## # A tibble: 5 x 5
##   term           estimate std.error statistic  p.value
##   &lt;chr&gt;             &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 smokingformer  -0.0487    0.186      -0.261 7.94e- 1
## 2 smokingcurrent  0.256     0.166       1.54  1.23e- 1
## 3 cigpday         0.00992   0.00579     1.71  8.64e- 2
## 4 age             0.0461    0.00622     7.42  1.21e-13
## 5 sex            -1.10      0.114      -9.65  4.68e-22</code></pre>
<div class="sourceCode" id="cb449"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb449-1"><a href="longitudinal-cohort-study-designs.html#cb449-1" aria-hidden="true" tabindex="-1"></a>coxph_modhospmitv4 <span class="sc">%&gt;%</span> </span>
<span id="cb449-2"><a href="longitudinal-cohort-study-designs.html#cb449-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>()<span class="sc">%&gt;%</span> </span>
<span id="cb449-3"><a href="longitudinal-cohort-study-designs.html#cb449-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">&#39;cigpday&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb449-4"><a href="longitudinal-cohort-study-designs.html#cb449-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hr =</span> <span class="fu">exp</span>(estimate),</span>
<span id="cb449-5"><a href="longitudinal-cohort-study-designs.html#cb449-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">low_ci =</span> estimate <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> std.error, </span>
<span id="cb449-6"><a href="longitudinal-cohort-study-designs.html#cb449-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">high_ci =</span> estimate <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> std.error, </span>
<span id="cb449-7"><a href="longitudinal-cohort-study-designs.html#cb449-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">low_hr =</span> <span class="fu">exp</span>(low_ci), </span>
<span id="cb449-8"><a href="longitudinal-cohort-study-designs.html#cb449-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">high_hr =</span> <span class="fu">exp</span>(high_ci)) <span class="sc">%&gt;%</span> </span>
<span id="cb449-9"><a href="longitudinal-cohort-study-designs.html#cb449-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(term, hr, low_hr, high_hr)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 4
##   term       hr low_hr high_hr
##   &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
## 1 cigpday  1.01  0.999    1.02</code></pre>
<p>We now see that the parameter coefficient for current smoking is attenuated, while the continuous <code>cigpday</code> variable has a positive parameter coefficient (HR=1.009 with each cigarette per day increase in smoking intensity), but the CI includes the null).</p>
<p>We can actually combine these effects, so that for the current smokers we only get an effect for continuous cigarettes per day, by transforming our smoking variable into dummy variables for each level:</p>
<div class="sourceCode" id="cb451"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb451-1"><a href="longitudinal-cohort-study-designs.html#cb451-1" aria-hidden="true" tabindex="-1"></a>fhstv_incMI<span class="ot">&lt;-</span>fhstv_incMI <span class="sc">%&gt;%</span></span>
<span id="cb451-2"><a href="longitudinal-cohort-study-designs.html#cb451-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">smokingcurrent =</span> <span class="fu">ifelse</span>(smoking <span class="sc">==</span> <span class="st">&#39;current&#39;</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb451-3"><a href="longitudinal-cohort-study-designs.html#cb451-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">smokingformer =</span> <span class="fu">ifelse</span>(smoking <span class="sc">==</span> <span class="st">&#39;former&#39;</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb451-4"><a href="longitudinal-cohort-study-designs.html#cb451-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">smokingnever =</span> <span class="fu">ifelse</span>(smoking <span class="sc">==</span> <span class="st">&#39;never&#39;</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb451-5"><a href="longitudinal-cohort-study-designs.html#cb451-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb451-6"><a href="longitudinal-cohort-study-designs.html#cb451-6" aria-hidden="true" tabindex="-1"></a>coxph_modhospmitv5 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(time, timemi2, hospmitv) <span class="sc">~</span> </span>
<span id="cb451-7"><a href="longitudinal-cohort-study-designs.html#cb451-7" aria-hidden="true" tabindex="-1"></a>                              smokingformer <span class="sc">+</span> smokingcurrent<span class="sc">:</span>cigpday <span class="sc">+</span> age <span class="sc">+</span> sex,</span>
<span id="cb451-8"><a href="longitudinal-cohort-study-designs.html#cb451-8" aria-hidden="true" tabindex="-1"></a>                            <span class="at">data =</span> fhstv_incMI) <span class="do">###leaving the dummy variable for &#39;never&#39; out makes &#39;never&#39; the default comparison group</span></span>
<span id="cb451-9"><a href="longitudinal-cohort-study-designs.html#cb451-9" aria-hidden="true" tabindex="-1"></a>coxph_modhospmitv5 <span class="sc">%&gt;%</span></span>
<span id="cb451-10"><a href="longitudinal-cohort-study-designs.html#cb451-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>()</span></code></pre></div>
<pre><code>## # A tibble: 4 x 5
##   term                   estimate std.error statistic  p.value
##   &lt;chr&gt;                     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 smokingformer           -0.106    0.182      -0.585 5.59e- 1
## 2 age                      0.0453   0.00620     7.31  2.64e-13
## 3 sex                     -1.10     0.114      -9.66  4.28e-22
## 4 smokingcurrent:cigpday   0.0163   0.00386     4.23  2.33e- 5</code></pre>
<div class="sourceCode" id="cb453"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb453-1"><a href="longitudinal-cohort-study-designs.html#cb453-1" aria-hidden="true" tabindex="-1"></a>coxph_modhospmitv5 <span class="sc">%&gt;%</span> </span>
<span id="cb453-2"><a href="longitudinal-cohort-study-designs.html#cb453-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb453-3"><a href="longitudinal-cohort-study-designs.html#cb453-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">&#39;smokingcurrent:cigpday&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb453-4"><a href="longitudinal-cohort-study-designs.html#cb453-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hr =</span> <span class="fu">exp</span>(estimate),</span>
<span id="cb453-5"><a href="longitudinal-cohort-study-designs.html#cb453-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">low_ci =</span> estimate <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> std.error, </span>
<span id="cb453-6"><a href="longitudinal-cohort-study-designs.html#cb453-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">high_ci =</span> estimate <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> std.error, </span>
<span id="cb453-7"><a href="longitudinal-cohort-study-designs.html#cb453-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">low_hr =</span> <span class="fu">exp</span>(low_ci), </span>
<span id="cb453-8"><a href="longitudinal-cohort-study-designs.html#cb453-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">high_hr =</span> <span class="fu">exp</span>(high_ci)) <span class="sc">%&gt;%</span> </span>
<span id="cb453-9"><a href="longitudinal-cohort-study-designs.html#cb453-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(term, hr, low_hr, high_hr)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 4
##   term                      hr low_hr high_hr
##   &lt;chr&gt;                  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
## 1 smokingcurrent:cigpday  1.02   1.01    1.02</code></pre>
<p>The HR for each additional cigarette per day compared to never smokers is now 1.016 (95% CI: 1.008–1.023). If we want to estimate the effect for a smoker who smokes a pack of cigarettes a day then:</p>
<div class="sourceCode" id="cb455"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb455-1"><a href="longitudinal-cohort-study-designs.html#cb455-1" aria-hidden="true" tabindex="-1"></a>coxph_modhospmitv5 <span class="sc">%&gt;%</span> </span>
<span id="cb455-2"><a href="longitudinal-cohort-study-designs.html#cb455-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb455-3"><a href="longitudinal-cohort-study-designs.html#cb455-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">&#39;smokingcurrent:cigpday&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb455-4"><a href="longitudinal-cohort-study-designs.html#cb455-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hr =</span> <span class="fu">exp</span>(<span class="dv">20</span> <span class="sc">*</span> estimate),</span>
<span id="cb455-5"><a href="longitudinal-cohort-study-designs.html#cb455-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">low_ci =</span> <span class="dv">20</span> <span class="sc">*</span> (estimate <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> std.error), </span>
<span id="cb455-6"><a href="longitudinal-cohort-study-designs.html#cb455-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">high_ci =</span> <span class="dv">20</span> <span class="sc">*</span> (estimate <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> std.error), </span>
<span id="cb455-7"><a href="longitudinal-cohort-study-designs.html#cb455-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">low_hr =</span> <span class="fu">exp</span>(low_ci), </span>
<span id="cb455-8"><a href="longitudinal-cohort-study-designs.html#cb455-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">high_hr =</span> <span class="fu">exp</span>(high_ci)) <span class="sc">%&gt;%</span> </span>
<span id="cb455-9"><a href="longitudinal-cohort-study-designs.html#cb455-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(term, hr, low_hr, high_hr)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 4
##   term                      hr low_hr high_hr
##   &lt;chr&gt;                  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
## 1 smokingcurrent:cigpday  1.39   1.19    1.61</code></pre>
<p>The model we just fitted, however, assumes a log-linear exposure-response between smoking intensity and hazard for MI hospitalization. We can explore different categories of smoking intensity by creating a categorical variable, representing different smoking categories. The <code>case_when</code> function is helpful here to give a variable different values depending on when different logical conditions are met:</p>
<div class="sourceCode" id="cb457"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb457-1"><a href="longitudinal-cohort-study-designs.html#cb457-1" aria-hidden="true" tabindex="-1"></a>fhstv_incMI <span class="ot">&lt;-</span> fhstv_incMI <span class="sc">%&gt;%</span> </span>
<span id="cb457-2"><a href="longitudinal-cohort-study-designs.html#cb457-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">smokingint =</span> <span class="fu">case_when</span>(</span>
<span id="cb457-3"><a href="longitudinal-cohort-study-designs.html#cb457-3" aria-hidden="true" tabindex="-1"></a>    cigpday <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">&quot;None&quot;</span>, </span>
<span id="cb457-4"><a href="longitudinal-cohort-study-designs.html#cb457-4" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span> <span class="sc">&lt;</span> cigpday <span class="sc">&amp;</span> cigpday <span class="sc">&lt;=</span> <span class="dv">5</span> <span class="sc">~</span> <span class="st">&quot;Light&quot;</span>, </span>
<span id="cb457-5"><a href="longitudinal-cohort-study-designs.html#cb457-5" aria-hidden="true" tabindex="-1"></a>    <span class="dv">5</span> <span class="sc">&lt;</span> cigpday <span class="sc">&amp;</span> cigpday <span class="sc">&lt;=</span> <span class="dv">10</span> <span class="sc">~</span> <span class="st">&quot;Moderate&quot;</span>, </span>
<span id="cb457-6"><a href="longitudinal-cohort-study-designs.html#cb457-6" aria-hidden="true" tabindex="-1"></a>    <span class="dv">10</span> <span class="sc">&lt;</span> cigpday <span class="sc">&amp;</span> cigpday <span class="sc">&lt;=</span> <span class="dv">20</span> <span class="sc">~</span> <span class="st">&quot;Heavy&quot;</span>, </span>
<span id="cb457-7"><a href="longitudinal-cohort-study-designs.html#cb457-7" aria-hidden="true" tabindex="-1"></a>    <span class="dv">20</span> <span class="sc">&lt;</span> cigpday <span class="sc">~</span> <span class="st">&quot;Very Heavy&quot;</span>,</span>
<span id="cb457-8"><a href="longitudinal-cohort-study-designs.html#cb457-8" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb457-9"><a href="longitudinal-cohort-study-designs.html#cb457-9" aria-hidden="true" tabindex="-1"></a>                                ),</span>
<span id="cb457-10"><a href="longitudinal-cohort-study-designs.html#cb457-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">smokingint =</span> <span class="fu">as_factor</span>(smokingint), </span>
<span id="cb457-11"><a href="longitudinal-cohort-study-designs.html#cb457-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">smokingint =</span> <span class="fu">fct_relevel</span>(smokingint, </span>
<span id="cb457-12"><a href="longitudinal-cohort-study-designs.html#cb457-12" aria-hidden="true" tabindex="-1"></a>                          <span class="st">&quot;None&quot;</span>, <span class="st">&quot;Light&quot;</span>, <span class="st">&quot;Moderate&quot;</span>, <span class="st">&quot;Heavy&quot;</span>, <span class="st">&quot;Very Heavy&quot;</span>))</span></code></pre></div>
<p>You can see that this added variable gives us the desired ordered categories for smoking:</p>
<div class="sourceCode" id="cb458"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb458-1"><a href="longitudinal-cohort-study-designs.html#cb458-1" aria-hidden="true" tabindex="-1"></a>fhstv_incMI <span class="sc">%&gt;%</span> </span>
<span id="cb458-2"><a href="longitudinal-cohort-study-designs.html#cb458-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(randid, cigpday, smokingint)</span></code></pre></div>
<pre><code>## # A tibble: 11,253 x 3
## # Groups:   randid [4,348]
##    randid cigpday smokingint
##     &lt;dbl&gt;   &lt;dbl&gt; &lt;fct&gt;     
##  1   2448       0 None      
##  2   2448       0 None      
##  3   6238       0 None      
##  4   6238       0 None      
##  5   6238       0 None      
##  6   9428      20 Heavy     
##  7   9428      30 Very Heavy
##  8  10552      30 Very Heavy
##  9  10552      20 Heavy     
## 10  11252      23 Very Heavy
## # … with 11,243 more rows</code></pre>
<p>Now you can use this variable within the regression model:</p>
<div class="sourceCode" id="cb460"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb460-1"><a href="longitudinal-cohort-study-designs.html#cb460-1" aria-hidden="true" tabindex="-1"></a>coxph_modhospmitv6 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(time, timemi2, hospmitv) <span class="sc">~</span> </span>
<span id="cb460-2"><a href="longitudinal-cohort-study-designs.html#cb460-2" aria-hidden="true" tabindex="-1"></a>                              smokingformer <span class="sc">+</span> smokingcurrent<span class="sc">:</span>smokingint <span class="sc">+</span> age <span class="sc">+</span> sex, </span>
<span id="cb460-3"><a href="longitudinal-cohort-study-designs.html#cb460-3" aria-hidden="true" tabindex="-1"></a>                            <span class="at">data =</span> fhstv_incMI)</span>
<span id="cb460-4"><a href="longitudinal-cohort-study-designs.html#cb460-4" aria-hidden="true" tabindex="-1"></a>coxph_modhospmitv6 <span class="sc">%&gt;%</span></span>
<span id="cb460-5"><a href="longitudinal-cohort-study-designs.html#cb460-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>()</span></code></pre></div>
<pre><code>## # A tibble: 8 x 5
##   term                                estimate std.error statistic   p.value
##   &lt;chr&gt;                                  &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1 smokingformer                        -0.0463   0.186      -0.249  8.04e- 1
## 2 age                                   0.0471   0.00624     7.56   4.05e-14
## 3 sex                                  -1.08     0.113      -9.55   1.36e-21
## 4 smokingcurrent:smokingintNone        NA        0          NA     NA       
## 5 smokingcurrent:smokingintLight       -0.257    0.313      -0.820  4.12e- 1
## 6 smokingcurrent:smokingintModerate     0.0545   0.244       0.223  8.23e- 1
## 7 smokingcurrent:smokingintHeavy        0.654    0.134       4.89   1.00e- 6
## 8 smokingcurrent:smokingintVery Heavy   0.559    0.159       3.51   4.50e- 4</code></pre>
<p>We see that the category for “None” did not return a parameter, which should be expected as we don’t expect any current smokers to be smoking zero cigarettes. We can extract the rest of the parameters and see what the HR is for each category compared to non-smokers. You can use a regular expression with <code>str_detect</code> to pull out the four parameter estimates we’re interested in, so you can calculate the confidence intervals for all four at once:</p>
<div class="sourceCode" id="cb462"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb462-1"><a href="longitudinal-cohort-study-designs.html#cb462-1" aria-hidden="true" tabindex="-1"></a>coxph_modhospmitv6 <span class="sc">%&gt;%</span> </span>
<span id="cb462-2"><a href="longitudinal-cohort-study-designs.html#cb462-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb462-3"><a href="longitudinal-cohort-study-designs.html#cb462-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(term, <span class="st">&quot;smokingcurrent:smokingint[HLMV]&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb462-4"><a href="longitudinal-cohort-study-designs.html#cb462-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hr =</span> <span class="fu">exp</span>(estimate),</span>
<span id="cb462-5"><a href="longitudinal-cohort-study-designs.html#cb462-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">low_ci =</span> (estimate <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> std.error), </span>
<span id="cb462-6"><a href="longitudinal-cohort-study-designs.html#cb462-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">high_ci =</span> (estimate <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> std.error), </span>
<span id="cb462-7"><a href="longitudinal-cohort-study-designs.html#cb462-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">low_hr =</span> <span class="fu">exp</span>(low_ci), </span>
<span id="cb462-8"><a href="longitudinal-cohort-study-designs.html#cb462-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">high_hr =</span> <span class="fu">exp</span>(high_ci)) <span class="sc">%&gt;%</span> </span>
<span id="cb462-9"><a href="longitudinal-cohort-study-designs.html#cb462-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(term, hr, low_hr, high_hr)</span></code></pre></div>
<pre><code>## # A tibble: 4 x 4
##   term                                   hr low_hr high_hr
##   &lt;chr&gt;                               &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
## 1 smokingcurrent:smokingintLight      0.774  0.419    1.43
## 2 smokingcurrent:smokingintModerate   1.06   0.654    1.70
## 3 smokingcurrent:smokingintHeavy      1.92   1.48     2.50
## 4 smokingcurrent:smokingintVery Heavy 1.75   1.28     2.39</code></pre>
<p>We see that only heavy and very heavy smokers have elevated HRs compared to non-smokers, with the estimates for light and moderate yielding CIs including the null.</p>
<p><strong>2. Explore the relationship between some of the other predictors in the dataset (specifically <code>bmi</code> and <code>sysbp</code>) and the hazard for MI hospitalization. Investigate whether the exposure response for these variable deviates from (log-)linearity using spline functions.</strong></p>
<p>We will now turn our attention to some other predictors for cardiovascular disease, namely BMI (<code>bmi</code> in our dataset) and systolic blood pressure (<code>sysbp</code> in out dataset). Below we fit a Cox model for BMI, adjusting for age and sex. BMI is a considered a fairly flawed proxy for obesity and/or healthy metabolic profiles, however unlike more accurate or informative exposure measures it is very easy to assess and can still be quite informative.</p>
<div class="sourceCode" id="cb464"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb464-1"><a href="longitudinal-cohort-study-designs.html#cb464-1" aria-hidden="true" tabindex="-1"></a>coxph_modhospmitvBMI <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(time, timemi2, hospmitv) <span class="sc">~</span> bmi <span class="sc">+</span> age <span class="sc">+</span> sex, </span>
<span id="cb464-2"><a href="longitudinal-cohort-study-designs.html#cb464-2" aria-hidden="true" tabindex="-1"></a>                              <span class="at">data =</span> fhstv_incMI)</span>
<span id="cb464-3"><a href="longitudinal-cohort-study-designs.html#cb464-3" aria-hidden="true" tabindex="-1"></a>coxph_modhospmitvBMI <span class="sc">%&gt;%</span></span>
<span id="cb464-4"><a href="longitudinal-cohort-study-designs.html#cb464-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>()</span></code></pre></div>
<pre><code>## # A tibble: 3 x 5
##   term  estimate std.error statistic  p.value
##   &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 bmi     0.0483   0.0122       3.96 7.55e- 5
## 2 age     0.0400   0.00596      6.71 1.89e-11
## 3 sex    -1.17     0.109      -10.7  8.84e-27</code></pre>
<div class="sourceCode" id="cb466"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb466-1"><a href="longitudinal-cohort-study-designs.html#cb466-1" aria-hidden="true" tabindex="-1"></a>coxph_modhospmitvBMI <span class="sc">%&gt;%</span> </span>
<span id="cb466-2"><a href="longitudinal-cohort-study-designs.html#cb466-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>()<span class="sc">%&gt;%</span> </span>
<span id="cb466-3"><a href="longitudinal-cohort-study-designs.html#cb466-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">&#39;bmi&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb466-4"><a href="longitudinal-cohort-study-designs.html#cb466-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hr =</span> <span class="fu">exp</span>(estimate),</span>
<span id="cb466-5"><a href="longitudinal-cohort-study-designs.html#cb466-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">low_ci =</span> (estimate <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> std.error), </span>
<span id="cb466-6"><a href="longitudinal-cohort-study-designs.html#cb466-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">high_ci =</span> (estimate <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> std.error), </span>
<span id="cb466-7"><a href="longitudinal-cohort-study-designs.html#cb466-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">low_hr =</span> <span class="fu">exp</span>(low_ci), </span>
<span id="cb466-8"><a href="longitudinal-cohort-study-designs.html#cb466-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">high_hr =</span> <span class="fu">exp</span>(high_ci)) <span class="sc">%&gt;%</span> </span>
<span id="cb466-9"><a href="longitudinal-cohort-study-designs.html#cb466-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(term, hr, low_hr, high_hr)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 4
##   term     hr low_hr high_hr
##   &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
## 1 bmi    1.05   1.02    1.07</code></pre>
<p>We see that there is an elevated HR for each unit increase in BMI (HR=1.05, 95% CI: 1.02–1.07). In order to explore whether the exposure-response relationship deviates from (log-)linearity, we will repeat the same model using a spline term for <code>bmi</code>.</p>
<div class="sourceCode" id="cb468"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb468-1"><a href="longitudinal-cohort-study-designs.html#cb468-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(splines)</span>
<span id="cb468-2"><a href="longitudinal-cohort-study-designs.html#cb468-2" aria-hidden="true" tabindex="-1"></a>coxph_modhospmitvBMIsp <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(time, timemi2, hospmitv) <span class="sc">~</span> </span>
<span id="cb468-3"><a href="longitudinal-cohort-study-designs.html#cb468-3" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">ns</span>(bmi, <span class="at">df =</span> <span class="dv">3</span>) <span class="sc">+</span> age <span class="sc">+</span> sex, </span>
<span id="cb468-4"><a href="longitudinal-cohort-study-designs.html#cb468-4" aria-hidden="true" tabindex="-1"></a>                                <span class="at">data =</span> fhstv_incMI)</span>
<span id="cb468-5"><a href="longitudinal-cohort-study-designs.html#cb468-5" aria-hidden="true" tabindex="-1"></a>coxph_modhospmitvBMIsp <span class="sc">%&gt;%</span></span>
<span id="cb468-6"><a href="longitudinal-cohort-study-designs.html#cb468-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>()</span></code></pre></div>
<pre><code>## # A tibble: 5 x 5
##   term             estimate std.error statistic  p.value
##   &lt;chr&gt;               &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 ns(bmi, df = 3)1   1.06     0.378       2.80  5.12e- 3
## 2 ns(bmi, df = 3)2   0.966    1.52        0.638 5.24e- 1
## 3 ns(bmi, df = 3)3   0.818    1.35        0.605 5.45e- 1
## 4 age                0.0400   0.00596     6.71  1.94e-11
## 5 sex               -1.16     0.111     -10.4   2.10e-25</code></pre>
<p>We can better summarize the relationship between BMI and the outcome from the above model by plotting it similar to our approach in the time-series example. We could use similar code as in 4.2, however the <code>termplot</code> functions simplifies some of the steps for us:</p>
<div class="sourceCode" id="cb470"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb470-1"><a href="longitudinal-cohort-study-designs.html#cb470-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb470-2"><a href="longitudinal-cohort-study-designs.html#cb470-2" aria-hidden="true" tabindex="-1"></a>predbmi <span class="ot">&lt;-</span> <span class="fu">termplot</span>(coxph_modhospmitvBMIsp, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">plot =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb470-3"><a href="longitudinal-cohort-study-designs.html#cb470-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pluck</span>(<span class="st">&quot;bmi&quot;</span>)</span>
<span id="cb470-4"><a href="longitudinal-cohort-study-designs.html#cb470-4" aria-hidden="true" tabindex="-1"></a>predbmi <span class="sc">%&gt;%</span></span>
<span id="cb470-5"><a href="longitudinal-cohort-study-designs.html#cb470-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> <span class="fu">exp</span>(y))) <span class="sc">+</span> </span>
<span id="cb470-6"><a href="longitudinal-cohort-study-designs.html#cb470-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb470-7"><a href="longitudinal-cohort-study-designs.html#cb470-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;BMI&quot;</span>, </span>
<span id="cb470-8"><a href="longitudinal-cohort-study-designs.html#cb470-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Hazard Ratio&quot;</span>) <span class="sc">+</span> </span>
<span id="cb470-9"><a href="longitudinal-cohort-study-designs.html#cb470-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">1.0</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">linetype =</span> <span class="dv">2</span>)  </span></code></pre></div>
<p><img src="adv_epi_analysis_files/figure-html/unnamed-chunk-244-1.png" width="672" /></p>
<p>We see that the relationship is mostly linear between values of about 25 and 40, but deviates from linearity at the lower and higher ends of the range in BMI. We would like to re-center this so that we are comparing to a BMI value that is of <strong>lowest</strong> risk (i.e., the plot crosses 1.0 at that BMI). The ‘normal’ range of BMI is 20–25, so let’s center out graph around 22.5. We will also add confidence bands to our plot.</p>
<div class="sourceCode" id="cb471"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb471-1"><a href="longitudinal-cohort-study-designs.html#cb471-1" aria-hidden="true" tabindex="-1"></a>predbmi <span class="ot">&lt;-</span> predbmi <span class="sc">%&gt;%</span></span>
<span id="cb471-2"><a href="longitudinal-cohort-study-designs.html#cb471-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">center =</span> y[x <span class="sc">==</span> <span class="fl">22.5</span>],</span>
<span id="cb471-3"><a href="longitudinal-cohort-study-designs.html#cb471-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylow =</span> y <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> se,</span>
<span id="cb471-4"><a href="longitudinal-cohort-study-designs.html#cb471-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">yhigh =</span> y <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> se)</span>
<span id="cb471-5"><a href="longitudinal-cohort-study-designs.html#cb471-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb471-6"><a href="longitudinal-cohort-study-designs.html#cb471-6" aria-hidden="true" tabindex="-1"></a>predbmi <span class="sc">%&gt;%</span></span>
<span id="cb471-7"><a href="longitudinal-cohort-study-designs.html#cb471-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> <span class="fu">exp</span>(y <span class="sc">-</span> center))) <span class="sc">+</span> </span>
<span id="cb471-8"><a href="longitudinal-cohort-study-designs.html#cb471-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb471-9"><a href="longitudinal-cohort-study-designs.html#cb471-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;BMI&quot;</span>, </span>
<span id="cb471-10"><a href="longitudinal-cohort-study-designs.html#cb471-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Hazard Ratio&quot;</span>) <span class="sc">+</span> </span>
<span id="cb471-11"><a href="longitudinal-cohort-study-designs.html#cb471-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">1.0</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">linetype =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb471-12"><a href="longitudinal-cohort-study-designs.html#cb471-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> <span class="fu">exp</span>(ylow <span class="sc">-</span> center), <span class="at">ymax =</span> <span class="fu">exp</span>(yhigh <span class="sc">-</span> center)), </span>
<span id="cb471-13"><a href="longitudinal-cohort-study-designs.html#cb471-13" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="fl">0.1</span>, </span>
<span id="cb471-14"><a href="longitudinal-cohort-study-designs.html#cb471-14" aria-hidden="true" tabindex="-1"></a>              <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>,</span>
<span id="cb471-15"><a href="longitudinal-cohort-study-designs.html#cb471-15" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)</span></code></pre></div>
<p><img src="adv_epi_analysis_files/figure-html/unnamed-chunk-245-1.png" width="672" /></p>
<p>We see that the width of the confidence interval is very large and makes reading the plot quite difficult. We can partially remedy this by log-transforming the y-axis.</p>
<div class="sourceCode" id="cb472"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb472-1"><a href="longitudinal-cohort-study-designs.html#cb472-1" aria-hidden="true" tabindex="-1"></a>predbmi <span class="sc">%&gt;%</span></span>
<span id="cb472-2"><a href="longitudinal-cohort-study-designs.html#cb472-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> <span class="fu">exp</span>(y <span class="sc">-</span> center))) <span class="sc">+</span> </span>
<span id="cb472-3"><a href="longitudinal-cohort-study-designs.html#cb472-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb472-4"><a href="longitudinal-cohort-study-designs.html#cb472-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;BMI&quot;</span>, </span>
<span id="cb472-5"><a href="longitudinal-cohort-study-designs.html#cb472-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Hazard Ratio&quot;</span>) <span class="sc">+</span> </span>
<span id="cb472-6"><a href="longitudinal-cohort-study-designs.html#cb472-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">1.0</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">linetype =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb472-7"><a href="longitudinal-cohort-study-designs.html#cb472-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> <span class="fu">exp</span>(ylow <span class="sc">-</span> center), <span class="at">ymax =</span> <span class="fu">exp</span>(yhigh <span class="sc">-</span> center)), </span>
<span id="cb472-8"><a href="longitudinal-cohort-study-designs.html#cb472-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="fl">0.1</span>, </span>
<span id="cb472-9"><a href="longitudinal-cohort-study-designs.html#cb472-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>,</span>
<span id="cb472-10"><a href="longitudinal-cohort-study-designs.html#cb472-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>) <span class="sc">+</span></span>
<span id="cb472-11"><a href="longitudinal-cohort-study-designs.html#cb472-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">trans =</span> <span class="st">&#39;log2&#39;</span>) </span></code></pre></div>
<p><img src="adv_epi_analysis_files/figure-html/unnamed-chunk-246-1.png" width="672" />
We now see that the HR is elevated as BMI increases until about BMI=40 with the effect estimate plateauing at higher values. The CI bands indicate a significant effect between BMI 25 and 42–43. Part of the reason for very wide confidence intervals at the far ranges of BMI is likely because data is sparse for those values, so another alternative you might explore would be to trim the data to focus on the range of BMIs that are more common among the study population.</p>
<p>Next, let’s repeat the model, but now add a term for <code>sysbp</code>.</p>
<div class="sourceCode" id="cb473"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb473-1"><a href="longitudinal-cohort-study-designs.html#cb473-1" aria-hidden="true" tabindex="-1"></a>coxph_modhospmitvBMIBP <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(time, timemi2, hospmitv) <span class="sc">~</span> </span>
<span id="cb473-2"><a href="longitudinal-cohort-study-designs.html#cb473-2" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">ns</span>(bmi, <span class="at">df =</span> <span class="dv">3</span>) <span class="sc">+</span> sysbp <span class="sc">+</span> age <span class="sc">+</span> sex,</span>
<span id="cb473-3"><a href="longitudinal-cohort-study-designs.html#cb473-3" aria-hidden="true" tabindex="-1"></a>                                <span class="at">data =</span> fhstv_incMI)</span>
<span id="cb473-4"><a href="longitudinal-cohort-study-designs.html#cb473-4" aria-hidden="true" tabindex="-1"></a>coxph_modhospmitvBMIBP <span class="sc">%&gt;%</span></span>
<span id="cb473-5"><a href="longitudinal-cohort-study-designs.html#cb473-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 x 5
##   term             estimate std.error statistic  p.value
##   &lt;chr&gt;               &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 ns(bmi, df = 3)1   0.661    0.381       1.73  8.30e- 2
## 2 ns(bmi, df = 3)2  -0.360    1.53       -0.236 8.14e- 1
## 3 ns(bmi, df = 3)3  -0.694    1.38       -0.502 6.16e- 1
## 4 sysbp              0.0187   0.00216     8.67  4.23e-18
## 5 age                0.0246   0.00635     3.87  1.09e- 4
## 6 sex               -1.24     0.113     -11.1   2.05e-28</code></pre>
<div class="sourceCode" id="cb475"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb475-1"><a href="longitudinal-cohort-study-designs.html#cb475-1" aria-hidden="true" tabindex="-1"></a>coxph_modhospmitvBMIBP <span class="sc">%&gt;%</span></span>
<span id="cb475-2"><a href="longitudinal-cohort-study-designs.html#cb475-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tidy</span>()<span class="sc">%&gt;%</span> </span>
<span id="cb475-3"><a href="longitudinal-cohort-study-designs.html#cb475-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">&#39;sysbp&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb475-4"><a href="longitudinal-cohort-study-designs.html#cb475-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hr =</span> <span class="fu">exp</span>(estimate),</span>
<span id="cb475-5"><a href="longitudinal-cohort-study-designs.html#cb475-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">low_ci =</span> (estimate <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> std.error), </span>
<span id="cb475-6"><a href="longitudinal-cohort-study-designs.html#cb475-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">high_ci =</span> (estimate <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> std.error), </span>
<span id="cb475-7"><a href="longitudinal-cohort-study-designs.html#cb475-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">low_hr =</span> <span class="fu">exp</span>(low_ci), </span>
<span id="cb475-8"><a href="longitudinal-cohort-study-designs.html#cb475-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">high_hr =</span> <span class="fu">exp</span>(high_ci)) <span class="sc">%&gt;%</span> </span>
<span id="cb475-9"><a href="longitudinal-cohort-study-designs.html#cb475-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(term, hr, low_hr, high_hr)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 4
##   term     hr low_hr high_hr
##   &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
## 1 sysbp  1.02   1.01    1.02</code></pre>
<p>We see that there is an a HR of 1.019 (95% CI: 1.015 - 1.023) for each unit increase in systolic blood pressure. We can further explore this relationship by trying a spline term for blood pressure as well.</p>
<div class="sourceCode" id="cb477"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb477-1"><a href="longitudinal-cohort-study-designs.html#cb477-1" aria-hidden="true" tabindex="-1"></a>coxph_modhospmitvBMIBPsp <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(time, timemi2, hospmitv) <span class="sc">~</span> </span>
<span id="cb477-2"><a href="longitudinal-cohort-study-designs.html#cb477-2" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">ns</span>(bmi, <span class="at">df =</span> <span class="dv">3</span>) <span class="sc">+</span> <span class="fu">ns</span>(sysbp, <span class="at">df =</span> <span class="dv">3</span>) <span class="sc">+</span> age <span class="sc">+</span> sex, </span>
<span id="cb477-3"><a href="longitudinal-cohort-study-designs.html#cb477-3" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">data =</span> fhstv_incMI)</span>
<span id="cb477-4"><a href="longitudinal-cohort-study-designs.html#cb477-4" aria-hidden="true" tabindex="-1"></a>coxph_modhospmitvBMIBPsp <span class="sc">%&gt;%</span></span>
<span id="cb477-5"><a href="longitudinal-cohort-study-designs.html#cb477-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>()</span></code></pre></div>
<pre><code>## # A tibble: 8 x 5
##   term               estimate std.error statistic  p.value
##   &lt;chr&gt;                 &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 ns(bmi, df = 3)1     0.614    0.384       1.60  1.10e- 1
## 2 ns(bmi, df = 3)2    -0.374    1.53       -0.244 8.07e- 1
## 3 ns(bmi, df = 3)3    -0.617    1.39       -0.445 6.57e- 1
## 4 ns(sysbp, df = 3)1   2.03     0.414       4.91  9.32e- 7
## 5 ns(sysbp, df = 3)2   4.75     1.62        2.93  3.37e- 3
## 6 ns(sysbp, df = 3)3   3.77     1.04        3.62  2.96e- 4
## 7 age                  0.0243   0.00636     3.83  1.29e- 4
## 8 sex                 -1.24     0.113     -11.0   4.19e-28</code></pre>
<div class="sourceCode" id="cb479"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb479-1"><a href="longitudinal-cohort-study-designs.html#cb479-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We will go ahead and plot this as well using 110 as the center</span></span>
<span id="cb479-2"><a href="longitudinal-cohort-study-designs.html#cb479-2" aria-hidden="true" tabindex="-1"></a>predsysbp <span class="ot">&lt;-</span> <span class="fu">termplot</span>(coxph_modhospmitvBMIBPsp, <span class="at">se=</span><span class="cn">TRUE</span>, <span class="at">plot=</span><span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb479-3"><a href="longitudinal-cohort-study-designs.html#cb479-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pluck</span>(<span class="st">&quot;sysbp&quot;</span>)</span>
<span id="cb479-4"><a href="longitudinal-cohort-study-designs.html#cb479-4" aria-hidden="true" tabindex="-1"></a>predsysbp <span class="ot">&lt;-</span> predsysbp <span class="sc">%&gt;%</span>  </span>
<span id="cb479-5"><a href="longitudinal-cohort-study-designs.html#cb479-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">center =</span> y[x<span class="sc">==</span><span class="dv">110</span>],</span>
<span id="cb479-6"><a href="longitudinal-cohort-study-designs.html#cb479-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylow =</span> y <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> se,</span>
<span id="cb479-7"><a href="longitudinal-cohort-study-designs.html#cb479-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">yhigh =</span> y <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> se)</span>
<span id="cb479-8"><a href="longitudinal-cohort-study-designs.html#cb479-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb479-9"><a href="longitudinal-cohort-study-designs.html#cb479-9" aria-hidden="true" tabindex="-1"></a>predsysbp <span class="sc">%&gt;%</span></span>
<span id="cb479-10"><a href="longitudinal-cohort-study-designs.html#cb479-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> <span class="fu">exp</span>(y<span class="sc">-</span>center))) <span class="sc">+</span> </span>
<span id="cb479-11"><a href="longitudinal-cohort-study-designs.html#cb479-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb479-12"><a href="longitudinal-cohort-study-designs.html#cb479-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Systolic Blood Pressure&quot;</span>, </span>
<span id="cb479-13"><a href="longitudinal-cohort-study-designs.html#cb479-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Hazard Ratio&quot;</span>) <span class="sc">+</span> </span>
<span id="cb479-14"><a href="longitudinal-cohort-study-designs.html#cb479-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">1.0</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">linetype =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb479-15"><a href="longitudinal-cohort-study-designs.html#cb479-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> <span class="fu">exp</span>(ylow <span class="sc">-</span> center), <span class="at">ymax =</span> <span class="fu">exp</span>(yhigh <span class="sc">-</span> center)), </span>
<span id="cb479-16"><a href="longitudinal-cohort-study-designs.html#cb479-16" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="fl">0.1</span>, </span>
<span id="cb479-17"><a href="longitudinal-cohort-study-designs.html#cb479-17" aria-hidden="true" tabindex="-1"></a>              <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>,</span>
<span id="cb479-18"><a href="longitudinal-cohort-study-designs.html#cb479-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">color=</span><span class="st">&quot;grey&quot;</span>) <span class="sc">+</span></span>
<span id="cb479-19"><a href="longitudinal-cohort-study-designs.html#cb479-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">trans =</span> <span class="st">&#39;log2&#39;</span>)</span></code></pre></div>
<p><img src="adv_epi_analysis_files/figure-html/unnamed-chunk-248-1.png" width="672" /></p>
<p>We see an almost monotonic increase in the HR (keep in mind the log-transformation on the y-axis) as blood pressure increases with the effect being significant for the range of exposure above ~110.</p>
<p>Both BMI and systolic blood pressure appear significant predictors for the hazard of MI hospitalization. You can explore other predictors in the dataset (including blood glucose, cholesterol, etc.) but keep in mind of the missingness in some of these variables and how might these affect your results.</p>
</div>
<div id="time-varying-coefficients" class="section level3" number="7.4.3">
<h3><span class="header-section-number">7.4.3</span> Time-varying coefficients</h3>
<p>We’ve already shown how some of the covariate values in the dataset change over time. Now consider the following model including smoking, and some of the other predictors from above:</p>
<div class="sourceCode" id="cb480"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb480-1"><a href="longitudinal-cohort-study-designs.html#cb480-1" aria-hidden="true" tabindex="-1"></a>coxph_modhospmitvall <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(time, timemi2, hospmitv) <span class="sc">~</span> </span>
<span id="cb480-2"><a href="longitudinal-cohort-study-designs.html#cb480-2" aria-hidden="true" tabindex="-1"></a>                                smoking <span class="sc">+</span> <span class="fu">ns</span>(bmi, <span class="at">df =</span> <span class="dv">3</span>) <span class="sc">+</span> <span class="fu">ns</span>(sysbp, <span class="at">df =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb480-3"><a href="longitudinal-cohort-study-designs.html#cb480-3" aria-hidden="true" tabindex="-1"></a>                                age <span class="sc">+</span> sex, </span>
<span id="cb480-4"><a href="longitudinal-cohort-study-designs.html#cb480-4" aria-hidden="true" tabindex="-1"></a>                              <span class="at">data =</span> fhstv_incMI)</span>
<span id="cb480-5"><a href="longitudinal-cohort-study-designs.html#cb480-5" aria-hidden="true" tabindex="-1"></a>coxph_modhospmitvall <span class="sc">%&gt;%</span></span>
<span id="cb480-6"><a href="longitudinal-cohort-study-designs.html#cb480-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>()</span></code></pre></div>
<pre><code>## # A tibble: 10 x 5
##    term               estimate std.error statistic  p.value
##    &lt;chr&gt;                 &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
##  1 smokingformer       -0.0592   0.187      -0.317 7.51e- 1
##  2 smokingcurrent       0.575    0.116       4.96  7.04e- 7
##  3 ns(bmi, df = 3)1     0.941    0.390       2.41  1.59e- 2
##  4 ns(bmi, df = 3)2     0.231    1.57        0.147 8.83e- 1
##  5 ns(bmi, df = 3)3    -0.387    1.43       -0.270 7.87e- 1
##  6 ns(sysbp, df = 3)1   2.06     0.414       4.97  6.69e- 7
##  7 ns(sysbp, df = 3)2   4.85     1.63        2.99  2.81e- 3
##  8 ns(sysbp, df = 3)3   3.78     1.05        3.60  3.22e- 4
##  9 age                  0.0321   0.00656     4.90  9.73e- 7
## 10 sex                 -1.16     0.115     -10.1   6.69e-24</code></pre>
<div class="sourceCode" id="cb482"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb482-1"><a href="longitudinal-cohort-study-designs.html#cb482-1" aria-hidden="true" tabindex="-1"></a>coxph_modhospmitvall <span class="sc">%&gt;%</span> </span>
<span id="cb482-2"><a href="longitudinal-cohort-study-designs.html#cb482-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb482-3"><a href="longitudinal-cohort-study-designs.html#cb482-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">&#39;smokingcurrent&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb482-4"><a href="longitudinal-cohort-study-designs.html#cb482-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hr =</span> <span class="fu">exp</span>(estimate),</span>
<span id="cb482-5"><a href="longitudinal-cohort-study-designs.html#cb482-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">low_ci =</span> (estimate <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> std.error), </span>
<span id="cb482-6"><a href="longitudinal-cohort-study-designs.html#cb482-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">high_ci =</span> (estimate <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> std.error), </span>
<span id="cb482-7"><a href="longitudinal-cohort-study-designs.html#cb482-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">low_hr =</span> <span class="fu">exp</span>(low_ci), </span>
<span id="cb482-8"><a href="longitudinal-cohort-study-designs.html#cb482-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">high_hr =</span> <span class="fu">exp</span>(high_ci)) <span class="sc">%&gt;%</span> </span>
<span id="cb482-9"><a href="longitudinal-cohort-study-designs.html#cb482-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(term, hr, low_hr, high_hr)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 4
##   term              hr low_hr high_hr
##   &lt;chr&gt;          &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
## 1 smokingcurrent  1.78   1.42    2.23</code></pre>
<p>The HR for current smoking appears more elevated than in our simple models with only age and sex adjusted for. What is a possible explanation for this?</p>
<p>Keeping in mind the dynamic nature of some of these variable over time, what are some other potential explanations for these relationships? How does that affect our potential interpretation of the parameter coefficients for these variables? We will revisit this issue in chapter 8 of the book.</p>
</div>
<div id="using-survey-data-e.g.-nhanes" class="section level3" number="7.4.4">
<h3><span class="header-section-number">7.4.4</span> Using survey data (e.g. NHANES)</h3>
<p>For this chapter, we’ve used data from the Framingham study as an example. Another very famous public health study in the United States is the National Health and Nutrition Examination study, more commonly known by its acronym of NHANES. We’ll wrap up this chapter by talking a bit about this other famous study, a branch of it that includes longitudinal data appropriate for a survival analysis like that covered in this chapter for Framingham, and how some quirks of the NHANES study design make the analysis of its data a bit more complex.</p>
<p>Just as the original Framingham study has evolved into a whole set of related studies, NHANES also began with one study and has evolved into a collection of studies. All are focused on nuitrition and health among Americans, and an enormous body of epidemiological literature has resulted from the collection of studies, covering a wide range of health outcomes and risk factors.</p>
<p>The core of the NHANES study collection is a survey study. These surveys are currently run continuously (every year), with around 5,000 participants a year. The surveys collect individual-level data (rather than the county- or city-level aggregated data we used for time series studies) that allow a cross-sectional view of associations between different risk factors and different measures of health.</p>
<p>These survey data therefore only offer a snapshot in time (the time of the survey). However, the NHANES project has supplemented the survey with some longitudinal data that can be used to study the time to events of interest. Following NHANES I, which was the first run of the survey, the study’s researchers created the NHANES Epidemiologic Followup Study (NHEFS). They found as many people as they could who took the original survey (NHANES I) as adults (between ages 25 and 74) and began tracking their time to several health inputs, including mortality, and also collected updated information on risk factors and health status. The cohort was tracked during the 1980s and into the early 1990s, and follow-up for mortality among the cohort was tracked all the way until 2011. Much more information about this cohort, as well as links to available data, are available <a href="https://wwwn.cdc.gov/nchs/nhanes/nhefs/default.aspx/#dfd">here</a>.</p>
<p>The NHEFS cohort study from NHANES has been used for a wide variety of epidemiological studies. These include studies with a wide variety, including studies of folate and colon cancer risk <span class="citation">(<a href="#ref-su2001nutritional" role="doc-biblioref">Su and Arab 2001</a>)</span>, hypertension and educational attainment <span class="citation">(<a href="#ref-vargas2000incidence" role="doc-biblioref">Vargas, Ingram, and Gillum 2000</a>)</span>, chronic musculoskeletal pain and depressive symptoms <span class="citation">(<a href="#ref-magni1993chronic" role="doc-biblioref">Magni et al. 1993</a>)</span>, frequency of eating and weight change <span class="citation">(<a href="#ref-kant1995frequency" role="doc-biblioref">Kant et al. 1995</a>)</span>, physical activity and breast cancer <span class="citation">(<a href="#ref-breslow2001long" role="doc-biblioref">Breslow et al. 2001</a>)</span>, white blood cell counts and stroke <span class="citation">(<a href="#ref-gillum1994white" role="doc-biblioref">Gillum, Ingram, and Makuc 1994</a>)</span>, and risk factors for hip fracture <span class="citation">(<a href="#ref-mussolino1998risk" role="doc-biblioref">Mussolino et al. 1998</a>)</span>.</p>
<p>While you can perform survival analysis on the NHEFS data, you have to take some extra steps. This is because the cohort was developed based on participants in a survey (NHANES I), and that survey selected participants in some ways that need to be addressed when you analyze the resulting data.</p>
<p>First, some groups were oversampled for NHANES I, including older adults, women of childbearing age, and people who lived in poorer areas. This oversampling has implications when it comes to generating estimates that generalize to the full US population, because it means that the study population isn’t representative of the general population. To address this, you can use sampling weights within an analysis, which reweight the data from each study subject to create estimates that are more appropriate to describe trends in the target population. Alternatively, in some cases it may be appropriate to do an unweighted analysis, while include variables related to the weight (e.g., age, gender, socioeconomic status) as covariates in the model <span class="citation">(<a href="#ref-korn1991epidemiologic" role="doc-biblioref">Korn and Graubard 1991</a>)</span>.</p>
<p>Second, NHANES I used a multi-stage sampling design to pick participants. It would have been impractical to randomly sample from everyone in the country, in part because the study included in-person interviews and it would be hard to get the interviewers to people spread around the country. Instead, they designed a strategy where they could send interviewers to fewer places, while still having a sample that could be used to represent the non-institutionalized US population <span class="citation">(<a href="#ref-korn1991epidemiologic" role="doc-biblioref">Korn and Graubard 1991</a>)</span>.</p>
<p>However, when a study population is selected based on this type of complex survey design, you may not be able to assume that observations are independent of each other. Instead, there may be some patterns of clustering in the data you collect—for example, people surveyed from the same sampling unit for a multi-stage sampling design may be more similar than people from different units. While this is unlikely to bias the main effect estimate, it is likely to cause you to estimate too-small standard errors (and so confidence intervals that are too tight), providing an overly optimistic view of the variance in your estimate <span class="citation">(<a href="#ref-korn1991epidemiologic" role="doc-biblioref">Korn and Graubard 1991</a>)</span>.</p>
<p>These characteristics of the NHEFS cohort were necessary to make the original survey practical enough that it could be carried out. While it does make the data more complicated to analyze, there are strategies that can be used to account for oversampling and the multi-stage sampling design. Some papers have described these approaches for the NHEFS cohort and provide a good roadmap if you’d like to explore these data yourself <span class="citation">(<a href="#ref-korn1991epidemiologic" role="doc-biblioref">Korn and Graubard 1991</a>; <a href="#ref-ingram1994statistical" role="doc-biblioref">Ingram and Makuc 1994</a>)</span>. Further, the <a href="https://www.cdc.gov/nchs/nhanes/index.htm">NHANES website</a> includes extensive information about the NHANES series of studies, as well as tools, data, and tutorials, if you would like to try working with the data.</p>

</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-andersson201970" class="csl-entry">
Andersson, Charlotte, Andrew D Johnson, Emelia J Benjamin, Daniel Levy, and Ramachandran S Vasan. 2019. <span>“70-Year Legacy of the Framingham Heart Study.”</span> <em>Nature Reviews Cardiology</em>, 1.
</div>
<div id="ref-bradburn2003survival" class="csl-entry">
Bradburn, Michael J, Taane G Clark, Sharon B Love, and Douglas G Altman. 2003a. <span>“Survival Analysis Part II: Multivariate Data Analysis–an Introduction to Concepts and Methods.”</span> <em>British Journal of Cancer</em> 89 (3): 431–36.
</div>
<div id="ref-bradburn2003survival2" class="csl-entry">
———. 2003b. <span>“Survival Analysis Part III: Multivariate Data Analysis–Choosing a Model and Assessing Its Adequacy and Fit.”</span> <em>British Journal of Cancer</em> 89 (4): 605–11.
</div>
<div id="ref-breslow2001long" class="csl-entry">
Breslow, Rosalind A, Rachel Ballard-Barbash, Kathryn Munoz, and Barry I Graubard. 2001. <span>“Long-Term Recreational Physical Activity and Breast Cancer in the National Health and Nutrition Examination Survey i Epidemiologic Follow-up Study.”</span> <em>Cancer Epidemiology and Prevention Biomarkers</em> 10 (7): 805–8.
</div>
<div id="ref-clark2003survival" class="csl-entry">
Clark, Taane G, Michael J Bradburn, Sharon B Love, and Douglas G Altman. 2003. <span>“Survival Analysis Part i: Basic Concepts and First Analyses.”</span> <em>British Journal of Cancer</em> 89 (2): 232–38.
</div>
<div id="ref-dawber1951epidemiological" class="csl-entry">
Dawber, Thomas R, Gilcin F Meadors, and Felix E Moore Jr. 1951. <span>“Epidemiological Approaches to Heart Disease: The Framingham Study.”</span> <em>American Journal of Public Health and the Nations Health</em> 41 (3): 279–86.
</div>
<div id="ref-dawber2015ii" class="csl-entry">
Dawber, Thomas R, Felix E Moore, and George V Mann. 2015. <span>“II. Coronary Heart Disease in the Framingham Study.”</span> <em>International Journal of Epidemiology</em> 44 (6): 1767–80.
</div>
<div id="ref-gillum1994white" class="csl-entry">
Gillum, Richard F, Deborah D Ingram, and Diane M Makuc. 1994. <span>“White Blood Cell Count and Stroke Incidence and Death: The NHANES i Epidemiologic Follow-up Study.”</span> <em>American Journal of Epidemiology</em> 139 (9): 894–902.
</div>
<div id="ref-hernan2010hazards" class="csl-entry">
Hernán, Miguel A. 2010. <span>“The Hazards of Hazard Ratios.”</span> <em>Epidemiology (Cambridge, Mass.)</em> 21 (1): 13.
</div>
<div id="ref-ingram1994statistical" class="csl-entry">
Ingram, DD, and DM Makuc. 1994. <span>“Statistical Issues in Analyzing the NHANES i Epidemiologic Followup Study. Series 2: Data Evaluation and Methods Research.”</span> <em>Vital and Health Statistics. Series 2, Data Evaluation and Methods Research</em>, no. 121: 1–30.
</div>
<div id="ref-kant1995frequency" class="csl-entry">
Kant, AK, A Schatzkin, BI Graubard, and R Ballard-Barbash. 1995. <span>“Frequency of Eating Occasions and Weight Change in the NHANES i Epidemiologic Follow-up Study.”</span> <em>International Journal of Obesity and Related Metabolic Disorders: Journal of the International Association for the Study of Obesity</em> 19 (7): 468–74.
</div>
<div id="ref-korn1991epidemiologic" class="csl-entry">
Korn, Edward L, and Barry I Graubard. 1991. <span>“Epidemiologic Studies Utilizing Surveys: Accounting for the Sampling Design.”</span> <em>American Journal of Public Health</em> 81 (9): 1166–73.
</div>
<div id="ref-magni1993chronic" class="csl-entry">
Magni, Guido, Maura Marchetti, Claudio Moreschi, Harold Merskey, and Silio Rigatti Luchini. 1993. <span>“Chronic Musculoskeletal Pain and Depressive Symptoms in the National Health and Nutrition Examination i. Epidemiologic Follow-up Study.”</span> <em>Pain</em> 53 (2): 163–68.
</div>
<div id="ref-mussolino1998risk" class="csl-entry">
Mussolino, Michael E, Anne C Looker, Jennifer H Madans, Jean A Langlois, and Eric S Orwoll. 1998. <span>“Risk Factors for Hip Fracture in White Men: The NHANES i Epidemiologic Follow-up Study.”</span> <em>Journal of Bone and Mineral Research</em> 13 (6): 918–24.
</div>
<div id="ref-su2001nutritional" class="csl-entry">
Su, L Joseph, and Lenore Arab. 2001. <span>“Nutritional Status of Folate and Colon Cancer Risk: Evidence from NHANES i Epidemiologic Follow-up Study.”</span> <em>Annals of Epidemiology</em> 11 (1): 65–72.
</div>
<div id="ref-valenzuela2021lifestyle" class="csl-entry">
Valenzuela, Pedro L, Pedro Carrera-Bastos, Beatriz G Gálvez, Gema Ruiz-Hurtado, José M Ordovas, Luis M Ruilope, and Alejandro Lucia. 2021. <span>“Lifestyle Interventions for the Prevention and Treatment of Hypertension.”</span> <em>Nature Reviews Cardiology</em> 18 (4): 251–75.
</div>
<div id="ref-vargas2000incidence" class="csl-entry">
Vargas, Clemencia M, Deborah D Ingram, and Richard F Gillum. 2000. <span>“Incidence of Hypertension and Educational Attainment the NHANES i Epidemiologic Followup Study.”</span> <em>American Journal of Epidemiology</em> 152 (3): 272–78.
</div>
<div id="ref-wong2014epidemiological" class="csl-entry">
Wong, Nathan D. 2014. <span>“Epidemiological Studies of CHD and the Evolution of Preventive Cardiology.”</span> <em>Nature Reviews Cardiology</em> 11 (5): 276–89.
</div>
<div id="ref-wong1989risk" class="csl-entry">
Wong, Nathan D, Adrienne Cupples, Adrian M Ostfeld, Daniel Levy, and William B Kannel. 1989. <span>“Risk Factors for Long-Term Coronary Prognosis After Initial Myocardial Infarction: The Framingham Study.”</span> <em>American Journal of Epidemiology</em> 130 (3): 469–80.
</div>
<div id="ref-zhou2021global" class="csl-entry">
Zhou, Bin, Pablo Perel, George A Mensah, and Majid Ezzati. 2021. <span>“Global Epidemiology, Health Burden and Effective Interventions for Elevated Blood Pressure and Hypertension.”</span> <em>Nature Reviews Cardiology</em>, 1–18.
</div>
<div id="ref-ziaeian2016epidemiology" class="csl-entry">
Ziaeian, Boback, and Gregg C Fonarow. 2016. <span>“Epidemiology and Aetiology of Heart Failure.”</span> <em>Nature Reviews Cardiology</em> 13 (6): 368–78.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="estimating-health-impacts.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="some-approaches-for-confounding.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["adv_epi_analysis.pdf", "adv_epi_analysis.epub"],
"search": {
"engine": "lunr",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
